
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Refatora√ß√£o de C√≥digos, Code Smells e Integra√ß√£o com SonarCloud &#8212; Programa√ß√£o Orientada a Objetos II (Avan√ßado)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=a8e58a58"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="https://wavedrom.com/skins/default.js"></script>
    <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/aulas/aula-07-08-refatoracao-code-smells-sonarcloud/README';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@11.9.0/dist/mermaid.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="prev" title="Git e CI/CD com GitHub Actions" href="../aula-05-06-git-ci-cd-github-actions/README.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../README.html">
  
  
  
  
  
  
    <p class="title logo__title">Programa√ß√£o Orientada a Objetos II (Avan√ßado)</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../README.html">
                    Programa√ß√£o Orientada a Objetos II (POOII) - Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Aulas da Disciplina</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../aula-01-02-boas-praticas-design-patters/README.html">Boas Pr√°ticas e Design Patterns Cl√°ssicos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aula-03-04-ambiente-profissional-python/README.html">Ambiente Profissional de Projetos Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aula-05-06-git-ci-cd-github-actions/README.html">Git e CI/CD com GitHub Actions</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Refatora√ß√£o de C√≥digos, Code Smells e Integra√ß√£o com SonarCloud</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Refatora√ß√£o de C√≥digos, Code Smells e Integra√ß√£o com SonarCloud</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sumario">Sum√°rio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abertura-e-engajamento">1. Abertura e Engajamento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problema-motivador">1.1. Problema Motivador</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contexto-historico-e-relevancia-atual">1.2. Contexto Hist√≥rico e Relev√¢ncia Atual</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fundamentos-teoricos">2. Fundamentos Te√≥ricos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introducao-aos-code-smells">2.1. Introdu√ß√£o aos Code Smells</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#terminologia-essencial-e-definicoes-formais">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-dos-code-smells">Estrutura Conceitual dos Code Smells</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-tamanho-e-complexidade"><strong>1. Smells de Tamanho e Complexidade</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-duplicacao"><strong>2. Smells de Duplica√ß√£o</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-responsabilidade"><strong>3. Smells de Responsabilidade</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-acoplamento"><strong>4. Smells de Acoplamento</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-abstracao"><strong>5. Smells de Abstra√ß√£o</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-quantitativa-metricas-de-qualidade">An√°lise Quantitativa: M√©tricas de Qualidade</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-critica-limitacoes-e-contexto">An√°lise Cr√≠tica: Limita√ß√µes e Contexto</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tecnicas-de-refatoracao">2.2. T√©cnicas de Refatora√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-das-tecnicas-de-refatoracao">Estrutura Conceitual das T√©cnicas de Refatora√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracoes-de-extracao"><strong>1. Refatora√ß√µes de Extra√ß√£o</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracoes-de-movimento"><strong>2. Refatora√ß√µes de Movimento</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracoes-de-simplificacao"><strong>3. Refatora√ß√µes de Simplifica√ß√£o</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-consequencias-e-trade-offs">An√°lise de Consequ√™ncias e Trade-offs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-critica-quando-nao-refatorar">An√°lise Cr√≠tica: Quando N√ÉO Refatorar</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tdd-e-refatoracao">2.3. TDD e Refatora√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-do-tdd-na-refatoracao">Estrutura Conceitual do TDD na Refatora√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#fase-red-definicao-de-comportamento"><strong>1. Fase Red: Defini√ß√£o de Comportamento</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#fase-green-implementacao-minima"><strong>2. Fase Green: Implementa√ß√£o M√≠nima</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#fase-refactor-melhoria-da-qualidade"><strong>3. Fase Refactor: Melhoria da Qualidade</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-quantitativa-metricas-tdd">An√°lise Quantitativa: M√©tricas TDD</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-consequencias-tdd-vs-refatoracao-tradicional">An√°lise de Consequ√™ncias: TDD vs. Refatora√ß√£o Tradicional</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-de-analise-estatica">2.4. Ferramentas de An√°lise Est√°tica</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-das-ferramentas">Estrutura Conceitual das Ferramentas</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pylint-analise-completa-de-qualidade"><strong>1. Pylint: An√°lise Completa de Qualidade</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#flake8-analise-de-estilo-e-qualidade"><strong>2. Flake8: An√°lise de Estilo e Qualidade</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#sonarcloud-plataforma-integrada"><strong>3. SonarCloud: Plataforma Integrada</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">An√°lise Quantitativa: M√©tricas de Qualidade</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-critica-limitacoes-e-falsos-positivos">An√°lise Cr√≠tica: Limita√ß√µes e Falsos Positivos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integracao-com-pipelines-ci-cd">2.5. Integra√ß√£o com Pipelines CI/CD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-da-integracao">Estrutura Conceitual da Integra√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline-de-qualidade-em-multiplas-camadas"><strong>1. Pipeline de Qualidade em M√∫ltiplas Camadas</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#configuracao-github-actions-completa"><strong>2. Configura√ß√£o GitHub Actions Completa</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-gate-customizado"><strong>3. Quality Gate Customizado</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-consequencias-impacto-na-velocidade-vs-qualidade">An√°lise de Consequ√™ncias: Impacto na Velocidade vs. Qualidade</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacao-pratica-e-implementacao">3. Aplica√ß√£o Pr√°tica e Implementa√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estudo-de-caso-guiado-sistema-de-e-commerce">3.1. Estudo de Caso Guiado: Sistema de E-commerce</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#passo-1-analise-inicial-do-sistema-problematico">Passo 1: An√°lise Inicial do Sistema Problem√°tico</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#passo-2-identificacao-e-catalogacao-dos-code-smells">Passo 2: Identifica√ß√£o e Cataloga√ß√£o dos Code Smells</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#passo-3-refatoracao-incremental-com-tdd">Passo 3: Refatora√ß√£o Incremental com TDD</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#passo-4-comparacao-quantitativa-antes-vs-depois">Passo 4: Compara√ß√£o Quantitativa - Antes vs. Depois</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exemplos-de-codigo-comentado">3.2. Exemplos de C√≥digo Comentado</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-method-decomposicao-de-complexidade">Extract Method: Decomposi√ß√£o de Complexidade</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-bibliotecas-e-ecossistema">3.3. Ferramentas, Bibliotecas e Ecossistema</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-de-analise-de-qualidade-utilizadas">Ferramentas de An√°lise de Qualidade Utilizadas</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-de-teste-e-cobertura">Ferramentas de Teste e Cobertura</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-de-ci-cd">Ferramentas de CI/CD</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#topicos-avancados-e-nuances">4. T√≥picos Avan√ßados e Nuances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#desafios-comuns-e-anti-padroes">4.1. Desafios Comuns e ‚ÄúAnti-Padr√µes‚Äù</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#over-engineering-o-perigo-da-refatoracao-excessiva">Over-Engineering: O Perigo da Refatora√ß√£o Excessiva</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracao-sem-testes-receita-para-o-desastre">Refatora√ß√£o Sem Testes: Receita para o Desastre</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#technical-debt-vs-business-pressure">Technical Debt vs. Business Pressure</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variacoes-e-arquiteturas-especializadas">4.2. Varia√ß√µes e Arquiteturas Especializadas</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#microservices-e-refatoracao-distribuida">Microservices e Refatora√ß√£o Distribu√≠da</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracao-para-performance">Refatora√ß√£o para Performance</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-performance-e-otimizacao">4.3. An√°lise de Performance e Otimiza√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas-de-qualidade-vs-performance">M√©tricas de Qualidade vs. Performance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sintese-e-perspectivas-futuras">5. S√≠ntese e Perspectivas Futuras</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conexoes-com-outras-areas-da-computacao">5.1. Conex√µes com Outras √Åreas da Computa√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#engenharia-de-software-e-devops">Engenharia de Software e DevOps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inteligencia-artificial-e-machine-learning">Intelig√™ncia Artificial e Machine Learning</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seguranca-da-informacao">Seguran√ßa da Informa√ß√£o</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-fronteira-da-pesquisa-e-o-futuro">5.2. A Fronteira da Pesquisa e o Futuro</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#quantum-computing-e-code-quality">Quantum Computing e Code Quality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracao-automatica-com-large-language-models">Refatora√ß√£o Autom√°tica com Large Language Models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#continuous-quality-evolution">Continuous Quality Evolution</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resumo-do-capitulo-e-mapa-mental">5.3. Resumo do Cap√≠tulo e Mapa Mental</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#principais-conceitos-consolidados">Principais Conceitos Consolidados</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mapa-mental-ecossistema-de-qualidade">Mapa Mental: Ecossistema de Qualidade</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#referencias-e-leituras-adicionais">5.4. Refer√™ncias e Leituras Adicionais</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#livros-fundamentais">Livros Fundamentais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#artigos-cientificos-e-papers">Artigos Cient√≠ficos e Papers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#recursos-online-e-ferramentas">Recursos Online e Ferramentas</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cursos-e-certificacoes">Cursos e Certifica√ß√µes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="refatoracao-de-codigos-code-smells-e-integracao-com-sonarcloud">
<h1>Refatora√ß√£o de C√≥digos, Code Smells e Integra√ß√£o com SonarCloud<a class="headerlink" href="#refatoracao-de-codigos-code-smells-e-integracao-com-sonarcloud" title="Link to this heading">#</a></h1>
<section id="sumario">
<h2>Sum√°rio<a class="headerlink" href="#sumario" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#1-abertura-e-engajamento"><span class="xref myst">Abertura e Engajamento</span></a></p>
<ul class="simple">
<li><p>1.1. <a class="reference internal" href="#11-problema-motivador"><span class="xref myst">Problema Motivador</span></a></p></li>
<li><p>1.2. <a class="reference internal" href="#12-contexto-hist%C3%B3rico-e-relev%C3%A2ncia-atual"><span class="xref myst">Contexto Hist√≥rico e Relev√¢ncia Atual</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#2-fundamentos-te%C3%B3ricos"><span class="xref myst">Fundamentos Te√≥ricos</span></a></p>
<ul class="simple">
<li><p>2.1. <a class="reference internal" href="#21-introdu%C3%A7%C3%A3o-aos-code-smells"><span class="xref myst">Introdu√ß√£o aos Code Smells</span></a></p></li>
<li><p>2.2. <a class="reference internal" href="#22-t%C3%A9cnicas-de-refatora%C3%A7%C3%A3o"><span class="xref myst">T√©cnicas de Refatora√ß√£o</span></a></p></li>
<li><p>2.3. <a class="reference internal" href="#23-tdd-e-refatora%C3%A7%C3%A3o"><span class="xref myst">TDD e Refatora√ß√£o</span></a></p></li>
<li><p>2.4. <a class="reference internal" href="#24-ferramentas-de-an%C3%A1lise-est%C3%A1tica"><span class="xref myst">Ferramentas de An√°lise Est√°tica</span></a></p></li>
<li><p>2.5. <a class="reference internal" href="#25-integra%C3%A7%C3%A3o-com-pipelines-cicd"><span class="xref myst">Integra√ß√£o com Pipelines CI/CD</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#3-aplica%C3%A7%C3%A3o-pr%C3%A1tica-e-implementa%C3%A7%C3%A3o"><span class="xref myst">Aplica√ß√£o Pr√°tica e Implementa√ß√£o</span></a></p>
<ul class="simple">
<li><p>3.1. <a class="reference internal" href="#31-estudo-de-caso-guiado-sistema-de-e-commerce"><span class="xref myst">Estudo de Caso Guiado: Sistema de E-commerce</span></a></p></li>
<li><p>3.2. <a class="reference internal" href="#32-exemplos-de-c%C3%B3digo-comentado"><span class="xref myst">Exemplos de C√≥digo Comentado</span></a></p></li>
<li><p>3.3. <a class="reference internal" href="#33-ferramentas-bibliotecas-e-ecossistema"><span class="xref myst">Ferramentas, Bibliotecas e Ecossistema</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#4-t%C3%B3picos-avan%C3%A7ados-e-nuances"><span class="xref myst">T√≥picos Avan√ßados e Nuances</span></a></p>
<ul class="simple">
<li><p>4.1. <a class="reference internal" href="#41-desafios-comuns-e-anti-padr%C3%B5es"><span class="xref myst">Desafios Comuns e ‚ÄúAnti-Padr√µes‚Äù</span></a></p></li>
<li><p>4.2. <a class="reference internal" href="#42-varia%C3%A7%C3%B5es-e-arquiteturas-especializadas"><span class="xref myst">Varia√ß√µes e Arquiteturas Especializadas</span></a></p></li>
<li><p>4.3. <a class="reference internal" href="#43-an%C3%A1lise-de-performance-e-otimiza%C3%A7%C3%A3o"><span class="xref myst">An√°lise de Performance e Otimiza√ß√£o</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#5-s%C3%ADntese-e-perspectivas-futuras"><span class="xref myst">S√≠ntese e Perspectivas Futuras</span></a></p>
<ul class="simple">
<li><p>5.1. <a class="reference internal" href="#51-conex%C3%B5es-com-outras-%C3%A1reas-da-computa%C3%A7%C3%A3o"><span class="xref myst">Conex√µes com Outras √Åreas da Computa√ß√£o</span></a></p></li>
<li><p>5.2. <a class="reference internal" href="#52-a-fronteira-da-pesquisa-e-o-futuro"><span class="xref myst">A Fronteira da Pesquisa e o Futuro</span></a></p></li>
<li><p>5.3. <a class="reference internal" href="#53-resumo-do-cap%C3%ADtulo-e-mapa-mental"><span class="xref myst">Resumo do Cap√≠tulo e Mapa Mental</span></a></p></li>
<li><p>5.4. <a class="reference internal" href="#54-refer%C3%AAncias-e-leituras-adicionais"><span class="xref myst">Refer√™ncias e Leituras Adicionais</span></a></p></li>
</ul>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="abertura-e-engajamento">
<h2>1. Abertura e Engajamento<a class="headerlink" href="#abertura-e-engajamento" title="Link to this heading">#</a></h2>
<section id="problema-motivador">
<h3>1.1. Problema Motivador<a class="headerlink" href="#problema-motivador" title="Link to this heading">#</a></h3>
<p>Imagine uma startup de tecnologia que desenvolveu rapidamente um sistema de e-commerce durante a pandemia. Inicialmente, com apenas dois desenvolvedores trabalhando contra o tempo, o foco era exclusivamente fazer o sistema funcionar: processar pedidos, gerenciar estoque, aceitar pagamentos. O neg√≥cio decolou, e hoje a empresa tem 15 desenvolvedores, milhares de clientes ativos e um faturamento mensal de R$ 2 milh√µes.</p>
<p>Por√©m, o que inicialmente era uma vantagem competitiva ‚Äì velocidade de desenvolvimento ‚Äì se tornou um pesadelo t√©cnico. Cada nova funcionalidade demora semanas para ser implementada. Bugs que deveriam ser simples de corrigir geram efeitos colaterais inesperados em outras partes do sistema. A equipe passa mais tempo debugando c√≥digo existente do que criando features novas. O tempo de onboarding de novos desenvolvedores aumentou de 2 semanas para 2 meses. Worst of all: o sistema j√° sofreu 3 incidentes cr√≠ticos em produ√ß√£o nos √∫ltimos 6 meses, causando perdas de vendas e eros√£o da confian√ßa dos clientes.</p>
<p>Este cen√°rio exemplifica o <strong>d√©bito t√©cnico</strong> acumulado quando priorizamos funcionalidade sobre qualidade de c√≥digo. O que veremos nesta aula √© como identificar sistematicamente os <strong>indicadores de baixa qualidade</strong> (code smells), aplicar <strong>t√©cnicas de refatora√ß√£o</strong> para elimin√°-los, e estabelecer <strong>processos automatizados</strong> que previnem a degrada√ß√£o cont√≠nua da qualidade. N√£o se trata apenas de ‚Äúembelezar‚Äù c√≥digo, mas de garantir a <strong>sustentabilidade econ√¥mica</strong> e <strong>competitividade t√©cnica</strong> de projetos de software.</p>
</section>
<section id="contexto-historico-e-relevancia-atual">
<h3>1.2. Contexto Hist√≥rico e Relev√¢ncia Atual<a class="headerlink" href="#contexto-historico-e-relevancia-atual" title="Link to this heading">#</a></h3>
<p>O conceito de <strong>refatora√ß√£o</strong> foi formalmente introduzido por <strong>Martin Fowler</strong> em seu livro seminal ‚ÄúRefactoring: Improving the Design of Existing Code‚Äù (1999), mas suas ra√≠zes remontam √†s pr√°ticas de <strong>reestrutura√ß√£o de c√≥digo</strong> desenvolvidas nos anos 1980. Fowler, junto com <strong>Kent Beck</strong>, <strong>John Brant</strong> e <strong>Don Roberts</strong>, sistematizou algo que desenvolvedores experientes faziam intuitivamente: melhorar a estrutura interna do c√≥digo sem alterar seu comportamento externo.</p>
<p>Paralelamente, o conceito de <strong>‚Äúcode smells‚Äù</strong> emergiu da observa√ß√£o de que certos padr√µes no c√≥digo frequentemente indicavam problemas de design subjacentes. Esta ideia foi popularizada por Beck e depois expandida por Fowler, estabelecendo um vocabul√°rio comum para discutir qualidade de c√≥digo. Os <strong>‚Äúbad smells‚Äù</strong> (maus cheiros) se tornaram uma met√°fora poderosa: assim como maus odores indicam decomposi√ß√£o, certos padr√µes de c√≥digo indicam degrada√ß√£o da arquitetura.</p>
<p>A relev√¢ncia atual desses conceitos √© <strong>exponencial</strong>. Com a acelera√ß√£o digital p√≥s-pandemia, a <strong>velocidade de desenvolvimento</strong> se tornou cr√≠tica, mas n√£o pode vir √†s custas da <strong>sustentabilidade t√©cnica</strong>. Empresas como <strong>Netflix</strong>, <strong>Amazon</strong> e <strong>Google</strong> investem bilh√µes em <strong>ferramentas de an√°lise de qualidade</strong> e <strong>processos de refatora√ß√£o cont√≠nua</strong>. O <strong>SonarCloud</strong>, lan√ßado pela SonarSource em 2017, representa a evolu√ß√£o natural dessas pr√°ticas: an√°lise automatizada de qualidade integrada aos pipelines de desenvolvimento.</p>
<p>Dados do <strong>State of DevOps Report 2023</strong> mostram que organiza√ß√µes com <strong>alta qualidade de c√≥digo</strong> apresentam:</p>
<ul class="simple">
<li><p><strong>46% menos tempo</strong> gasto em manuten√ß√£o corretiva</p></li>
<li><p><strong>38% maior velocidade</strong> de entrega de features</p></li>
<li><p><strong>60% menor taxa</strong> de incidentes em produ√ß√£o</p></li>
<li><p><strong>25% maior satisfa√ß√£o</strong> da equipe de desenvolvimento</p></li>
</ul>
<p>Esta aula n√£o apenas ensina <strong>t√©cnicas de refatora√ß√£o</strong>, mas demonstra como <strong>automatizar a qualidade</strong> atrav√©s de ferramentas modernas integradas aos <strong>pipelines de CI/CD</strong>. O objetivo √© transformar qualidade de c√≥digo de <strong>atividade reativa</strong> para <strong>processo proativo</strong>.</p>
</section>
</section>
<hr class="docutils" />
<section id="fundamentos-teoricos">
<h2>2. Fundamentos Te√≥ricos<a class="headerlink" href="#fundamentos-teoricos" title="Link to this heading">#</a></h2>
<section id="introducao-aos-code-smells">
<h3>2.1. Introdu√ß√£o aos Code Smells<a class="headerlink" href="#introducao-aos-code-smells" title="Link to this heading">#</a></h3>
<section id="terminologia-essencial-e-definicoes-formais">
<h4>Terminologia Essencial e Defini√ß√µes Formais<a class="headerlink" href="#terminologia-essencial-e-definicoes-formais" title="Link to this heading">#</a></h4>
<p><strong>Code Smell</strong> √© um termo t√©cnico que descreve fragmentos de c√≥digo que, embora funcionalmente corretos, violam princ√≠pios de design ou boas pr√°ticas de programa√ß√£o, indicando potenciais problemas na arquitetura do software. Formalmente, um code smell √© um <strong>indicador sint√°tico ou estrutural</strong> que sugere a necessidade de refatora√ß√£o para melhorar a manutenibilidade, legibilidade ou extensibilidade do c√≥digo.</p>
<blockquote>
<div><p><strong>üîç Analogia para Entender</strong></p>
<p>Imagine code smells como sintomas m√©dicos. Um paciente pode estar funcionando normalmente (o c√≥digo executa), mas apresentar sintomas como fadiga cr√¥nica, dores de cabe√ßa ou press√£o alta (code smells). Estes sintomas n√£o impedem o funcionamento imediato, mas indicam problemas subjacentes que, se n√£o tratados, podem evoluir para condi√ß√µes mais s√©rias. Um m√©dico experiente reconhece esses padr√µes e recomenda tratamentos preventivos (refatora√ß√£o) antes que se tornem problemas cr√≠ticos (bugs, falhas de sistema, impossibilidade de manuten√ß√£o).</p>
</div></blockquote>
</section>
<section id="estrutura-conceitual-dos-code-smells">
<h4>Estrutura Conceitual dos Code Smells<a class="headerlink" href="#estrutura-conceitual-dos-code-smells" title="Link to this heading">#</a></h4>
<p>Os code smells podem ser categorizados em <strong>cinco grandes fam√≠lias</strong>, cada uma representando uma viola√ß√£o de princ√≠pios fundamentais de design:</p>
<section id="smells-de-tamanho-e-complexidade">
<h5><strong>1. Smells de Tamanho e Complexidade</strong><a class="headerlink" href="#smells-de-tamanho-e-complexidade" title="Link to this heading">#</a></h5>
<p><strong>Conceito:</strong> Viola√ß√µes relacionadas ao <strong>Princ√≠pio da Responsabilidade √önica</strong> e controle de complexidade.</p>
<p><strong>Exemplos principais:</strong></p>
<ul class="simple">
<li><p><strong>Long Method (M√©todo Longo):</strong> M√©todos com mais de 20-30 linhas</p></li>
<li><p><strong>Large Class (Classe Grande):</strong> Classes com mais de 500 linhas ou 20+ m√©todos p√∫blicos</p></li>
<li><p><strong>Long Parameter List (Lista Longa de Par√¢metros):</strong> M√©todos com 4+ par√¢metros</p></li>
</ul>
<p><strong>Diagrama de Detec√ß√£o:</strong></p>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>graph TD
    A[Analisar M√©todo/Classe] --&gt; B{Contar Linhas}
    B --&gt;|&gt; 30 linhas| C[Long Method]
    B --&gt;|‚â§ 30 linhas| D{Contar Par√¢metros}
    D --&gt;|&gt; 4 par√¢metros| E[Long Parameter List]
    D --&gt;|‚â§ 4 par√¢metros| F{Complexidade Ciclom√°tica}
    F --&gt;|&gt; 10| G[Complex Method]
    F --&gt;|‚â§ 10| H[C√≥digo Aceit√°vel]
</pre></div>
</div>
</section>
<section id="smells-de-duplicacao">
<h5><strong>2. Smells de Duplica√ß√£o</strong><a class="headerlink" href="#smells-de-duplicacao" title="Link to this heading">#</a></h5>
<p><strong>Conceito:</strong> Viola√ß√µes do <strong>Princ√≠pio DRY</strong> (Don‚Äôt Repeat Yourself).</p>
<p><strong>Exemplos principais:</strong></p>
<ul class="simple">
<li><p><strong>Duplicated Code:</strong> Blocos id√™nticos ou similares em m√∫ltiplos locais</p></li>
<li><p><strong>Alternative Classes with Different Interfaces:</strong> Classes que fazem a mesma coisa com interfaces diferentes</p></li>
</ul>
</section>
<section id="smells-de-responsabilidade">
<h5><strong>3. Smells de Responsabilidade</strong><a class="headerlink" href="#smells-de-responsabilidade" title="Link to this heading">#</a></h5>
<p><strong>Conceito:</strong> Viola√ß√µes de <strong>coes√£o</strong> e <strong>separa√ß√£o de responsabilidades</strong>.</p>
<p><strong>Exemplos principais:</strong></p>
<ul class="simple">
<li><p><strong>Feature Envy:</strong> M√©todo que usa mais dados de outra classe que da pr√≥pria</p></li>
<li><p><strong>Data Class:</strong> Classe que apenas armazena dados sem comportamento</p></li>
<li><p><strong>God Class:</strong> Classe que controla muitas outras classes</p></li>
</ul>
</section>
<section id="smells-de-acoplamento">
<h5><strong>4. Smells de Acoplamento</strong><a class="headerlink" href="#smells-de-acoplamento" title="Link to this heading">#</a></h5>
<p><strong>Conceito:</strong> Viola√ß√µes do <strong>baixo acoplamento</strong> entre componentes.</p>
<p><strong>Exemplos principais:</strong></p>
<ul class="simple">
<li><p><strong>Inappropriate Intimacy:</strong> Classes que conhecem demais sobre detalhes internos de outras</p></li>
<li><p><strong>Message Chains:</strong> Sequ√™ncias longas de chamadas de m√©todo (a.getB().getC().getD())</p></li>
</ul>
</section>
<section id="smells-de-abstracao">
<h5><strong>5. Smells de Abstra√ß√£o</strong><a class="headerlink" href="#smells-de-abstracao" title="Link to this heading">#</a></h5>
<p><strong>Conceito:</strong> Uso inadequado de <strong>heran√ßa</strong> e <strong>polimorfismo</strong>.</p>
<p><strong>Exemplos principais:</strong></p>
<ul class="simple">
<li><p><strong>Refused Bequest:</strong> Subclasse que n√£o usa m√©todos/atributos herdados</p></li>
<li><p><strong>Switch Statements:</strong> Uso excessivo de estruturas condicionais em vez de polimorfismo</p></li>
</ul>
</section>
</section>
<section id="analise-quantitativa-metricas-de-qualidade">
<h4>An√°lise Quantitativa: M√©tricas de Qualidade<a class="headerlink" href="#analise-quantitativa-metricas-de-qualidade" title="Link to this heading">#</a></h4>
<p>Para quantificar code smells, utilizamos <strong>m√©tricas objetivas</strong>:</p>
<p><strong>Complexidade Ciclom√°tica (V(G)):</strong>
$<span class="math notranslate nohighlight">\(V(G) = E - N + 2P\)</span>$</p>
<p>Onde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(E\)</span> = n√∫mero de arestas no grafo de fluxo de controle</p></li>
<li><p><span class="math notranslate nohighlight">\(N\)</span> = n√∫mero de n√≥s no grafo</p></li>
<li><p><span class="math notranslate nohighlight">\(P\)</span> = n√∫mero de componentes conectados</p></li>
</ul>
<p><strong>Interpreta√ß√£o:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(V(G) ‚â§ 5\)</span>: Baixa complexidade, f√°cil manuten√ß√£o</p></li>
<li><p><span class="math notranslate nohighlight">\(5 &lt; V(G) ‚â§ 10\)</span>: Complexidade moderada, aten√ß√£o necess√°ria</p></li>
<li><p><span class="math notranslate nohighlight">\(V(G) &gt; 10\)</span>: Alta complexidade, refatora√ß√£o recomendada</p></li>
</ul>
<p><strong>Exemplo de C√°lculo:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">processar_pedido</span><span class="p">(</span><span class="n">pedido</span><span class="p">,</span> <span class="n">cliente</span><span class="p">):</span>  <span class="c1"># In√≠cio: +1</span>
    <span class="k">if</span> <span class="n">cliente</span><span class="o">.</span><span class="n">ativo</span><span class="p">:</span>                   <span class="c1"># Condi√ß√£o: +1</span>
        <span class="k">if</span> <span class="n">pedido</span><span class="o">.</span><span class="n">valor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>            <span class="c1"># Condi√ß√£o: +1</span>
            <span class="k">if</span> <span class="n">cliente</span><span class="o">.</span><span class="n">limite</span> <span class="o">&gt;=</span> <span class="n">pedido</span><span class="o">.</span><span class="n">valor</span><span class="p">:</span>  <span class="c1"># Condi√ß√£o: +1</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>                       <span class="c1"># Else: +1</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">pedido</span><span class="o">.</span><span class="n">tipo</span> <span class="o">==</span> <span class="s2">&quot;retorno&quot;</span><span class="p">:</span>  <span class="c1"># Elif: +1</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
<span class="c1"># Complexidade Ciclom√°tica = 6 (moderada, mas aceit√°vel)</span>
</pre></div>
</div>
</section>
<section id="analise-critica-limitacoes-e-contexto">
<h4>An√°lise Cr√≠tica: Limita√ß√µes e Contexto<a class="headerlink" href="#analise-critica-limitacoes-e-contexto" title="Link to this heading">#</a></h4>
<p><strong>Limita√ß√µes dos Code Smells:</strong></p>
<ol class="arabic simple">
<li><p><strong>Subjetividade:</strong> Alguns smells dependem do contexto e experi√™ncia da equipe</p></li>
<li><p><strong>False Positives:</strong> Nem todo smell indica necessariamente um problema real</p></li>
<li><p><strong>Custo-Benef√≠cio:</strong> Refatora√ß√£o pode n√£o ser justificada em c√≥digo legado est√°vel</p></li>
<li><p><strong>Dom√≠nio Espec√≠fico:</strong> Algumas viola√ß√µes podem ser aceit√°veis em dom√≠nios espec√≠ficos</p></li>
</ol>
<p><strong>FAQ: D√∫vidas Comuns sobre Code Smells</strong></p>
<p><strong>Q: Todo code smell deve ser corrigido imediatamente?</strong>
A: N√£o. Aplique o <strong>princ√≠pio 80/20</strong>: foque nos 20% de smells que causam 80% dos problemas de manuten√ß√£o.</p>
<p><strong>Q: Como priorizar a corre√ß√£o de smells?</strong>
A: Use a f√≥rmula: <code class="docutils literal notranslate"><span class="pre">Prioridade</span> <span class="pre">=</span> <span class="pre">(Frequ√™ncia</span> <span class="pre">de</span> <span class="pre">Mudan√ßa</span> <span class="pre">√ó</span> <span class="pre">Complexidade</span> <span class="pre">√ó</span> <span class="pre">Impacto</span> <span class="pre">Business)</span> <span class="pre">/</span> <span class="pre">Custo</span> <span class="pre">de</span> <span class="pre">Refatora√ß√£o</span></code></p>
<p><strong>Q: Code smells s√£o sempre ruins?</strong>
A: N√£o necessariamente. Em prot√≥tipos ou c√≥digo descart√°vel, pode ser aceit√°vel tolerar alguns smells temporariamente.</p>
<p><strong>Tabela Comparativa: Abordagens de Detec√ß√£o</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>M√©todo</p></th>
<th class="head"><p>Velocidade</p></th>
<th class="head"><p>Precis√£o</p></th>
<th class="head"><p>Custo</p></th>
<th class="head"><p>Melhor Para</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Review Manual</strong></p></td>
<td><p>Baixa</p></td>
<td><p>Alta</p></td>
<td><p>Alto</p></td>
<td><p>Smells complexos, contextuais</p></td>
</tr>
<tr class="row-odd"><td><p><strong>An√°lise Est√°tica</strong></p></td>
<td><p>Alta</p></td>
<td><p>M√©dia</p></td>
<td><p>Baixo</p></td>
<td><p>Smells sint√°ticos, m√©tricas</p></td>
</tr>
<tr class="row-even"><td><p><strong>An√°lise Din√¢mica</strong></p></td>
<td><p>M√©dia</p></td>
<td><p>Alta</p></td>
<td><p>M√©dio</p></td>
<td><p>Smells comportamentais</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Machine Learning</strong></p></td>
<td><p>Alta</p></td>
<td><p>Vari√°vel</p></td>
<td><p>Alto</p></td>
<td><p>Detec√ß√£o de padr√µes novos</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="tecnicas-de-refatoracao">
<h3>2.2. T√©cnicas de Refatora√ß√£o<a class="headerlink" href="#tecnicas-de-refatoracao" title="Link to this heading">#</a></h3>
<section id="id1">
<h4>Terminologia Essencial e Defini√ß√µes Formais<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p><strong>Refatora√ß√£o</strong> √© uma transforma√ß√£o disciplinada do c√≥digo que melhora sua estrutura interna sem alterar seu comportamento observ√°vel externamente. Formalmente, refatora√ß√£o √© uma <strong>fun√ß√£o bijetiva</strong> <span class="math notranslate nohighlight">\(R: C_1 \rightarrow C_2\)</span> onde <span class="math notranslate nohighlight">\(C_1\)</span> e <span class="math notranslate nohighlight">\(C_2\)</span> s√£o estados do c√≥digo, e <span class="math notranslate nohighlight">\(behavior(C_1) = behavior(C_2)\)</span>, mas <span class="math notranslate nohighlight">\(quality(C_2) &gt; quality(C_1)\)</span>.</p>
<p>O processo de refatora√ß√£o segue o <strong>Princ√≠pio da Invari√¢ncia Comportamental</strong>: para qualquer entrada v√°lida <span class="math notranslate nohighlight">\(i\)</span>, temos <span class="math notranslate nohighlight">\(output_{antes}(i) = output_{depois}(i)\)</span> e <span class="math notranslate nohighlight">\(side\_effects_{antes}(i) = side\_effects_{depois}(i)\)</span>.</p>
</section>
<section id="estrutura-conceitual-das-tecnicas-de-refatoracao">
<h4>Estrutura Conceitual das T√©cnicas de Refatora√ß√£o<a class="headerlink" href="#estrutura-conceitual-das-tecnicas-de-refatoracao" title="Link to this heading">#</a></h4>
<section id="refatoracoes-de-extracao">
<h5><strong>1. Refatora√ß√µes de Extra√ß√£o</strong><a class="headerlink" href="#refatoracoes-de-extracao" title="Link to this heading">#</a></h5>
<p><strong>Objetivo:</strong> Separar responsabilidades e reduzir complexidade atrav√©s da <strong>decomposi√ß√£o</strong>.</p>
<p><strong>Extract Method (Extrair M√©todo):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANTES: Long Method</span>
<span class="k">def</span><span class="w"> </span><span class="nf">processar_venda</span><span class="p">(</span><span class="n">produtos</span><span class="p">,</span> <span class="n">cliente</span><span class="p">,</span> <span class="n">pagamento</span><span class="p">):</span>
    <span class="c1"># Validar produtos (15 linhas)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">produto</span> <span class="ow">in</span> <span class="n">produtos</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">produto</span><span class="o">.</span><span class="n">disponivel</span> <span class="ow">and</span> <span class="n">produto</span><span class="o">.</span><span class="n">preco</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">produto</span><span class="o">.</span><span class="n">preco</span> <span class="o">*</span> <span class="n">produto</span><span class="o">.</span><span class="n">quantidade</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Produto inv√°lido: </span><span class="si">{</span><span class="n">produto</span><span class="o">.</span><span class="n">nome</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Validar cliente (10 linhas)  </span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cliente</span><span class="o">.</span><span class="n">ativo</span> <span class="ow">or</span> <span class="n">cliente</span><span class="o">.</span><span class="n">limite</span> <span class="o">&lt;</span> <span class="n">total</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cliente inv√°lido para compra&quot;</span><span class="p">)</span>
    
    <span class="c1"># Processar pagamento (12 linhas)</span>
    <span class="k">if</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">tipo</span> <span class="o">==</span> <span class="s2">&quot;cartao&quot;</span><span class="p">:</span>
        <span class="c1"># l√≥gica cart√£o...</span>
    <span class="k">elif</span> <span class="n">pagamento</span><span class="o">.</span><span class="n">tipo</span> <span class="o">==</span> <span class="s2">&quot;boleto&quot;</span><span class="p">:</span>
        <span class="c1"># l√≥gica boleto...</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;aprovado&quot;</span><span class="p">}</span>

<span class="c1"># DEPOIS: M√©todos extra√≠dos</span>
<span class="k">def</span><span class="w"> </span><span class="nf">processar_venda</span><span class="p">(</span><span class="n">produtos</span><span class="p">,</span> <span class="n">cliente</span><span class="p">,</span> <span class="n">pagamento</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calcular_total</span><span class="p">(</span><span class="n">produtos</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validar_cliente</span><span class="p">(</span><span class="n">cliente</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_processar_pagamento</span><span class="p">(</span><span class="n">pagamento</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;aprovado&quot;</span><span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_calcular_total</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">produtos</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">produto</span> <span class="ow">in</span> <span class="n">produtos</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">produto</span><span class="o">.</span><span class="n">disponivel</span> <span class="ow">and</span> <span class="n">produto</span><span class="o">.</span><span class="n">preco</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">produto</span><span class="o">.</span><span class="n">preco</span> <span class="o">*</span> <span class="n">produto</span><span class="o">.</span><span class="n">quantidade</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Produto inv√°lido: </span><span class="si">{</span><span class="n">produto</span><span class="o">.</span><span class="n">nome</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total</span>
</pre></div>
</div>
<p><strong>Extract Class (Extrair Classe):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANTES: God Class</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Pedido</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Dados do pedido</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produtos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Dados do cliente  </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cliente_nome</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cliente_email</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cliente_endereco</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># Dados do pagamento</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pagamento_tipo</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pagamento_valor</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validar_cliente</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">processar_pagamento</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">enviar_email</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_frete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>

<span class="c1"># DEPOIS: Classes especializadas</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Pedido</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cliente</span><span class="p">:</span> <span class="n">Cliente</span><span class="p">,</span> <span class="n">pagamento</span><span class="p">:</span> <span class="n">Pagamento</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produtos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cliente</span> <span class="o">=</span> <span class="n">cliente</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pagamento</span> <span class="o">=</span> <span class="n">pagamento</span>
        
<span class="k">class</span><span class="w"> </span><span class="nc">Cliente</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endereco</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nome</span> <span class="o">=</span> <span class="n">nome</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endereco</span> <span class="o">=</span> <span class="n">endereco</span>
        
<span class="k">class</span><span class="w"> </span><span class="nc">Pagamento</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tipo</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipo</span> <span class="o">=</span> <span class="n">tipo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">valor</span>
</pre></div>
</div>
</section>
<section id="refatoracoes-de-movimento">
<h5><strong>2. Refatora√ß√µes de Movimento</strong><a class="headerlink" href="#refatoracoes-de-movimento" title="Link to this heading">#</a></h5>
<p><strong>Objetivo:</strong> Melhorar a <strong>coes√£o</strong> movendo responsabilidades para locais mais apropriados.</p>
<p><strong>Move Method (Mover M√©todo):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANTES: Feature Envy</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Conta</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">saldo</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saldo</span> <span class="o">=</span> <span class="n">saldo</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ContaService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_juros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conta</span><span class="p">:</span> <span class="n">Conta</span><span class="p">,</span> <span class="n">taxa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dias</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># Este m√©todo usa apenas dados de Conta</span>
        <span class="k">return</span> <span class="n">conta</span><span class="o">.</span><span class="n">saldo</span> <span class="o">*</span> <span class="n">taxa</span> <span class="o">*</span> <span class="n">dias</span> <span class="o">/</span> <span class="mi">365</span>

<span class="c1"># DEPOIS: M√©todo movido para classe apropriada</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Conta</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">saldo</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saldo</span> <span class="o">=</span> <span class="n">saldo</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_juros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dias</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">saldo</span> <span class="o">*</span> <span class="n">taxa</span> <span class="o">*</span> <span class="n">dias</span> <span class="o">/</span> <span class="mi">365</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ContaService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">aplicar_juros</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conta</span><span class="p">:</span> <span class="n">Conta</span><span class="p">,</span> <span class="n">taxa</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dias</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">juros</span> <span class="o">=</span> <span class="n">conta</span><span class="o">.</span><span class="n">calcular_juros</span><span class="p">(</span><span class="n">taxa</span><span class="p">,</span> <span class="n">dias</span><span class="p">)</span>
        <span class="n">conta</span><span class="o">.</span><span class="n">saldo</span> <span class="o">+=</span> <span class="n">juros</span>
        <span class="k">return</span> <span class="n">juros</span>
</pre></div>
</div>
</section>
<section id="refatoracoes-de-simplificacao">
<h5><strong>3. Refatora√ß√µes de Simplifica√ß√£o</strong><a class="headerlink" href="#refatoracoes-de-simplificacao" title="Link to this heading">#</a></h5>
<p><strong>Objetivo:</strong> Reduzir <strong>complexidade ciclom√°tica</strong> e melhorar legibilidade.</p>
<p><strong>Replace Conditional with Polymorphism (Substituir Condicional por Polimorfismo):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANTES: Switch Statement</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CalculadoraDesconto</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tipo_cliente</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tipo_cliente</span> <span class="o">==</span> <span class="s2">&quot;premium&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valor</span> <span class="o">*</span> <span class="mf">0.15</span>
        <span class="k">elif</span> <span class="n">tipo_cliente</span> <span class="o">==</span> <span class="s2">&quot;vip&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valor</span> <span class="o">*</span> <span class="mf">0.20</span>
        <span class="k">elif</span> <span class="n">tipo_cliente</span> <span class="o">==</span> <span class="s2">&quot;corporativo&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">valor</span> <span class="o">*</span> <span class="mf">0.25</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

<span class="c1"># DEPOIS: Polimorfismo</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Cliente</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ClientePremium</span><span class="p">(</span><span class="n">Cliente</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valor</span> <span class="o">*</span> <span class="mf">0.15</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ClienteVIP</span><span class="p">(</span><span class="n">Cliente</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valor</span> <span class="o">*</span> <span class="mf">0.20</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ClienteCorporativo</span><span class="p">(</span><span class="n">Cliente</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valor</span> <span class="o">*</span> <span class="mf">0.25</span>
</pre></div>
</div>
</section>
</section>
<section id="analise-de-consequencias-e-trade-offs">
<h4>An√°lise de Consequ√™ncias e Trade-offs<a class="headerlink" href="#analise-de-consequencias-e-trade-offs" title="Link to this heading">#</a></h4>
<p><strong>Benef√≠cios da Refatora√ß√£o:</strong></p>
<ul class="simple">
<li><p><strong>Manutenibilidade:</strong> C√≥digo mais f√°cil de entender e modificar</p></li>
<li><p><strong>Extensibilidade:</strong> Facilita adi√ß√£o de novas funcionalidades</p></li>
<li><p><strong>Testabilidade:</strong> Componentes menores s√£o mais f√°ceis de testar</p></li>
<li><p><strong>Performance:</strong> Pode eliminar duplica√ß√µes e otimizar estruturas</p></li>
</ul>
<p><strong>Custos e Riscos:</strong></p>
<ul class="simple">
<li><p><strong>Tempo de Desenvolvimento:</strong> Refatora√ß√£o consome recursos sem adicionar funcionalidades</p></li>
<li><p><strong>Introdu√ß√£o de Bugs:</strong> Mudan√ßas sempre carregam risco de regress√£o</p></li>
<li><p><strong>Quebra de Compatibilidade:</strong> APIs podem ser alteradas</p></li>
<li><p><strong>Overhead de Processo:</strong> Necessita de cobertura de testes robusta</p></li>
</ul>
<p><strong>Trade-offs por Contexto:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Cen√°rio</p></th>
<th class="head"><p>Refatorar?</p></th>
<th class="head"><p>Justificativa</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>C√≥digo Novo</strong></p></td>
<td><p>‚úÖ Sempre</p></td>
<td><p>Baixo risco, alto benef√≠cio futuro</p></td>
</tr>
<tr class="row-odd"><td><p><strong>C√≥digo Legacy Est√°vel</strong></p></td>
<td><p>‚ö†Ô∏è Cuidado</p></td>
<td><p>Alto risco, benef√≠cio question√°vel</p></td>
</tr>
<tr class="row-even"><td><p><strong>Hotfixes</strong></p></td>
<td><p>‚ùå Nunca</p></td>
<td><p>Urg√™ncia supera qualidade</p></td>
</tr>
<tr class="row-odd"><td><p><strong>C√≥digo em Manuten√ß√£o Ativa</strong></p></td>
<td><p>‚úÖ Priorizar</p></td>
<td><p>Alto benef√≠cio, risco control√°vel</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="analise-critica-quando-nao-refatorar">
<h4>An√°lise Cr√≠tica: Quando N√ÉO Refatorar<a class="headerlink" href="#analise-critica-quando-nao-refatorar" title="Link to this heading">#</a></h4>
<p><strong>Situa√ß√µes de Alto Risco:</strong></p>
<ol class="arabic simple">
<li><p><strong>C√≥digo sem Testes:</strong> Refatora√ß√£o sem rede de seguran√ßa</p></li>
<li><p><strong>Deadlines Cr√≠ticos:</strong> Press√£o temporal pode levar a erros</p></li>
<li><p><strong>Sistemas Legacy Cr√≠ticos:</strong> Risco de quebrar funcionalidades essenciais</p></li>
<li><p><strong>C√≥digo que Ser√° Descartado:</strong> Desperd√≠cio de recursos</p></li>
</ol>
<p><strong>M√©tricas para Decis√£o:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">decidir_refatoracao</span><span class="p">(</span><span class="n">complexity_score</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">test_coverage</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
                       <span class="n">business_impact</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_available</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">risk_score</span> <span class="o">=</span> <span class="n">complexity_score</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">test_coverage</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">business_impact</span> <span class="o">==</span> <span class="s2">&quot;critico&quot;</span> <span class="ow">and</span> <span class="n">risk_score</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">if</span> <span class="n">time_available</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># menos de 2 sprints</span>
        <span class="k">return</span> <span class="kc">False</span>
        
    <span class="k">return</span> <span class="n">complexity_score</span> <span class="o">&gt;</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">test_coverage</span> <span class="o">&gt;</span> <span class="mf">0.8</span>
</pre></div>
</div>
</section>
</section>
<section id="tdd-e-refatoracao">
<h3>2.3. TDD e Refatora√ß√£o<a class="headerlink" href="#tdd-e-refatoracao" title="Link to this heading">#</a></h3>
<section id="id2">
<h4>Terminologia Essencial e Defini√ß√µes Formais<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<p><strong>Test-Driven Development (TDD)</strong> √© uma metodologia de desenvolvimento onde os testes s√£o escritos antes do c√≥digo de produ√ß√£o, seguindo o ciclo <strong>Red-Green-Refactor</strong>. Formalmente, TDD estabelece uma <strong>sequ√™ncia determin√≠stica</strong> de estados: <span class="math notranslate nohighlight">\(Failing\ Test \rightarrow Passing\ Code \rightarrow Refactored\ Code \rightarrow Failing\ Test\)</span>.</p>
<p>O <strong>ciclo Red-Green-Refactor</strong> pode ser modelado como uma <strong>m√°quina de estados finitos</strong>:</p>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>stateDiagram-v2
    [*] --&gt; Red
    Red --&gt; Green : Implementar c√≥digo m√≠nimo
    Green --&gt; Refactor : C√≥digo funcional
    Refactor --&gt; Red : Novo teste
    Refactor --&gt; [*] : Feature completa
</pre></div>
</div>
</section>
<section id="estrutura-conceitual-do-tdd-na-refatoracao">
<h4>Estrutura Conceitual do TDD na Refatora√ß√£o<a class="headerlink" href="#estrutura-conceitual-do-tdd-na-refatoracao" title="Link to this heading">#</a></h4>
<section id="fase-red-definicao-de-comportamento">
<h5><strong>1. Fase Red: Defini√ß√£o de Comportamento</strong><a class="headerlink" href="#fase-red-definicao-de-comportamento" title="Link to this heading">#</a></h5>
<p><strong>Objetivo:</strong> Estabelecer <strong>contratos comportamentais</strong> atrav√©s de testes que falham inicialmente.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Teste que define o comportamento esperado</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sistema_pedidos</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessadorPedido</span><span class="p">,</span> <span class="n">Produto</span><span class="p">,</span> <span class="n">Cliente</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_calcular_total_com_desconto</span><span class="p">():</span>
    <span class="c1"># Arrange: Configurar cen√°rio</span>
    <span class="n">processador</span> <span class="o">=</span> <span class="n">ProcessadorPedido</span><span class="p">()</span>
    <span class="n">produtos</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Produto</span><span class="p">(</span><span class="s2">&quot;Notebook&quot;</span><span class="p">,</span> <span class="mf">1000.00</span><span class="p">,</span> <span class="n">quantidade</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">Produto</span><span class="p">(</span><span class="s2">&quot;Mouse&quot;</span><span class="p">,</span> <span class="mf">50.00</span><span class="p">,</span> <span class="n">quantidade</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">cliente</span> <span class="o">=</span> <span class="n">Cliente</span><span class="p">(</span><span class="s2">&quot;Jo√£o&quot;</span><span class="p">,</span> <span class="n">tipo</span><span class="o">=</span><span class="s2">&quot;premium&quot;</span><span class="p">)</span>
    
    <span class="c1"># Act: Executar opera√ß√£o</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">processador</span><span class="o">.</span><span class="n">calcular_total</span><span class="p">(</span><span class="n">produtos</span><span class="p">,</span> <span class="n">cliente</span><span class="p">)</span>
    
    <span class="c1"># Assert: Verificar resultado esperado</span>
    <span class="k">assert</span> <span class="n">total</span> <span class="o">==</span> <span class="mf">945.0</span>  <span class="c1"># 1100 - 15% desconto premium = 945</span>
</pre></div>
</div>
</section>
<section id="fase-green-implementacao-minima">
<h5><strong>2. Fase Green: Implementa√ß√£o M√≠nima</strong><a class="headerlink" href="#fase-green-implementacao-minima" title="Link to this heading">#</a></h5>
<p><strong>Objetivo:</strong> Fazer o teste passar com o <strong>m√≠nimo de c√≥digo poss√≠vel</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Implementa√ß√£o inicial (pode ter code smells tempor√°rios)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProcessadorPedido</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_total</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">produtos</span><span class="p">,</span> <span class="n">cliente</span><span class="p">):</span>
        <span class="n">subtotal</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">preco</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">quantidade</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">produtos</span><span class="p">)</span>
        
        <span class="c1"># Implementa√ß√£o simples para fazer o teste passar</span>
        <span class="k">if</span> <span class="n">cliente</span><span class="o">.</span><span class="n">tipo</span> <span class="o">==</span> <span class="s2">&quot;premium&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.85</span>  <span class="c1"># 15% desconto</span>
        <span class="k">return</span> <span class="n">subtotal</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Produto</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">preco</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nome</span> <span class="o">=</span> <span class="n">nome</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preco</span> <span class="o">=</span> <span class="n">preco</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantidade</span> <span class="o">=</span> <span class="n">quantidade</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Cliente</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tipo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;regular&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nome</span> <span class="o">=</span> <span class="n">nome</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipo</span> <span class="o">=</span> <span class="n">tipo</span>
</pre></div>
</div>
</section>
<section id="fase-refactor-melhoria-da-qualidade">
<h5><strong>3. Fase Refactor: Melhoria da Qualidade</strong><a class="headerlink" href="#fase-refactor-melhoria-da-qualidade" title="Link to this heading">#</a></h5>
<p><strong>Objetivo:</strong> Eliminar code smells mantendo os testes passando.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Refatora√ß√£o: Extract Method + Strategy Pattern</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CalculadoraDesconto</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DescontoPremium</span><span class="p">(</span><span class="n">CalculadoraDesconto</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.15</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DescontoRegular</span><span class="p">(</span><span class="n">CalculadoraDesconto</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ProcessadorPedido</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculadoras</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;premium&quot;</span><span class="p">:</span> <span class="n">DescontoPremium</span><span class="p">(),</span>
            <span class="s2">&quot;regular&quot;</span><span class="p">:</span> <span class="n">DescontoRegular</span><span class="p">()</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_total</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">produtos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Produto</span><span class="p">],</span> <span class="n">cliente</span><span class="p">:</span> <span class="n">Cliente</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">subtotal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calcular_subtotal</span><span class="p">(</span><span class="n">produtos</span><span class="p">)</span>
        <span class="n">desconto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calcular_desconto</span><span class="p">(</span><span class="n">subtotal</span><span class="p">,</span> <span class="n">cliente</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">subtotal</span> <span class="o">-</span> <span class="n">desconto</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calcular_subtotal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">produtos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Produto</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">preco</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">quantidade</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">produtos</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">cliente</span><span class="p">:</span> <span class="n">Cliente</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">calculadora</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculadoras</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cliente</span><span class="o">.</span><span class="n">tipo</span><span class="p">,</span> <span class="n">DescontoRegular</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">calculadora</span><span class="o">.</span><span class="n">calcular</span><span class="p">(</span><span class="n">subtotal</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="analise-quantitativa-metricas-tdd">
<h4>An√°lise Quantitativa: M√©tricas TDD<a class="headerlink" href="#analise-quantitativa-metricas-tdd" title="Link to this heading">#</a></h4>
<p><strong>Cobertura de Teste:</strong>
$<span class="math notranslate nohighlight">\(Coverage = \frac{Linhas\ Executadas\ pelos\ Testes}{Total\ de\ Linhas\ Execut√°veis} \times 100\)</span>$</p>
<p><strong>Ciclo Time (Dura√ß√£o m√©dia do ciclo Red-Green-Refactor):</strong>
$<span class="math notranslate nohighlight">\(Cycle\ Time = T_{red} + T_{green} + T_{refactor}\)</span>$</p>
<p><strong>M√©tricas ideais para TDD:</strong></p>
<ul class="simple">
<li><p><strong>Cobertura:</strong> &gt; 85%</p></li>
<li><p><strong>Cycle Time:</strong> &lt; 10 minutos</p></li>
<li><p><strong>Testes por Funcionalidade:</strong> 3-5 testes</p></li>
<li><p><strong>Assertion per Test:</strong> 1-3 assertions</p></li>
</ul>
</section>
<section id="analise-de-consequencias-tdd-vs-refatoracao-tradicional">
<h4>An√°lise de Consequ√™ncias: TDD vs. Refatora√ß√£o Tradicional<a class="headerlink" href="#analise-de-consequencias-tdd-vs-refatoracao-tradicional" title="Link to this heading">#</a></h4>
<p><strong>Vantagens do TDD para Refatora√ß√£o:</strong></p>
<ol class="arabic simple">
<li><p><strong>Rede de Seguran√ßa:</strong> Testes garantem que refatora√ß√£o n√£o quebra funcionalidades</p></li>
<li><p><strong>Design Emergente:</strong> TDD naturalmente leva a designs mais limpos</p></li>
<li><p><strong>Confian√ßa:</strong> Desenvolvedores refatoram mais quando t√™m testes</p></li>
<li><p><strong>Feedback R√°pido:</strong> Problemas s√£o detectados imediatamente</p></li>
</ol>
<p><strong>Compara√ß√£o Quantitativa:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>M√©trica</p></th>
<th class="head"><p>TDD + Refatora√ß√£o</p></th>
<th class="head"><p>Refatora√ß√£o sem TDD</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Bug Rate</strong></p></td>
<td><p>15-25 bugs/KLOC</p></td>
<td><p>35-55 bugs/KLOC</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Refactoring Frequency</strong></p></td>
<td><p>2-3x/sprint</p></td>
<td><p>0.5x/sprint</p></td>
</tr>
<tr class="row-even"><td><p><strong>Code Coverage</strong></p></td>
<td><p>85-95%</p></td>
<td><p>45-65%</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Development Speed</strong></p></td>
<td><p>-15% inicial, +30% manuten√ß√£o</p></td>
<td><p>Baseline</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="ferramentas-de-analise-estatica">
<h3>2.4. Ferramentas de An√°lise Est√°tica<a class="headerlink" href="#ferramentas-de-analise-estatica" title="Link to this heading">#</a></h3>
<section id="id3">
<h4>Terminologia Essencial e Defini√ß√µes Formais<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<p><strong>An√°lise Est√°tica</strong> √© um processo de examina√ß√£o de c√≥digo sem execut√°-lo, identificando potenciais defeitos, viola√ß√µes de estilo e problemas de qualidade atrav√©s de <strong>an√°lise sint√°tica</strong> e <strong>an√°lise sem√¢ntica</strong>. Formalmente, √© uma fun√ß√£o <span class="math notranslate nohighlight">\(A: AST \rightarrow Issues\)</span> onde <span class="math notranslate nohighlight">\(AST\)</span> √© a √Årvore de Sintaxe Abstrata e <span class="math notranslate nohighlight">\(Issues\)</span> √© um conjunto de problemas detectados.</p>
<p><strong>SonarCloud</strong> √© uma plataforma de <strong>Quality Gate</strong> que combina an√°lise est√°tica, m√©tricas de qualidade e integra√ß√£o com pipelines CI/CD. Implementa um modelo de <strong>qualidade cont√≠nua</strong> baseado em regras configur√°veis e thresholds din√¢micos.</p>
</section>
<section id="estrutura-conceitual-das-ferramentas">
<h4>Estrutura Conceitual das Ferramentas<a class="headerlink" href="#estrutura-conceitual-das-ferramentas" title="Link to this heading">#</a></h4>
<section id="pylint-analise-completa-de-qualidade">
<h5><strong>1. Pylint: An√°lise Completa de Qualidade</strong><a class="headerlink" href="#pylint-analise-completa-de-qualidade" title="Link to this heading">#</a></h5>
<p><strong>Objetivo:</strong> Verifica√ß√£o abrangente de <strong>conven√ß√µes</strong>, <strong>refatora√ß√µes necess√°rias</strong>, <strong>warnings</strong> e <strong>erros</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configura√ß√£o .pylintrc</span>
<span class="p">[</span><span class="n">MASTER</span><span class="p">]</span>
<span class="n">jobs</span><span class="o">=</span><span class="mi">4</span>
<span class="n">suggestion</span><span class="o">-</span><span class="n">mode</span><span class="o">=</span><span class="n">yes</span>

<span class="p">[</span><span class="n">MESSAGES</span> <span class="n">CONTROL</span><span class="p">]</span>
<span class="n">disable</span><span class="o">=</span><span class="n">missing</span><span class="o">-</span><span class="n">docstring</span><span class="p">,</span><span class="n">invalid</span><span class="o">-</span><span class="n">name</span>

<span class="p">[</span><span class="n">FORMAT</span><span class="p">]</span>
<span class="nb">max</span><span class="o">-</span><span class="n">line</span><span class="o">-</span><span class="n">length</span><span class="o">=</span><span class="mi">88</span>
<span class="nb">max</span><span class="o">-</span><span class="n">module</span><span class="o">-</span><span class="n">lines</span><span class="o">=</span><span class="mi">500</span>

<span class="p">[</span><span class="n">DESIGN</span><span class="p">]</span>
<span class="nb">max</span><span class="o">-</span><span class="n">args</span><span class="o">=</span><span class="mi">5</span>
<span class="nb">max</span><span class="o">-</span><span class="nb">locals</span><span class="o">=</span><span class="mi">15</span>
<span class="nb">max</span><span class="o">-</span><span class="n">returns</span><span class="o">=</span><span class="mi">6</span>
<span class="nb">max</span><span class="o">-</span><span class="n">branches</span><span class="o">=</span><span class="mi">12</span>
<span class="nb">max</span><span class="o">-</span><span class="n">statements</span><span class="o">=</span><span class="mi">50</span>
</pre></div>
</div>
<p><strong>Categorias de An√°lise:</strong></p>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>graph LR
    A[C√≥digo Python] --&gt; B[Pylint]
    B --&gt; C[Convention C: 8.5/10]
    B --&gt; D[Refactor R: 7.2/10]
    B --&gt; E[Warning W: 9.1/10]
    B --&gt; F[Error E: 10/10]
    B --&gt; G[Fatal F: 10/10]
</pre></div>
</div>
</section>
<section id="flake8-analise-de-estilo-e-qualidade">
<h5><strong>2. Flake8: An√°lise de Estilo e Qualidade</strong><a class="headerlink" href="#flake8-analise-de-estilo-e-qualidade" title="Link to this heading">#</a></h5>
<p><strong>Objetivo:</strong> Verifica√ß√£o de <strong>PEP 8</strong>, <strong>complexidade ciclom√°tica</strong> e <strong>erros de sintaxe</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configura√ß√£o setup.cfg</span>
<span class="p">[</span><span class="n">flake8</span><span class="p">]</span>
<span class="nb">max</span><span class="o">-</span><span class="n">line</span><span class="o">-</span><span class="n">length</span> <span class="o">=</span> <span class="mi">88</span>
<span class="nb">max</span><span class="o">-</span><span class="n">complexity</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">exclude</span> <span class="o">=</span> 
    <span class="o">.</span><span class="n">git</span><span class="p">,</span>
    <span class="n">__pycache__</span><span class="p">,</span>
    <span class="n">migrations</span><span class="p">,</span>
    <span class="o">.</span><span class="n">venv</span>
<span class="n">ignore</span> <span class="o">=</span> 
    <span class="n">E203</span><span class="p">,</span>  <span class="c1"># whitespace before &#39;:&#39;</span>
    <span class="n">W503</span><span class="p">,</span>  <span class="c1"># line break before binary operator</span>
</pre></div>
</div>
<p><strong>Plugins Recomendados:</strong></p>
<ul class="simple">
<li><p><strong>flake8-bugbear:</strong> Detecta bugs sutis</p></li>
<li><p><strong>flake8-complexity:</strong> An√°lise de complexidade avan√ßada</p></li>
<li><p><strong>flake8-docstrings:</strong> Valida√ß√£o de docstrings</p></li>
</ul>
</section>
<section id="sonarcloud-plataforma-integrada">
<h5><strong>3. SonarCloud: Plataforma Integrada</strong><a class="headerlink" href="#sonarcloud-plataforma-integrada" title="Link to this heading">#</a></h5>
<p><strong>Objetivo:</strong> <strong>Quality Gate</strong> automatizado com an√°lise multi-dimensional.</p>
<p><strong>Arquitetura de An√°lise:</strong></p>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>graph TD
    A[Push para Repository] --&gt; B[GitHub Action]
    B --&gt; C[SonarCloud Scanner]
    C --&gt; D[An√°lise de Qualidade]
    D --&gt; E{Quality Gate}
    E --&gt;|Pass| F[Merge Permitido]
    E --&gt;|Fail| G[Bloqueio do Merge]
    D --&gt; H[Dashboard de M√©tricas]
    H --&gt; I[Code Coverage]
    H --&gt; J[Duplica√ß√£o]
    H --&gt; K[Bugs/Vulnerabilidades]
    H --&gt; L[Code Smells]
</pre></div>
</div>
<p><strong>M√©tricas Principais do SonarCloud:</strong></p>
<ol class="arabic simple">
<li><p><strong>Bugs:</strong> Problemas que podem causar comportamento incorreto</p></li>
<li><p><strong>Vulnerabilidades:</strong> Problemas de seguran√ßa</p></li>
<li><p><strong>Code Smells:</strong> Problemas de manutenibilidade</p></li>
<li><p><strong>Coverage:</strong> Percentual de c√≥digo coberto por testes</p></li>
<li><p><strong>Duplica√ß√£o:</strong> Percentual de c√≥digo duplicado</p></li>
</ol>
<p><strong>Configura√ß√£o sonar-project.properties:</strong></p>
<div class="highlight-properties notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identifica√ß√£o do projeto</span>
<span class="na">sonar.projectKey</span><span class="o">=</span><span class="s">minha-empresa_sistema-ecommerce</span>
<span class="na">sonar.organization</span><span class="o">=</span><span class="s">minha-empresa</span>
<span class="na">sonar.projectName</span><span class="o">=</span><span class="s">Sistema E-commerce</span>
<span class="na">sonar.projectVersion</span><span class="o">=</span><span class="s">1.0</span>

<span class="c1"># Configura√ß√µes de an√°lise</span>
<span class="na">sonar.sources</span><span class="o">=</span><span class="s">src/</span>
<span class="na">sonar.tests</span><span class="o">=</span><span class="s">tests/</span>
<span class="na">sonar.python.coverage.reportPaths</span><span class="o">=</span><span class="s">coverage.xml</span>
<span class="na">sonar.python.xunit.reportPath</span><span class="o">=</span><span class="s">pytest-report.xml</span>

<span class="c1"># Exclus√µes</span>
<span class="na">sonar.exclusions</span><span class="o">=</span><span class="s">**/*_pb2.py,**/migrations/**,**/venv/**</span>

<span class="c1"># Quality Gate customizado</span>
<span class="na">sonar.qualitygate.wait</span><span class="o">=</span><span class="s">true</span>
</pre></div>
</div>
</section>
</section>
<section id="id4">
<h4>An√°lise Quantitativa: M√©tricas de Qualidade<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<p><strong>Debt Ratio (Taxa de D√©bito T√©cnico):</strong>
$<span class="math notranslate nohighlight">\(Debt\ Ratio = \frac{Remediation\ Effort}{Development\ Cost} \times 100\)</span>$</p>
<p><strong>Maintainability Index:</strong>
$<span class="math notranslate nohighlight">\(MI = 171 - 5.2 \times \ln(V) - 0.23 \times G - 16.2 \times \ln(LOC)\)</span>$</p>
<p>Onde:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(V\)</span> = Volume de Halstead</p></li>
<li><p><span class="math notranslate nohighlight">\(G\)</span> = Complexidade ciclom√°tica</p></li>
<li><p><span class="math notranslate nohighlight">\(LOC\)</span> = Linhas de c√≥digo</p></li>
</ul>
<p><strong>Thresholds Recomendados:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>M√©trica</p></th>
<th class="head"><p>Excelente</p></th>
<th class="head"><p>Bom</p></th>
<th class="head"><p>Aceit√°vel</p></th>
<th class="head"><p>Problem√°tico</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Coverage</strong></p></td>
<td><p>&gt; 90%</p></td>
<td><p>80-90%</p></td>
<td><p>70-80%</p></td>
<td><p>&lt; 70%</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Duplica√ß√£o</strong></p></td>
<td><p>&lt; 3%</p></td>
<td><p>3-5%</p></td>
<td><p>5-10%</p></td>
<td><p>&gt; 10%</p></td>
</tr>
<tr class="row-even"><td><p><strong>Debt Ratio</strong></p></td>
<td><p>&lt; 5%</p></td>
<td><p>5-10%</p></td>
<td><p>10-20%</p></td>
<td><p>&gt; 20%</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Bugs/KLOC</strong></p></td>
<td><p>&lt; 5</p></td>
<td><p>5-10</p></td>
<td><p>10-20</p></td>
<td><p>&gt; 20</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="analise-critica-limitacoes-e-falsos-positivos">
<h4>An√°lise Cr√≠tica: Limita√ß√µes e Falsos Positivos<a class="headerlink" href="#analise-critica-limitacoes-e-falsos-positivos" title="Link to this heading">#</a></h4>
<p><strong>Limita√ß√µes das Ferramentas:</strong></p>
<ol class="arabic simple">
<li><p><strong>Context Blindness:</strong> Ferramentas n√£o entendem contexto de neg√≥cio</p></li>
<li><p><strong>False Positives:</strong> Regras podem n√£o aplicar a dom√≠nios espec√≠ficos</p></li>
<li><p><strong>Performance Overhead:</strong> An√°lise pode ser lenta em projetos grandes</p></li>
<li><p><strong>Rule Fatigue:</strong> Excesso de regras pode gerar ru√≠do</p></li>
</ol>
<p><strong>Estrat√©gias de Mitiga√ß√£o:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supress√£o seletiva de warnings</span>
<span class="k">def</span><span class="w"> </span><span class="nf">legacy_function</span><span class="p">():</span>  <span class="c1"># pylint: disable=too-many-locals</span>
    <span class="c1"># C√≥digo legacy que n√£o vale a pena refatorar</span>
    <span class="k">pass</span>

<span class="c1"># NOSONAR para SonarCloud</span>
<span class="k">def</span><span class="w"> </span><span class="nf">special_case</span><span class="p">():</span>
    <span class="n">complex_logic</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># NOSONAR - complexidade justificada pelo dom√≠nio</span>
</pre></div>
</div>
<p><strong>Configura√ß√£o Progressiva:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fase 1: Regras essenciais (2 semanas)</span>
<span class="n">BASIC_RULES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;bugs&quot;</span><span class="p">,</span> <span class="s2">&quot;vulnerabilities&quot;</span><span class="p">,</span> <span class="s2">&quot;critical-code-smells&quot;</span><span class="p">]</span>

<span class="c1"># Fase 2: Qualidade intermedi√°ria (1 m√™s)  </span>
<span class="n">INTERMEDIATE_RULES</span> <span class="o">=</span> <span class="n">BASIC_RULES</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;major-code-smells&quot;</span><span class="p">,</span> <span class="s2">&quot;coverage&quot;</span><span class="p">]</span>

<span class="c1"># Fase 3: Qualidade avan√ßada (3 meses)</span>
<span class="n">ADVANCED_RULES</span> <span class="o">=</span> <span class="n">INTERMEDIATE_RULES</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;minor-code-smells&quot;</span><span class="p">,</span> <span class="s2">&quot;duplications&quot;</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="integracao-com-pipelines-ci-cd">
<h3>2.5. Integra√ß√£o com Pipelines CI/CD<a class="headerlink" href="#integracao-com-pipelines-ci-cd" title="Link to this heading">#</a></h3>
<section id="id5">
<h4>Terminologia Essencial e Defini√ß√µes Formais<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<p><strong>Quality Gate</strong> √© um conjunto de <strong>condi√ß√µes booleanas</strong> aplicadas a m√©tricas de qualidade que determinam se o c√≥digo pode prosseguir no pipeline de deployment. Formalmente, um Quality Gate √© uma fun√ß√£o <span class="math notranslate nohighlight">\(QG: Metrics \rightarrow \{Pass, Fail\}\)</span> onde cada m√©trica <span class="math notranslate nohighlight">\(m_i\)</span> deve satisfazer <span class="math notranslate nohighlight">\(m_i \geq threshold_i\)</span>.</p>
<p><strong>Shift-Left Testing</strong> √© a pr√°tica de mover verifica√ß√µes de qualidade para <strong>est√°gios anteriores</strong> do pipeline, reduzindo o custo de corre√ß√£o de defeitos atrav√©s da <strong>detec√ß√£o precoce</strong>.</p>
</section>
<section id="estrutura-conceitual-da-integracao">
<h4>Estrutura Conceitual da Integra√ß√£o<a class="headerlink" href="#estrutura-conceitual-da-integracao" title="Link to this heading">#</a></h4>
<section id="pipeline-de-qualidade-em-multiplas-camadas">
<h5><strong>1. Pipeline de Qualidade em M√∫ltiplas Camadas</strong><a class="headerlink" href="#pipeline-de-qualidade-em-multiplas-camadas" title="Link to this heading">#</a></h5>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>graph TD
    A[Developer Commit] --&gt; B[Pre-commit Hooks]
    B --&gt; C[Fast Quality Checks]
    C --&gt; D[Unit Tests]
    D --&gt; E[Static Analysis]
    E --&gt; F[Integration Tests]
    F --&gt; G[SonarCloud Analysis]
    G --&gt; H{Quality Gate}
    H --&gt;|Pass| I[Build &amp; Deploy]
    H --&gt;|Fail| J[Block Merge]
    
    subgraph &quot;Shift-Left Strategy&quot;
        B
        C
        D
    end
    
    subgraph &quot;Comprehensive Analysis&quot;
        E
        F
        G
    end
</pre></div>
</div>
</section>
<section id="configuracao-github-actions-completa">
<h5><strong>2. Configura√ß√£o GitHub Actions Completa</strong><a class="headerlink" href="#configuracao-github-actions-completa" title="Link to this heading">#</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># .github/workflows/quality-gate.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Quality Gate Pipeline</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">develop</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">]</span>

<span class="nt">env</span><span class="p">:</span>
<span class="w">  </span><span class="nt">PYTHON_VERSION</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.12&#39;</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Job 1: Fast Feedback (&lt; 2 minutos)</span>
<span class="w">  </span><span class="nt">fast-checks</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Fast Quality Checks</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">timeout-minutes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Python</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.PYTHON_VERSION }}</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cache dependencies</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/cache@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.cache/pip</span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ runner.os }}-pip-${{ hashFiles(&#39;requirements.txt&#39;) }}</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip install -r requirements.txt</span>
<span class="w">          </span><span class="no">pip install flake8 pylint black isort</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Code formatting check</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">black --check src/ tests/</span>
<span class="w">          </span><span class="no">isort --check-only src/ tests/</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Basic linting</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">flake8 src/ tests/ --max-complexity=10</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Type checking</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">mypy src/ --ignore-missing-imports</span>

<span class="w">  </span><span class="c1"># Job 2: Comprehensive Analysis (&lt; 10 minutos)</span>
<span class="w">  </span><span class="nt">comprehensive-analysis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Comprehensive Quality Analysis</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fast-checks</span>
<span class="w">    </span><span class="nt">timeout-minutes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="w">    </span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">fetch-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">  </span><span class="c1"># Shallow clones should be disabled for better analysis</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Python</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v4</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ env.PYTHON_VERSION }}</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pip install -r requirements.txt</span>
<span class="w">          </span><span class="no">pip install pytest pytest-cov pytest-xdist pylint bandit safety</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run comprehensive tests</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pytest tests/ \</span>
<span class="w">            </span><span class="no">--cov=src \</span>
<span class="w">            </span><span class="no">--cov-report=xml \</span>
<span class="w">            </span><span class="no">--cov-report=html \</span>
<span class="w">            </span><span class="no">--junitxml=pytest-report.xml \</span>
<span class="w">            </span><span class="no">--cov-fail-under=80 \</span>
<span class="w">            </span><span class="no">-n auto</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Security analysis</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">bandit -r src/ -f json -o bandit-report.json</span>
<span class="w">          </span><span class="no">safety check --json --output safety-report.json</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Advanced linting</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">pylint src/ --output-format=json &gt; pylint-report.json || true</span>
<span class="w">      </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SonarCloud Scan</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SonarSource/sonarcloud-github-action@master</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">GITHUB_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.GITHUB_TOKEN }}</span>
<span class="w">          </span><span class="nt">SONAR_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.SONAR_TOKEN }}</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
<span class="w">            </span><span class="no">-Dsonar.python.coverage.reportPaths=coverage.xml</span>
<span class="w">            </span><span class="no">-Dsonar.python.xunit.reportPath=pytest-report.xml</span>
<span class="w">            </span><span class="no">-Dsonar.python.pylint.reportPaths=pylint-report.json</span>
<span class="w">            </span><span class="no">-Dsonar.python.bandit.reportPaths=bandit-report.json</span>

<span class="w">  </span><span class="c1"># Job 3: Quality Gate Decision</span>
<span class="w">  </span><span class="nt">quality-gate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Quality Gate Decision</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">comprehensive-analysis</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always()</span>
<span class="w">    </span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check Quality Gate Status</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no"># Aguardar resultado do SonarCloud</span>
<span class="w">          </span><span class="no">sleep 30</span>
<span class="w">          </span>
<span class="w">          </span><span class="no"># Verificar status via API (opcional)</span>
<span class="w">          </span><span class="no">curl -u ${{ secrets.SONAR_TOKEN }}: \</span>
<span class="w">            </span><span class="no">&quot;https://sonarcloud.io/api/qualitygates/project_status?projectKey=${{ secrets.SONAR_PROJECT_KEY }}&quot; \</span>
<span class="w">            </span><span class="no">| jq &#39;.projectStatus.status == &quot;OK&quot;&#39;</span>

<span class="w">  </span><span class="c1"># Job 4: Deployment (apenas se Quality Gate passar)</span>
<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to Staging</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quality-gate</span>
<span class="w">    </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.ref == &#39;refs/heads/main&#39;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class="w">    </span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy application</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">echo &quot;Deploying to staging environment...&quot;</span>
<span class="w">          </span><span class="no"># L√≥gica de deployment aqui</span>
</pre></div>
</div>
</section>
<section id="quality-gate-customizado">
<h5><strong>3. Quality Gate Customizado</strong><a class="headerlink" href="#quality-gate-customizado" title="Link to this heading">#</a></h5>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;qualityGate&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Custom Quality Gate&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;conditions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;metric&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;new_coverage&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;operator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GREATER_THAN&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;80&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;metric&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;new_duplicated_lines_density&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nt">&quot;operator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LESS_THAN&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;metric&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;new_bugs&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;operator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EQUALS&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;metric&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;new_vulnerabilities&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;operator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EQUALS&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;metric&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;new_blocker_violations&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;operator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EQUALS&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;metric&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;new_critical_violations&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;operator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EQUALS&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="analise-de-consequencias-impacto-na-velocidade-vs-qualidade">
<h4>An√°lise de Consequ√™ncias: Impacto na Velocidade vs. Qualidade<a class="headerlink" href="#analise-de-consequencias-impacto-na-velocidade-vs-qualidade" title="Link to this heading">#</a></h4>
<p><strong>Trade-off Temporal:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Etapa</p></th>
<th class="head"><p>Tempo M√©dio</p></th>
<th class="head"><p>Valor Agregado</p></th>
<th class="head"><p>Custo de Falha</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Pre-commit</strong></p></td>
<td><p>30s</p></td>
<td><p>Feedback imediato</p></td>
<td><p>Baixo (local)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Fast Checks</strong></p></td>
<td><p>2min</p></td>
<td><p>Valida√ß√£o b√°sica</p></td>
<td><p>Baixo (CI)</p></td>
</tr>
<tr class="row-even"><td><p><strong>Comprehensive</strong></p></td>
<td><p>10min</p></td>
<td><p>An√°lise profunda</p></td>
<td><p>M√©dio (pipeline)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Quality Gate</strong></p></td>
<td><p>1min</p></td>
<td><p>Decis√£o final</p></td>
<td><p>Alto (produ√ß√£o)</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>ROI da Integra√ß√£o:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">calcular_roi_quality_gate</span><span class="p">(</span>
    <span class="n">bugs_evitados_mes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">custo_bug_producao</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">tempo_pipeline_adicional</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">custo_hora_desenvolvedor</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    
    <span class="c1"># Benef√≠cios mensais</span>
    <span class="n">economia_bugs</span> <span class="o">=</span> <span class="n">bugs_evitados_mes</span> <span class="o">*</span> <span class="n">custo_bug_producao</span>
    
    <span class="c1"># Custos mensais  </span>
    <span class="n">custo_tempo_adicional</span> <span class="o">=</span> <span class="n">tempo_pipeline_adicional</span> <span class="o">*</span> <span class="n">custo_hora_desenvolvedor</span> <span class="o">*</span> <span class="mi">22</span> <span class="o">*</span> <span class="mi">8</span>
    
    <span class="n">roi_mensal</span> <span class="o">=</span> <span class="p">(</span><span class="n">economia_bugs</span> <span class="o">-</span> <span class="n">custo_tempo_adicional</span><span class="p">)</span> <span class="o">/</span> <span class="n">custo_tempo_adicional</span> <span class="o">*</span> <span class="mi">100</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;economia_mensal&quot;</span><span class="p">:</span> <span class="n">economia_bugs</span><span class="p">,</span>
        <span class="s2">&quot;custo_adicional&quot;</span><span class="p">:</span> <span class="n">custo_tempo_adicional</span><span class="p">,</span>
        <span class="s2">&quot;roi_percentual&quot;</span><span class="p">:</span> <span class="n">roi_mensal</span><span class="p">,</span>
        <span class="s2">&quot;break_even_meses&quot;</span><span class="p">:</span> <span class="n">custo_tempo_adicional</span> <span class="o">/</span> <span class="n">economia_bugs</span> <span class="k">if</span> <span class="n">economia_bugs</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<span class="c1"># Exemplo pr√°tico</span>
<span class="n">resultado</span> <span class="o">=</span> <span class="n">calcular_roi_quality_gate</span><span class="p">(</span>
    <span class="n">bugs_evitados_mes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">custo_bug_producao</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>  <span class="c1"># R$ 2000 por bug</span>
    <span class="n">tempo_pipeline_adicional</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># 30min por pipeline</span>
    <span class="n">custo_hora_desenvolvedor</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ROI: </span><span class="si">{</span><span class="n">resultado</span><span class="p">[</span><span class="s1">&#39;roi_percentual&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="c1"># Output: ROI: 227.3%</span>
</pre></div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="aplicacao-pratica-e-implementacao">
<h2>3. Aplica√ß√£o Pr√°tica e Implementa√ß√£o<a class="headerlink" href="#aplicacao-pratica-e-implementacao" title="Link to this heading">#</a></h2>
<section id="estudo-de-caso-guiado-sistema-de-e-commerce">
<h3>3.1. Estudo de Caso Guiado: Sistema de E-commerce<a class="headerlink" href="#estudo-de-caso-guiado-sistema-de-e-commerce" title="Link to this heading">#</a></h3>
<p>Nesta se√ß√£o, conduziremos uma <strong>refatora√ß√£o completa</strong> de um sistema de e-commerce real que apresenta m√∫ltiplos code smells. O sistema ser√° transformado passo a passo, demonstrando na pr√°tica todas as t√©cnicas e ferramentas abordadas na teoria.</p>
<section id="passo-1-analise-inicial-do-sistema-problematico">
<h4>Passo 1: An√°lise Inicial do Sistema Problem√°tico<a class="headerlink" href="#passo-1-analise-inicial-do-sistema-problematico" title="Link to this heading">#</a></h4>
<p><strong>Cen√°rio:</strong> C√≥digo legado de um sistema de e-commerce desenvolvido rapidamente durante a pandemia. O sistema funciona, mas apresenta s√©rios problemas de manutenibilidade.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># sistema_ecommerce_original.py - ANTES DA REFATORA√á√ÉO</span>
<span class="c1"># ATEN√á√ÉO: Este c√≥digo cont√©m m√∫ltiplos code smells intencionalmente</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SistemaEcommerce</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PROBLEMA: God Class - uma √∫nica classe com m√∫ltiplas responsabilidades</span>
<span class="sd">    - Gerenciamento de produtos</span>
<span class="sd">    - Processamento de pedidos  </span>
<span class="sd">    - C√°lculo de pre√ßos e descontos</span>
<span class="sd">    - Valida√ß√£o de dados</span>
<span class="sd">    - Persist√™ncia de dados</span>
<span class="sd">    - Envio de emails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produtos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clientes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pedidos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configuracoes</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">processar_pedido_completo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados_pedido</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PROBLEMA: Long Method - m√©todo com mais de 80 linhas</span>
<span class="sd">        PROBLEMA: High Cyclomatic Complexity - m√∫ltiplos if/elif aninhados</span>
<span class="sd">        PROBLEMA: Long Parameter List - deveria receber objetos, n√£o dicion√°rios</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Valida√ß√£o de dados (15 linhas)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dados_pedido</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Dados do pedido n√£o fornecidos&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="s2">&quot;cliente_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dados_pedido</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Cliente n√£o identificado&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="s2">&quot;produtos&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dados_pedido</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;produtos&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Nenhum produto no pedido&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="s2">&quot;forma_pagamento&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dados_pedido</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Forma de pagamento n√£o especificada&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="s2">&quot;endereco_entrega&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dados_pedido</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Endere√ßo de entrega n√£o fornecido&quot;</span><span class="p">}</span>
            
        <span class="n">cliente_id</span> <span class="o">=</span> <span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;cliente_id&quot;</span><span class="p">]</span>
        <span class="n">produtos_pedido</span> <span class="o">=</span> <span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;produtos&quot;</span><span class="p">]</span>
        <span class="n">forma_pagamento</span> <span class="o">=</span> <span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;forma_pagamento&quot;</span><span class="p">]</span>
        <span class="n">endereco</span> <span class="o">=</span> <span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;endereco_entrega&quot;</span><span class="p">]</span>
        
        <span class="c1"># Buscar cliente (10 linhas)</span>
        <span class="n">cliente</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clientes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cliente_id</span><span class="p">:</span>
                <span class="n">cliente</span> <span class="o">=</span> <span class="n">c</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cliente</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Cliente n√£o encontrado&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;ativo&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Cliente inativo&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;bloqueado&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Cliente bloqueado&quot;</span><span class="p">}</span>
            
        <span class="c1"># Calcular total do pedido (25 linhas)</span>
        <span class="n">total_pedido</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">itens_validos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">produtos_pedido</span><span class="p">:</span>
            <span class="n">produto_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;produto_id&quot;</span><span class="p">]</span>
            <span class="n">quantidade</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;quantidade&quot;</span><span class="p">]</span>
            
            <span class="c1"># Buscar produto</span>
            <span class="n">produto</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">produtos</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">produto_id</span><span class="p">:</span>
                    <span class="n">produto</span> <span class="o">=</span> <span class="n">p</span>
                    <span class="k">break</span>
                    
            <span class="k">if</span> <span class="ow">not</span> <span class="n">produto</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Produto </span><span class="si">{</span><span class="n">produto_id</span><span class="si">}</span><span class="s2"> n√£o encontrado&quot;</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">produto</span><span class="p">[</span><span class="s2">&quot;estoque&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">quantidade</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Estoque insuficiente para </span><span class="si">{</span><span class="n">produto</span><span class="p">[</span><span class="s1">&#39;nome&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">produto</span><span class="p">[</span><span class="s2">&quot;ativo&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Produto </span><span class="si">{</span><span class="n">produto</span><span class="p">[</span><span class="s1">&#39;nome&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> n√£o est√° ativo&quot;</span><span class="p">}</span>
                
            <span class="n">preco_unitario</span> <span class="o">=</span> <span class="n">produto</span><span class="p">[</span><span class="s2">&quot;preco&quot;</span><span class="p">]</span>
            <span class="n">subtotal</span> <span class="o">=</span> <span class="n">preco_unitario</span> <span class="o">*</span> <span class="n">quantidade</span>
            
            <span class="c1"># Aplicar desconto baseado no tipo de cliente</span>
            <span class="k">if</span> <span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;tipo&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;premium&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">subtotal</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="n">desconto</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.15</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">desconto</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.10</span>
            <span class="k">elif</span> <span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;tipo&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;vip&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">subtotal</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
                    <span class="n">desconto</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.25</span>
                <span class="k">elif</span> <span class="n">subtotal</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                    <span class="n">desconto</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.20</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">desconto</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.15</span>
            <span class="k">elif</span> <span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;tipo&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;corporativo&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">quantidade</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="n">desconto</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.30</span>
                <span class="k">elif</span> <span class="n">quantidade</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                    <span class="n">desconto</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.25</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">desconto</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.20</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">desconto</span> <span class="o">=</span> <span class="mi">0</span>
                
            <span class="n">preco_final</span> <span class="o">=</span> <span class="n">subtotal</span> <span class="o">-</span> <span class="n">desconto</span>
            <span class="n">total_pedido</span> <span class="o">+=</span> <span class="n">preco_final</span>
            
            <span class="n">itens_validos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;produto_id&quot;</span><span class="p">:</span> <span class="n">produto_id</span><span class="p">,</span>
                <span class="s2">&quot;nome&quot;</span><span class="p">:</span> <span class="n">produto</span><span class="p">[</span><span class="s2">&quot;nome&quot;</span><span class="p">],</span>
                <span class="s2">&quot;quantidade&quot;</span><span class="p">:</span> <span class="n">quantidade</span><span class="p">,</span>
                <span class="s2">&quot;preco_unitario&quot;</span><span class="p">:</span> <span class="n">preco_unitario</span><span class="p">,</span>
                <span class="s2">&quot;subtotal&quot;</span><span class="p">:</span> <span class="n">subtotal</span><span class="p">,</span>
                <span class="s2">&quot;desconto&quot;</span><span class="p">:</span> <span class="n">desconto</span><span class="p">,</span>
                <span class="s2">&quot;preco_final&quot;</span><span class="p">:</span> <span class="n">preco_final</span>
            <span class="p">})</span>
            
        <span class="c1"># Calcular frete (8 linhas)</span>
        <span class="k">if</span> <span class="n">endereco</span><span class="p">[</span><span class="s2">&quot;estado&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;SP&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">total_pedido</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">frete</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">frete</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="k">elif</span> <span class="n">endereco</span><span class="p">[</span><span class="s2">&quot;estado&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RJ&quot;</span><span class="p">,</span> <span class="s2">&quot;MG&quot;</span><span class="p">,</span> <span class="s2">&quot;ES&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">total_pedido</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
                <span class="n">frete</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">frete</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">total_pedido</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
                <span class="n">frete</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">frete</span> <span class="o">=</span> <span class="mi">35</span>
                
        <span class="n">total_final</span> <span class="o">=</span> <span class="n">total_pedido</span> <span class="o">+</span> <span class="n">frete</span>
        
        <span class="c1"># Processar pagamento (15 linhas)</span>
        <span class="k">if</span> <span class="n">forma_pagamento</span> <span class="o">==</span> <span class="s2">&quot;cartao_credito&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;limite_credito&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">total_final</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Limite de cr√©dito insuficiente&quot;</span><span class="p">}</span>
            <span class="c1"># Simular processamento do cart√£o</span>
            <span class="k">if</span> <span class="n">total_final</span> <span class="o">&gt;</span> <span class="mi">5000</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;pre_aprovado&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Transa√ß√£o requer pr√©-aprova√ß√£o&quot;</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">forma_pagamento</span> <span class="o">==</span> <span class="s2">&quot;cartao_debito&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;saldo_conta&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">total_final</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Saldo insuficiente&quot;</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">forma_pagamento</span> <span class="o">==</span> <span class="s2">&quot;pix&quot;</span><span class="p">:</span>
            <span class="c1"># PIX sempre aprovado</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">forma_pagamento</span> <span class="o">==</span> <span class="s2">&quot;boleto&quot;</span><span class="p">:</span>
            <span class="c1"># Boleto sempre aprovado, mas com prazo</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="s2">&quot;Forma de pagamento inv√°lida&quot;</span><span class="p">}</span>
            
        <span class="c1"># Atualizar estoque (8 linhas)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itens_validos</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">produto</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">produtos</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">produto</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;produto_id&quot;</span><span class="p">]:</span>
                    <span class="n">produto</span><span class="p">[</span><span class="s2">&quot;estoque&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;quantidade&quot;</span><span class="p">]</span>
                    <span class="k">break</span>
                    
        <span class="c1"># Criar pedido (10 linhas)</span>
        <span class="n">pedido_id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pedidos</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">pedido</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">pedido_id</span><span class="p">,</span>
            <span class="s2">&quot;cliente_id&quot;</span><span class="p">:</span> <span class="n">cliente_id</span><span class="p">,</span>
            <span class="s2">&quot;itens&quot;</span><span class="p">:</span> <span class="n">itens_validos</span><span class="p">,</span>
            <span class="s2">&quot;total_produtos&quot;</span><span class="p">:</span> <span class="n">total_pedido</span><span class="p">,</span>
            <span class="s2">&quot;frete&quot;</span><span class="p">:</span> <span class="n">frete</span><span class="p">,</span>
            <span class="s2">&quot;total_final&quot;</span><span class="p">:</span> <span class="n">total_final</span><span class="p">,</span>
            <span class="s2">&quot;forma_pagamento&quot;</span><span class="p">:</span> <span class="n">forma_pagamento</span><span class="p">,</span>
            <span class="s2">&quot;endereco_entrega&quot;</span><span class="p">:</span> <span class="n">endereco</span><span class="p">,</span>
            <span class="s2">&quot;data_criacao&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;confirmado&quot;</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pedidos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pedido</span><span class="p">)</span>
        
        <span class="c1"># Enviar email de confirma√ß√£o (simulado)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enviar_email_confirmacao</span><span class="p">(</span><span class="n">cliente</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">],</span> <span class="n">pedido</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;sucesso&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;pedido_id&quot;</span><span class="p">:</span> <span class="n">pedido_id</span><span class="p">,</span>
            <span class="s2">&quot;total_final&quot;</span><span class="p">:</span> <span class="n">total_final</span><span class="p">,</span>
            <span class="s2">&quot;prazo_entrega&quot;</span><span class="p">:</span> <span class="s2">&quot;3-5 dias √∫teis&quot;</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">enviar_email_confirmacao</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pedido</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PROBLEMA: Feature Envy - m√©todo que deveria estar em uma classe de Email</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assunto</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Pedido #</span><span class="si">{</span><span class="n">pedido</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> confirmado&quot;</span>
        <span class="n">corpo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Ol√°!</span>
<span class="s2">        </span>
<span class="s2">        Seu pedido #</span><span class="si">{</span><span class="n">pedido</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> foi confirmado com sucesso.</span>
<span class="s2">        Total: R$ </span><span class="si">{</span><span class="n">pedido</span><span class="p">[</span><span class="s1">&#39;total_final&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span>
<span class="s2">        </span>
<span class="s2">        Prazo de entrega: 3-5 dias √∫teis</span>
<span class="s2">        </span>
<span class="s2">        Obrigado pela prefer√™ncia!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EMAIL ENVIADO PARA: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ASSUNTO: </span><span class="si">{</span><span class="n">assunto</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CORPO: </span><span class="si">{</span><span class="n">corpo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">adicionar_produto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">preco</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">estoque</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">categoria</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PROBLEMA: Data Clumps - sempre passamos os mesmos par√¢metros juntos</span>
<span class="sd">        PROBLEMA: Primitive Obsession - usando tipos primitivos em vez de objetos</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">produto_id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">produtos</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">produto</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">produto_id</span><span class="p">,</span>
            <span class="s2">&quot;nome&quot;</span><span class="p">:</span> <span class="n">nome</span><span class="p">,</span>
            <span class="s2">&quot;preco&quot;</span><span class="p">:</span> <span class="n">preco</span><span class="p">,</span>
            <span class="s2">&quot;estoque&quot;</span><span class="p">:</span> <span class="n">estoque</span><span class="p">,</span>
            <span class="s2">&quot;categoria&quot;</span><span class="p">:</span> <span class="n">categoria</span><span class="p">,</span>
            <span class="s2">&quot;ativo&quot;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produtos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">produto</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">produto_id</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">adicionar_cliente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tipo</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limite_credito</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PROBLEMA: Data Clumps - par√¢metros sempre passados juntos</span>
<span class="sd">        PROBLEMA: Switch Statement - l√≥gica baseada em tipo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cliente_id</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clientes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        
        <span class="c1"># Configurar limites baseado no tipo</span>
        <span class="k">if</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s2">&quot;premium&quot;</span><span class="p">:</span>
            <span class="n">limite_padrao</span> <span class="o">=</span> <span class="mi">5000</span>
            <span class="n">desconto_padrao</span> <span class="o">=</span> <span class="mf">0.10</span>
        <span class="k">elif</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s2">&quot;vip&quot;</span><span class="p">:</span>
            <span class="n">limite_padrao</span> <span class="o">=</span> <span class="mi">15000</span>
            <span class="n">desconto_padrao</span> <span class="o">=</span> <span class="mf">0.15</span>
        <span class="k">elif</span> <span class="n">tipo</span> <span class="o">==</span> <span class="s2">&quot;corporativo&quot;</span><span class="p">:</span>
            <span class="n">limite_padrao</span> <span class="o">=</span> <span class="mi">50000</span>
            <span class="n">desconto_padrao</span> <span class="o">=</span> <span class="mf">0.20</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">limite_padrao</span> <span class="o">=</span> <span class="mi">1000</span>
            <span class="n">desconto_padrao</span> <span class="o">=</span> <span class="mf">0.0</span>
            
        <span class="n">cliente</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">cliente_id</span><span class="p">,</span>
            <span class="s2">&quot;nome&quot;</span><span class="p">:</span> <span class="n">nome</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;tipo&quot;</span><span class="p">:</span> <span class="n">tipo</span><span class="p">,</span>
            <span class="s2">&quot;limite_credito&quot;</span><span class="p">:</span> <span class="n">limite_credito</span> <span class="ow">or</span> <span class="n">limite_padrao</span><span class="p">,</span>
            <span class="s2">&quot;desconto_padrao&quot;</span><span class="p">:</span> <span class="n">desconto_padrao</span><span class="p">,</span>
            <span class="s2">&quot;ativo&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;bloqueado&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;saldo_conta&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;pre_aprovado&quot;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clientes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cliente</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cliente_id</span>

<span class="c1"># C√≥digo de teste para demonstrar o uso</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sistema</span> <span class="o">=</span> <span class="n">SistemaEcommerce</span><span class="p">()</span>
    
    <span class="c1"># Adicionar produtos</span>
    <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_produto</span><span class="p">(</span><span class="s2">&quot;Notebook Dell&quot;</span><span class="p">,</span> <span class="mf">2500.00</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Eletr√¥nicos&quot;</span><span class="p">)</span>
    <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_produto</span><span class="p">(</span><span class="s2">&quot;Mouse Logitech&quot;</span><span class="p">,</span> <span class="mf">50.00</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Perif√©ricos&quot;</span><span class="p">)</span>
    
    <span class="c1"># Adicionar cliente</span>
    <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_cliente</span><span class="p">(</span><span class="s2">&quot;Jo√£o Silva&quot;</span><span class="p">,</span> <span class="s2">&quot;joao@email.com&quot;</span><span class="p">,</span> <span class="s2">&quot;premium&quot;</span><span class="p">)</span>
    
    <span class="c1"># Processar pedido</span>
    <span class="n">dados_pedido</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;cliente_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;produtos&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;produto_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;quantidade&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;produto_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;quantidade&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;forma_pagamento&quot;</span><span class="p">:</span> <span class="s2">&quot;cartao_credito&quot;</span><span class="p">,</span>
        <span class="s2">&quot;endereco_entrega&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;rua&quot;</span><span class="p">:</span> <span class="s2">&quot;Rua das Flores, 123&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cidade&quot;</span><span class="p">:</span> <span class="s2">&quot;S√£o Paulo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;estado&quot;</span><span class="p">:</span> <span class="s2">&quot;SP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cep&quot;</span><span class="p">:</span> <span class="s2">&quot;01234-567&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="n">resultado</span> <span class="o">=</span> <span class="n">sistema</span><span class="o">.</span><span class="n">processar_pedido_completo</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">resultado</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="passo-2-identificacao-e-catalogacao-dos-code-smells">
<h4>Passo 2: Identifica√ß√£o e Cataloga√ß√£o dos Code Smells<a class="headerlink" href="#passo-2-identificacao-e-catalogacao-dos-code-smells" title="Link to this heading">#</a></h4>
<p><strong>An√°lise Detalhada dos Problemas Detectados:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># analise_code_smells.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RELAT√ìRIO DE CODE SMELLS IDENTIFICADOS:</span>

<span class="sd">1. GOD CLASS (SistemaEcommerce)</span>
<span class="sd">   - Responsabilidades: gest√£o produtos, clientes, pedidos, pagamento, email</span>
<span class="sd">   - M√©tricas: 150+ linhas, 20+ m√©todos, 10+ atributos</span>
<span class="sd">   - Impacto: Alta complexidade, dif√≠cil manuten√ß√£o</span>

<span class="sd">2. LONG METHOD (processar_pedido_completo)</span>
<span class="sd">   - M√©tricas: 80+ linhas, complexidade ciclom√°tica = 15</span>
<span class="sd">   - Problemas: M√∫ltiplas responsabilidades em um m√©todo</span>

<span class="sd">3. LONG PARAMETER LIST (m√∫ltiplos m√©todos)</span>
<span class="sd">   - adicionar_produto: 4+ par√¢metros primitivos</span>
<span class="sd">   - adicionar_cliente: 4+ par√¢metros primitivos</span>

<span class="sd">4. DATA CLUMPS</span>
<span class="sd">   - Dados de produto sempre passados juntos</span>
<span class="sd">   - Dados de cliente sempre passados juntos</span>
<span class="sd">   - Dados de endere√ßo sempre passados juntos</span>

<span class="sd">5. PRIMITIVE OBSESSION</span>
<span class="sd">   - Uso de dict em vez de classes para entidades</span>
<span class="sd">   - Uso de strings para representar tipos (cliente, pagamento)</span>

<span class="sd">6. FEATURE ENVY</span>
<span class="sd">   - enviar_email_confirmacao() deveria estar em classe Email</span>
<span class="sd">   - C√°lculos de desconto deveriam estar nas classes Cliente</span>

<span class="sd">7. SWITCH STATEMENTS</span>
<span class="sd">   - L√≥gica condicional baseada em tipo de cliente</span>
<span class="sd">   - L√≥gica condicional baseada em forma de pagamento</span>

<span class="sd">8. DUPLICATED CODE</span>
<span class="sd">   - Busca por cliente repetida</span>
<span class="sd">   - Busca por produto repetida</span>
<span class="sd">   - Valida√ß√µes similares em v√°rios locais</span>

<span class="sd">PRIORIZA√á√ÉO PARA REFATORA√á√ÉO (por impacto √ó frequ√™ncia):</span>
<span class="sd">1. Extract Class (God Class) - CR√çTICO</span>
<span class="sd">2. Extract Method (Long Method) - ALTO  </span>
<span class="sd">3. Introduce Parameter Object (Data Clumps) - ALTO</span>
<span class="sd">4. Replace Conditional with Polymorphism - M√âDIO</span>
<span class="sd">5. Move Method (Feature Envy) - M√âDIO</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</section>
<section id="passo-3-refatoracao-incremental-com-tdd">
<h4>Passo 3: Refatora√ß√£o Incremental com TDD<a class="headerlink" href="#passo-3-refatoracao-incremental-com-tdd" title="Link to this heading">#</a></h4>
<p><strong>Fase 1: Cria√ß√£o da Rede de Seguran√ßa (Testes)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># tests/test_sistema_ecommerce_original.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CONCEITO: Characterization Tests</span>
<span class="sd">Antes de refatorar, criamos testes que capturam o comportamento atual</span>
<span class="sd">do sistema, garantindo que a refatora√ß√£o n√£o quebra funcionalidades.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sistema_ecommerce_original</span><span class="w"> </span><span class="kn">import</span> <span class="n">SistemaEcommerce</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestSistemaEcommerceOriginal</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Testes de caracteriza√ß√£o para capturar comportamento atual.&quot;&quot;&quot;</span>
    
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sistema_configurado</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fixture que prepara um sistema com dados iniciais.&quot;&quot;&quot;</span>
        <span class="n">sistema</span> <span class="o">=</span> <span class="n">SistemaEcommerce</span><span class="p">()</span>
        
        <span class="c1"># Produtos</span>
        <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_produto</span><span class="p">(</span><span class="s2">&quot;Notebook Dell&quot;</span><span class="p">,</span> <span class="mf">2500.00</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Eletr√¥nicos&quot;</span><span class="p">)</span>
        <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_produto</span><span class="p">(</span><span class="s2">&quot;Mouse Logitech&quot;</span><span class="p">,</span> <span class="mf">50.00</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Perif√©ricos&quot;</span><span class="p">)</span>
        <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_produto</span><span class="p">(</span><span class="s2">&quot;Teclado Mec√¢nico&quot;</span><span class="p">,</span> <span class="mf">200.00</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;Perif√©ricos&quot;</span><span class="p">)</span>
        
        <span class="c1"># Clientes</span>
        <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_cliente</span><span class="p">(</span><span class="s2">&quot;Jo√£o Silva&quot;</span><span class="p">,</span> <span class="s2">&quot;joao@email.com&quot;</span><span class="p">,</span> <span class="s2">&quot;premium&quot;</span><span class="p">)</span>
        <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_cliente</span><span class="p">(</span><span class="s2">&quot;Maria Santos&quot;</span><span class="p">,</span> <span class="s2">&quot;maria@email.com&quot;</span><span class="p">,</span> <span class="s2">&quot;vip&quot;</span><span class="p">)</span> 
        <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_cliente</span><span class="p">(</span><span class="s2">&quot;Empresa XYZ&quot;</span><span class="p">,</span> <span class="s2">&quot;contato@xyz.com&quot;</span><span class="p">,</span> <span class="s2">&quot;corporativo&quot;</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">sistema</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">test_pedido_cliente_premium_com_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sistema_configurado</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Testa comportamento atual: cliente premium recebe desconto correto.&quot;&quot;&quot;</span>
        <span class="n">dados_pedido</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cliente_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;produtos&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;produto_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;quantidade&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}],</span>  <span class="c1"># Notebook R$ 2500</span>
            <span class="s2">&quot;forma_pagamento&quot;</span><span class="p">:</span> <span class="s2">&quot;cartao_credito&quot;</span><span class="p">,</span>
            <span class="s2">&quot;endereco_entrega&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rua&quot;</span><span class="p">:</span> <span class="s2">&quot;Rua A&quot;</span><span class="p">,</span> <span class="s2">&quot;cidade&quot;</span><span class="p">:</span> <span class="s2">&quot;SP&quot;</span><span class="p">,</span> <span class="s2">&quot;estado&quot;</span><span class="p">:</span> <span class="s2">&quot;SP&quot;</span><span class="p">,</span> <span class="s2">&quot;cep&quot;</span><span class="p">:</span> <span class="s2">&quot;01234&quot;</span><span class="p">}</span>
        <span class="p">}</span>
        
        <span class="n">resultado</span> <span class="o">=</span> <span class="n">sistema_configurado</span><span class="o">.</span><span class="n">processar_pedido_completo</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">)</span>
        
        <span class="c1"># Verifica comportamento atual: desconto de 15% para premium &gt; R$ 1000</span>
        <span class="k">assert</span> <span class="n">resultado</span><span class="p">[</span><span class="s2">&quot;sucesso&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span>
        <span class="k">assert</span> <span class="n">resultado</span><span class="p">[</span><span class="s2">&quot;total_final&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">2125.0</span>  <span class="c1"># 2500 - 15% = 2125 + frete 0</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">test_pedido_frete_gratuito_sp_acima_200</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sistema_configurado</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Testa comportamento atual: frete gr√°tis SP acima R$ 200.&quot;&quot;&quot;</span>
        <span class="n">dados_pedido</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cliente_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;produtos&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;produto_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;quantidade&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}],</span>  <span class="c1"># 5 mouses = R$ 250</span>
            <span class="s2">&quot;forma_pagamento&quot;</span><span class="p">:</span> <span class="s2">&quot;pix&quot;</span><span class="p">,</span>
            <span class="s2">&quot;endereco_entrega&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;estado&quot;</span><span class="p">:</span> <span class="s2">&quot;SP&quot;</span><span class="p">}</span>
        <span class="p">}</span>
        
        <span class="n">resultado</span> <span class="o">=</span> <span class="n">sistema_configurado</span><span class="o">.</span><span class="n">processar_pedido_completo</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">)</span>
        
        <span class="c1"># Total sem desconto: 250, com desconto premium 10%: 225, frete SP gr√°tis</span>
        <span class="k">assert</span> <span class="n">resultado</span><span class="p">[</span><span class="s2">&quot;total_final&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mf">225.0</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">test_erro_cliente_inexistente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sistema_configurado</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Testa comportamento atual: erro para cliente inexistente.&quot;&quot;&quot;</span>
        <span class="n">dados_pedido</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cliente_id&quot;</span><span class="p">:</span> <span class="mi">999</span><span class="p">,</span>  <span class="c1"># Cliente que n√£o existe</span>
            <span class="s2">&quot;produtos&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;produto_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;quantidade&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}],</span>
            <span class="s2">&quot;forma_pagamento&quot;</span><span class="p">:</span> <span class="s2">&quot;pix&quot;</span><span class="p">,</span>
            <span class="s2">&quot;endereco_entrega&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;estado&quot;</span><span class="p">:</span> <span class="s2">&quot;SP&quot;</span><span class="p">}</span>
        <span class="p">}</span>
        
        <span class="n">resultado</span> <span class="o">=</span> <span class="n">sistema_configurado</span><span class="o">.</span><span class="n">processar_pedido_completo</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;erro&quot;</span> <span class="ow">in</span> <span class="n">resultado</span>
        <span class="k">assert</span> <span class="s2">&quot;Cliente n√£o encontrado&quot;</span> <span class="ow">in</span> <span class="n">resultado</span><span class="p">[</span><span class="s2">&quot;erro&quot;</span><span class="p">]</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">test_erro_estoque_insuficiente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sistema_configurado</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Testa comportamento atual: erro para estoque insuficiente.&quot;&quot;&quot;</span>
        <span class="n">dados_pedido</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cliente_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;produtos&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;produto_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;quantidade&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}],</span>  <span class="c1"># Estoque tem apenas 10</span>
            <span class="s2">&quot;forma_pagamento&quot;</span><span class="p">:</span> <span class="s2">&quot;pix&quot;</span><span class="p">,</span>
            <span class="s2">&quot;endereco_entrega&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;estado&quot;</span><span class="p">:</span> <span class="s2">&quot;SP&quot;</span><span class="p">}</span>
        <span class="p">}</span>
        
        <span class="n">resultado</span> <span class="o">=</span> <span class="n">sistema_configurado</span><span class="o">.</span><span class="n">processar_pedido_completo</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;erro&quot;</span> <span class="ow">in</span> <span class="n">resultado</span>
        <span class="k">assert</span> <span class="s2">&quot;Estoque insuficiente&quot;</span> <span class="ow">in</span> <span class="n">resultado</span><span class="p">[</span><span class="s2">&quot;erro&quot;</span><span class="p">]</span>

<span class="c1"># Para executar: pytest tests/test_sistema_ecommerce_original.py -v</span>
</pre></div>
</div>
<p><strong>Fase 2: Extract Class - Eliminando God Class</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># entidades.py - Novas classes extra√≠das</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">REFATORA√á√ÉO: Extract Class</span>
<span class="sd">Extra√≠mos entidades espec√≠ficas da God Class, seguindo o </span>
<span class="sd">Princ√≠pio da Responsabilidade √önica.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>

<span class="c1"># CONCEITO: Value Objects</span>
<span class="c1"># Objetos imut√°veis que representam valores do dom√≠nio</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Endereco</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Value Object para endere√ßo.</span>
<span class="sd">    </span>
<span class="sd">    BENEF√çCIO: Elimina Data Clumps - dados de endere√ßo sempre juntos</span>
<span class="sd">    BENEF√çCIO: Type Safety - compilador detecta erros de tipo</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rua</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cidade</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">estado</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cep</span><span class="p">:</span> <span class="nb">str</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">estado</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estado</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Estado deve ter 2 caracteres&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cep</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CEP inv√°lido&quot;</span><span class="p">)</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
<span class="k">class</span><span class="w"> </span><span class="nc">Produto</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Entity para produto.</span>
<span class="sd">    </span>
<span class="sd">    BENEF√çCIO: Elimina Primitive Obsession</span>
<span class="sd">    BENEF√çCIO: Encapsula valida√ß√µes de neg√≥cio</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">nome</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">preco</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">estoque</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">categoria</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ativo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preco</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Pre√ßo deve ser positivo&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estoque</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Estoque n√£o pode ser negativo&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nome</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nome √© obrigat√≥rio&quot;</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">tem_estoque_disponivel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verifica se h√° estoque suficiente.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ativo</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">estoque</span> <span class="o">&gt;=</span> <span class="n">quantidade</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">reduzir_estoque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Produto&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retorna novo produto com estoque reduzido.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tem_estoque_disponivel</span><span class="p">(</span><span class="n">quantidade</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estoque insuficiente para </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nome</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Produto</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">nome</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nome</span><span class="p">,</span>
            <span class="n">preco</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preco</span><span class="p">,</span>
            <span class="n">estoque</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estoque</span> <span class="o">-</span> <span class="n">quantidade</span><span class="p">,</span>
            <span class="n">categoria</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">categoria</span><span class="p">,</span>
            <span class="n">ativo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ativo</span>
        <span class="p">)</span>

<span class="c1"># CONCEITO: Strategy Pattern + Polymorphism</span>
<span class="c1"># Substitui Switch Statements por polimorfismo</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TipoClienteEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">REGULAR</span> <span class="o">=</span> <span class="s2">&quot;regular&quot;</span>
    <span class="n">PREMIUM</span> <span class="o">=</span> <span class="s2">&quot;premium&quot;</span>
    <span class="n">VIP</span> <span class="o">=</span> <span class="s2">&quot;vip&quot;</span>
    <span class="n">CORPORATIVO</span> <span class="o">=</span> <span class="s2">&quot;corporativo&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CalculadoraDesconto</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strategy para c√°lculo de desconto.&quot;&quot;&quot;</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcula desconto baseado na estrat√©gia espec√≠fica.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DescontoRegular</span><span class="p">(</span><span class="n">CalculadoraDesconto</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DescontoPremium</span><span class="p">(</span><span class="n">CalculadoraDesconto</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">subtotal</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.15</span>
        <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.10</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DescontoVIP</span><span class="p">(</span><span class="n">CalculadoraDesconto</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">subtotal</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.25</span>
        <span class="k">elif</span> <span class="n">subtotal</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.20</span>
        <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.15</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DescontoCorporativo</span><span class="p">(</span><span class="n">CalculadoraDesconto</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">quantidade</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.30</span>
        <span class="k">elif</span> <span class="n">quantidade</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.25</span>
        <span class="k">return</span> <span class="n">subtotal</span> <span class="o">*</span> <span class="mf">0.20</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Cliente</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Entity para cliente.</span>
<span class="sd">    </span>
<span class="sd">    BENEF√çCIO: Encapsula l√≥gica de desconto espec√≠fica</span>
<span class="sd">    BENEF√çCIO: Elimina Switch Statements atrav√©s de Strategy Pattern</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">nome</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">tipo</span><span class="p">:</span> <span class="n">TipoClienteEnum</span>
    <span class="n">limite_credito</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">ativo</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">bloqueado</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">saldo_conta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">pre_aprovado</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limite_credito</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Limite de cr√©dito n√£o pode ser negativo&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;@&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Email inv√°lido&quot;</span><span class="p">)</span>
        
        <span class="c1"># Configurar calculadora de desconto baseada no tipo</span>
        <span class="n">calculadoras</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">TipoClienteEnum</span><span class="o">.</span><span class="n">REGULAR</span><span class="p">:</span> <span class="n">DescontoRegular</span><span class="p">(),</span>
            <span class="n">TipoClienteEnum</span><span class="o">.</span><span class="n">PREMIUM</span><span class="p">:</span> <span class="n">DescontoPremium</span><span class="p">(),</span>
            <span class="n">TipoClienteEnum</span><span class="o">.</span><span class="n">VIP</span><span class="p">:</span> <span class="n">DescontoVIP</span><span class="p">(),</span>
            <span class="n">TipoClienteEnum</span><span class="o">.</span><span class="n">CORPORATIVO</span><span class="p">:</span> <span class="n">DescontoCorporativo</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="c1"># Usamos object.__setattr__ porque a classe √© frozen</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_calculadora_desconto&#39;</span><span class="p">,</span> <span class="n">calculadoras</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tipo</span><span class="p">])</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_desconto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subtotal</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcula desconto baseado no tipo de cliente.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculadora_desconto</span><span class="o">.</span><span class="n">calcular_desconto</span><span class="p">(</span><span class="n">subtotal</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">pode_comprar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">forma_pagamento</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verifica se cliente pode realizar a compra.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ativo</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Cliente inativo&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bloqueado</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Cliente bloqueado&quot;</span>
            
        <span class="k">if</span> <span class="n">forma_pagamento</span> <span class="o">==</span> <span class="s2">&quot;cartao_credito&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limite_credito</span> <span class="o">&lt;</span> <span class="n">total</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Limite de cr√©dito insuficiente&quot;</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">5000</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_aprovado</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Transa√ß√£o requer pr√©-aprova√ß√£o&quot;</span>
        <span class="k">elif</span> <span class="n">forma_pagamento</span> <span class="o">==</span> <span class="s2">&quot;cartao_debito&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saldo_conta</span> <span class="o">&lt;</span> <span class="n">total</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Saldo insuficiente&quot;</span>
                
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FormaPagamentoEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">CARTAO_CREDITO</span> <span class="o">=</span> <span class="s2">&quot;cartao_credito&quot;</span>
    <span class="n">CARTAO_DEBITO</span> <span class="o">=</span> <span class="s2">&quot;cartao_debito&quot;</span>
    <span class="n">PIX</span> <span class="o">=</span> <span class="s2">&quot;pix&quot;</span>
    <span class="n">BOLETO</span> <span class="o">=</span> <span class="s2">&quot;boleto&quot;</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ItemPedido</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Value Object para item do pedido.&quot;&quot;&quot;</span>
    <span class="n">produto</span><span class="p">:</span> <span class="n">Produto</span>
    <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">preco_unitario</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">desconto</span><span class="p">:</span> <span class="nb">float</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">subtotal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">preco_unitario</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantidade</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">total</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtotal</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">desconto</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Pedido</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entity para pedido.&quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">cliente</span><span class="p">:</span> <span class="n">Cliente</span>
    <span class="n">itens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ItemPedido</span><span class="p">]</span>
    <span class="n">endereco_entrega</span><span class="p">:</span> <span class="n">Endereco</span>
    <span class="n">forma_pagamento</span><span class="p">:</span> <span class="n">FormaPagamentoEnum</span>
    <span class="n">frete</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">data_criacao</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pendente&quot;</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">total_produtos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">total</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itens</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">total_final</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_produtos</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frete</span>
</pre></div>
</div>
<p><strong>Fase 3: Extract Method - Decompondo Long Method</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># processador_pedido.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">REFATORA√á√ÉO: Extract Method + Single Responsibility</span>
<span class="sd">Decompomos o m√©todo longo em m√©todos menores e especializados.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">entidades</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">Cliente</span><span class="p">,</span> <span class="n">Produto</span><span class="p">,</span> <span class="n">Pedido</span><span class="p">,</span> <span class="n">ItemPedido</span><span class="p">,</span> <span class="n">Endereco</span><span class="p">,</span> 
    <span class="n">FormaPagamentoEnum</span><span class="p">,</span> <span class="n">TipoClienteEnum</span>
<span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ResultadoPedido</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Value Object para resultado do processamento.&quot;&quot;&quot;</span>
    <span class="n">sucesso</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">pedido_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">total_final</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">erro</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">prazo_entrega</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;3-5 dias √∫teis&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CalculadoraFrete</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Service para c√°lculo de frete.</span>
<span class="sd">    </span>
<span class="sd">    CONCEITO: Single Responsibility Principle</span>
<span class="sd">    Classe focada apenas no c√°lculo de frete.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_pedido</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">estado</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calcula frete baseado no estado e total do pedido.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIO: L√≥gica de frete centralizada e test√°vel isoladamente</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">estado</span> <span class="o">==</span> <span class="s2">&quot;SP&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span> <span class="k">if</span> <span class="n">total_pedido</span> <span class="o">&gt;</span> <span class="mi">200</span> <span class="k">else</span> <span class="mf">15.0</span>
        <span class="k">elif</span> <span class="n">estado</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RJ&quot;</span><span class="p">,</span> <span class="s2">&quot;MG&quot;</span><span class="p">,</span> <span class="s2">&quot;ES&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="mf">0.0</span> <span class="k">if</span> <span class="n">total_pedido</span> <span class="o">&gt;</span> <span class="mi">300</span> <span class="k">else</span> <span class="mf">25.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span> <span class="k">if</span> <span class="n">total_pedido</span> <span class="o">&gt;</span> <span class="mi">500</span> <span class="k">else</span> <span class="mf">35.0</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ValidadorPedido</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Service para valida√ß√£o de pedidos.</span>
<span class="sd">    </span>
<span class="sd">    CONCEITO: Fail Fast + Single Responsibility</span>
<span class="sd">    Valida√ß√µes centralizadas com retorno imediato em caso de erro.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">validar_dados_basicos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados_pedido</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Valida estrutura b√°sica dos dados do pedido.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dados_pedido</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Dados do pedido n√£o fornecidos&quot;</span>
        
        <span class="n">campos_obrigatorios</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cliente_id&quot;</span><span class="p">,</span> <span class="s2">&quot;produtos&quot;</span><span class="p">,</span> <span class="s2">&quot;forma_pagamento&quot;</span><span class="p">,</span> <span class="s2">&quot;endereco_entrega&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">campo</span> <span class="ow">in</span> <span class="n">campos_obrigatorios</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">campo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dados_pedido</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Campo obrigat√≥rio ausente: </span><span class="si">{</span><span class="n">campo</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;produtos&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;produtos&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Nenhum produto no pedido&quot;</span>
            
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">validar_cliente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cliente</span><span class="p">:</span> <span class="n">Cliente</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">forma_pagamento</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Valida se cliente pode realizar a compra.&quot;&quot;&quot;</span>
        <span class="n">pode_comprar</span><span class="p">,</span> <span class="n">motivo</span> <span class="o">=</span> <span class="n">cliente</span><span class="o">.</span><span class="n">pode_comprar</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">forma_pagamento</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">pode_comprar</span> <span class="k">else</span> <span class="n">motivo</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">validar_produto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">produto</span><span class="p">:</span> <span class="n">Produto</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Valida se produto est√° dispon√≠vel na quantidade solicitada.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">produto</span><span class="o">.</span><span class="n">ativo</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Produto </span><span class="si">{</span><span class="n">produto</span><span class="o">.</span><span class="n">nome</span><span class="si">}</span><span class="s2"> n√£o est√° ativo&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">produto</span><span class="o">.</span><span class="n">tem_estoque_disponivel</span><span class="p">(</span><span class="n">quantidade</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Estoque insuficiente para </span><span class="si">{</span><span class="n">produto</span><span class="o">.</span><span class="n">nome</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ProcessadorItens</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Service para processamento de itens do pedido.</span>
<span class="sd">    </span>
<span class="sd">    CONCEITO: Extract Class + Single Responsibility</span>
<span class="sd">    Respons√°vel apenas por processar e calcular itens.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">processar_itens</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">produtos_dados</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> 
        <span class="n">cliente</span><span class="p">:</span> <span class="n">Cliente</span><span class="p">,</span>
        <span class="n">repositorio_produtos</span><span class="p">:</span> <span class="s1">&#39;RepositorioProdutos&#39;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ItemPedido</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processa lista de produtos e retorna itens do pedido.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[ItemPedido], Optional[str]]: (itens, erro)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">itens_processados</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">item_dados</span> <span class="ow">in</span> <span class="n">produtos_dados</span><span class="p">:</span>
            <span class="n">produto_id</span> <span class="o">=</span> <span class="n">item_dados</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;produto_id&quot;</span><span class="p">)</span>
            <span class="n">quantidade</span> <span class="o">=</span> <span class="n">item_dados</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;quantidade&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># Buscar produto</span>
            <span class="n">produto</span> <span class="o">=</span> <span class="n">repositorio_produtos</span><span class="o">.</span><span class="n">buscar_por_id</span><span class="p">(</span><span class="n">produto_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">produto</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[],</span> <span class="sa">f</span><span class="s2">&quot;Produto </span><span class="si">{</span><span class="n">produto_id</span><span class="si">}</span><span class="s2"> n√£o encontrado&quot;</span>
            
            <span class="c1"># Validar produto</span>
            <span class="n">validador</span> <span class="o">=</span> <span class="n">ValidadorPedido</span><span class="p">()</span>
            <span class="n">erro_validacao</span> <span class="o">=</span> <span class="n">validador</span><span class="o">.</span><span class="n">validar_produto</span><span class="p">(</span><span class="n">produto</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">erro_validacao</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[],</span> <span class="n">erro_validacao</span>
            
            <span class="c1"># Calcular pre√ßos</span>
            <span class="n">subtotal</span> <span class="o">=</span> <span class="n">produto</span><span class="o">.</span><span class="n">preco</span> <span class="o">*</span> <span class="n">quantidade</span>
            <span class="n">desconto</span> <span class="o">=</span> <span class="n">cliente</span><span class="o">.</span><span class="n">calcular_desconto</span><span class="p">(</span><span class="n">subtotal</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">)</span>
            
            <span class="n">item</span> <span class="o">=</span> <span class="n">ItemPedido</span><span class="p">(</span>
                <span class="n">produto</span><span class="o">=</span><span class="n">produto</span><span class="p">,</span>
                <span class="n">quantidade</span><span class="o">=</span><span class="n">quantidade</span><span class="p">,</span>
                <span class="n">preco_unitario</span><span class="o">=</span><span class="n">produto</span><span class="o">.</span><span class="n">preco</span><span class="p">,</span>
                <span class="n">desconto</span><span class="o">=</span><span class="n">desconto</span>
            <span class="p">)</span>
            <span class="n">itens_processados</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">itens_processados</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ProcessadorPedido</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Orchestrator principal para processamento de pedidos.</span>
<span class="sd">    </span>
<span class="sd">    CONCEITO: Facade Pattern + Orchestration</span>
<span class="sd">    Coordena outros services sem implementar l√≥gica de neg√≥cio complexa.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repositorio_clientes</span><span class="p">:</span> <span class="s1">&#39;RepositorioClientes&#39;</span><span class="p">,</span>
        <span class="n">repositorio_produtos</span><span class="p">:</span> <span class="s1">&#39;RepositorioProdutos&#39;</span><span class="p">,</span>
        <span class="n">repositorio_pedidos</span><span class="p">:</span> <span class="s1">&#39;RepositorioPedidos&#39;</span><span class="p">,</span>
        <span class="n">servico_email</span><span class="p">:</span> <span class="s1">&#39;ServicoEmail&#39;</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_clientes</span> <span class="o">=</span> <span class="n">repositorio_clientes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_produtos</span> <span class="o">=</span> <span class="n">repositorio_produtos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_pedidos</span> <span class="o">=</span> <span class="n">repositorio_pedidos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">servico_email</span> <span class="o">=</span> <span class="n">servico_email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculadora_frete</span> <span class="o">=</span> <span class="n">CalculadoraFrete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processador_itens</span> <span class="o">=</span> <span class="n">ProcessadorItens</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validador</span> <span class="o">=</span> <span class="n">ValidadorPedido</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">processar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados_pedido</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ResultadoPedido</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processa pedido completo.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIO: M√©todo principal agora tem &lt; 20 linhas</span>
<span class="sd">        BENEF√çCIO: Cada responsabilidade delegada para service espec√≠fico</span>
<span class="sd">        BENEF√çCIO: F√°cil de testar e manter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># 1. Validar dados b√°sicos</span>
        <span class="n">erro_basico</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validador</span><span class="o">.</span><span class="n">validar_dados_basicos</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">erro_basico</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ResultadoPedido</span><span class="p">(</span><span class="n">sucesso</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">erro</span><span class="o">=</span><span class="n">erro_basico</span><span class="p">)</span>
        
        <span class="c1"># 2. Buscar e validar cliente</span>
        <span class="n">cliente</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_clientes</span><span class="o">.</span><span class="n">buscar_por_id</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;cliente_id&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cliente</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ResultadoPedido</span><span class="p">(</span><span class="n">sucesso</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">erro</span><span class="o">=</span><span class="s2">&quot;Cliente n√£o encontrado&quot;</span><span class="p">)</span>
        
        <span class="c1"># 3. Processar itens</span>
        <span class="n">itens</span><span class="p">,</span> <span class="n">erro_itens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processador_itens</span><span class="o">.</span><span class="n">processar_itens</span><span class="p">(</span>
            <span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;produtos&quot;</span><span class="p">],</span> 
            <span class="n">cliente</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_produtos</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">erro_itens</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ResultadoPedido</span><span class="p">(</span><span class="n">sucesso</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">erro</span><span class="o">=</span><span class="n">erro_itens</span><span class="p">)</span>
        
        <span class="c1"># 4. Calcular totais</span>
        <span class="n">total_produtos</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">total</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itens</span><span class="p">)</span>
        <span class="n">endereco</span> <span class="o">=</span> <span class="n">Endereco</span><span class="p">(</span><span class="o">**</span><span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;endereco_entrega&quot;</span><span class="p">])</span>
        <span class="n">frete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculadora_frete</span><span class="o">.</span><span class="n">calcular</span><span class="p">(</span><span class="n">total_produtos</span><span class="p">,</span> <span class="n">endereco</span><span class="o">.</span><span class="n">estado</span><span class="p">)</span>
        <span class="n">total_final</span> <span class="o">=</span> <span class="n">total_produtos</span> <span class="o">+</span> <span class="n">frete</span>
        
        <span class="c1"># 5. Validar capacidade de pagamento</span>
        <span class="n">forma_pagamento</span> <span class="o">=</span> <span class="n">dados_pedido</span><span class="p">[</span><span class="s2">&quot;forma_pagamento&quot;</span><span class="p">]</span>
        <span class="n">erro_pagamento</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validador</span><span class="o">.</span><span class="n">validar_cliente</span><span class="p">(</span><span class="n">cliente</span><span class="p">,</span> <span class="n">total_final</span><span class="p">,</span> <span class="n">forma_pagamento</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">erro_pagamento</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ResultadoPedido</span><span class="p">(</span><span class="n">sucesso</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">erro</span><span class="o">=</span><span class="n">erro_pagamento</span><span class="p">)</span>
        
        <span class="c1"># 6. Criar e salvar pedido</span>
        <span class="n">pedido</span> <span class="o">=</span> <span class="n">Pedido</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repositorio_pedidos</span><span class="o">.</span><span class="n">proximo_id</span><span class="p">(),</span>
            <span class="n">cliente</span><span class="o">=</span><span class="n">cliente</span><span class="p">,</span>
            <span class="n">itens</span><span class="o">=</span><span class="n">itens</span><span class="p">,</span>
            <span class="n">endereco_entrega</span><span class="o">=</span><span class="n">endereco</span><span class="p">,</span>
            <span class="n">forma_pagamento</span><span class="o">=</span><span class="n">FormaPagamentoEnum</span><span class="p">(</span><span class="n">forma_pagamento</span><span class="p">),</span>
            <span class="n">frete</span><span class="o">=</span><span class="n">frete</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;confirmado&quot;</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_pedidos</span><span class="o">.</span><span class="n">salvar</span><span class="p">(</span><span class="n">pedido</span><span class="p">)</span>
        
        <span class="c1"># 7. Atualizar estoque</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atualizar_estoque</span><span class="p">(</span><span class="n">itens</span><span class="p">)</span>
        
        <span class="c1"># 8. Enviar confirma√ß√£o</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">servico_email</span><span class="o">.</span><span class="n">enviar_confirmacao_pedido</span><span class="p">(</span><span class="n">cliente</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">pedido</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ResultadoPedido</span><span class="p">(</span>
            <span class="n">sucesso</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">pedido_id</span><span class="o">=</span><span class="n">pedido</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">total_final</span><span class="o">=</span><span class="n">total_final</span>
        <span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_atualizar_estoque</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ItemPedido</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Atualiza estoque dos produtos.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itens</span><span class="p">:</span>
            <span class="n">produto_atualizado</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">produto</span><span class="o">.</span><span class="n">reduzir_estoque</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">quantidade</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_produtos</span><span class="o">.</span><span class="n">atualizar</span><span class="p">(</span><span class="n">produto_atualizado</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Fase 4: Repository Pattern - Eliminando Feature Envy</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># repositorios.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">REFATORA√á√ÉO: Repository Pattern + Move Method</span>
<span class="sd">Movemos responsabilidades de persist√™ncia para reposit√≥rios especializados.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">entidades</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cliente</span><span class="p">,</span> <span class="n">Produto</span><span class="p">,</span> <span class="n">Pedido</span><span class="p">,</span> <span class="n">TipoClienteEnum</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RepositorioClientes</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface para persist√™ncia de clientes.&quot;&quot;&quot;</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">buscar_por_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Cliente</span><span class="p">]:</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">salvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cliente</span><span class="p">:</span> <span class="n">Cliente</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_todos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Cliente</span><span class="p">]:</span>
        <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RepositorioProdutos</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface para persist√™ncia de produtos.&quot;&quot;&quot;</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">buscar_por_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Produto</span><span class="p">]:</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">atualizar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">produto</span><span class="p">:</span> <span class="n">Produto</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_por_categoria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">categoria</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Produto</span><span class="p">]:</span>
        <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RepositorioPedidos</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface para persist√™ncia de pedidos.&quot;&quot;&quot;</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">salvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pedido</span><span class="p">:</span> <span class="n">Pedido</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">proximo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">buscar_por_cliente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cliente_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Pedido</span><span class="p">]:</span>
        <span class="k">pass</span>

<span class="c1"># Implementa√ß√µes em mem√≥ria para demonstra√ß√£o</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RepositorioClientesMemoria</span><span class="p">(</span><span class="n">RepositorioClientes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementa√ß√£o em mem√≥ria do reposit√≥rio de clientes.&quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clientes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Cliente</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">buscar_por_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Cliente</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clientes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">salvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cliente</span><span class="p">:</span> <span class="n">Cliente</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cliente</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Novo cliente - atribuir ID</span>
            <span class="n">cliente_com_id</span> <span class="o">=</span> <span class="n">Cliente</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span><span class="p">,</span>
                <span class="n">nome</span><span class="o">=</span><span class="n">cliente</span><span class="o">.</span><span class="n">nome</span><span class="p">,</span>
                <span class="n">email</span><span class="o">=</span><span class="n">cliente</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                <span class="n">tipo</span><span class="o">=</span><span class="n">cliente</span><span class="o">.</span><span class="n">tipo</span><span class="p">,</span>
                <span class="n">limite_credito</span><span class="o">=</span><span class="n">cliente</span><span class="o">.</span><span class="n">limite_credito</span><span class="p">,</span>
                <span class="n">ativo</span><span class="o">=</span><span class="n">cliente</span><span class="o">.</span><span class="n">ativo</span><span class="p">,</span>
                <span class="n">bloqueado</span><span class="o">=</span><span class="n">cliente</span><span class="o">.</span><span class="n">bloqueado</span><span class="p">,</span>
                <span class="n">saldo_conta</span><span class="o">=</span><span class="n">cliente</span><span class="o">.</span><span class="n">saldo_conta</span><span class="p">,</span>
                <span class="n">pre_aprovado</span><span class="o">=</span><span class="n">cliente</span><span class="o">.</span><span class="n">pre_aprovado</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clientes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">cliente_com_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clientes</span><span class="p">[</span><span class="n">cliente</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">cliente</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_todos</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Cliente</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clientes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RepositorioProdutosMemoria</span><span class="p">(</span><span class="n">RepositorioProdutos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementa√ß√£o em mem√≥ria do reposit√≥rio de produtos.&quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_produtos</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Produto</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">buscar_por_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Produto</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_produtos</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">atualizar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">produto</span><span class="p">:</span> <span class="n">Produto</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_produtos</span><span class="p">[</span><span class="n">produto</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">produto</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">salvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">produto</span><span class="p">:</span> <span class="n">Produto</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Produto</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">produto</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">produto_com_id</span> <span class="o">=</span> <span class="n">Produto</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span><span class="p">,</span>
                <span class="n">nome</span><span class="o">=</span><span class="n">produto</span><span class="o">.</span><span class="n">nome</span><span class="p">,</span>
                <span class="n">preco</span><span class="o">=</span><span class="n">produto</span><span class="o">.</span><span class="n">preco</span><span class="p">,</span>
                <span class="n">estoque</span><span class="o">=</span><span class="n">produto</span><span class="o">.</span><span class="n">estoque</span><span class="p">,</span>
                <span class="n">categoria</span><span class="o">=</span><span class="n">produto</span><span class="o">.</span><span class="n">categoria</span><span class="p">,</span>
                <span class="n">ativo</span><span class="o">=</span><span class="n">produto</span><span class="o">.</span><span class="n">ativo</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_produtos</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">produto_com_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">produto_com_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_produtos</span><span class="p">[</span><span class="n">produto</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">produto</span>
            <span class="k">return</span> <span class="n">produto</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">listar_por_categoria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">categoria</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Produto</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_produtos</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">categoria</span> <span class="o">==</span> <span class="n">categoria</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RepositorioPedidosMemoria</span><span class="p">(</span><span class="n">RepositorioPedidos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementa√ß√£o em mem√≥ria do reposit√≥rio de pedidos.&quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pedidos</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Pedido</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">salvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pedido</span><span class="p">:</span> <span class="n">Pedido</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pedidos</span><span class="p">[</span><span class="n">pedido</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pedido</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">proximo_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">id_atual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_proximo_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">id_atual</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">buscar_por_cliente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cliente_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Pedido</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pedidos</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">cliente</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">cliente_id</span><span class="p">]</span>

<span class="c1"># servicos.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">REFATORA√á√ÉO: Move Method + Extract Class</span>
<span class="sd">Movemos responsabilidades espec√≠ficas para services dedicados.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">entidades</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pedido</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ServicoEmail</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Service para envio de emails.</span>
<span class="sd">    </span>
<span class="sd">    BENEF√çCIO: Elimina Feature Envy - responsabilidade movida para lugar apropriado</span>
<span class="sd">    BENEF√çCIO: Facilita mock em testes</span>
<span class="sd">    BENEF√çCIO: Permite diferentes implementa√ß√µes (SMTP, SendGrid, etc.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">enviar_confirmacao_pedido</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pedido</span><span class="p">:</span> <span class="n">Pedido</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ServicoEmailConsole</span><span class="p">(</span><span class="n">ServicoEmail</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementa√ß√£o de email que imprime no console (para desenvolvimento).&quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">enviar_confirmacao_pedido</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pedido</span><span class="p">:</span> <span class="n">Pedido</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simula envio de email imprimindo no console.</span>
<span class="sd">        </span>
<span class="sd">        CONCEITO: Dependency Inversion</span>
<span class="sd">        Implementa√ß√£o concreta de interface abstrata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assunto</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Pedido #</span><span class="si">{</span><span class="n">pedido</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> confirmado&quot;</span>
        <span class="n">corpo</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Ol√° </span><span class="si">{</span><span class="n">pedido</span><span class="o">.</span><span class="n">cliente</span><span class="o">.</span><span class="n">nome</span><span class="si">}</span><span class="s2">!</span>
<span class="s2">        </span>
<span class="s2">        Seu pedido #</span><span class="si">{</span><span class="n">pedido</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> foi confirmado com sucesso.</span>
<span class="s2">        </span>
<span class="s2">        Itens do pedido:</span>
<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_formatar_itens</span><span class="p">(</span><span class="n">pedido</span><span class="o">.</span><span class="n">itens</span><span class="p">)</span><span class="si">}</span>
<span class="s2">        </span>
<span class="s2">        Total: R$ </span><span class="si">{</span><span class="n">pedido</span><span class="o">.</span><span class="n">total_final</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span>
<span class="s2">        Prazo de entrega: 3-5 dias √∫teis</span>
<span class="s2">        </span>
<span class="s2">        Obrigado pela prefer√™ncia!</span>
<span class="s2">        &quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== EMAIL ENVIADO ===&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Para: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assunto: </span><span class="si">{</span><span class="n">assunto</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corpo: </span><span class="si">{</span><span class="n">corpo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==================&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_formatar_itens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itens</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Formata lista de itens para exibi√ß√£o.&quot;&quot;&quot;</span>
        <span class="n">linhas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">itens</span><span class="p">:</span>
            <span class="n">linha</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">produto</span><span class="o">.</span><span class="n">nome</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">quantidade</span><span class="si">}</span><span class="s2"> = R$ </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">total</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">desconto</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">linha</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (desconto: R$ </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">desconto</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="n">linhas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linha</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">        &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">linhas</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Fase 5: Sistema Refatorado Completo</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># sistema_ecommerce_refatorado.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RESULTADO FINAL: Sistema ap√≥s refatora√ß√£o completa</span>
<span class="sd">Demonstra como todas as t√©cnicas de refatora√ß√£o trabalharam juntas.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">entidades</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cliente</span><span class="p">,</span> <span class="n">Produto</span><span class="p">,</span> <span class="n">TipoClienteEnum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">repositorios</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">RepositorioClientesMemoria</span><span class="p">,</span> <span class="n">RepositorioProdutosMemoria</span><span class="p">,</span> 
    <span class="n">RepositorioPedidosMemoria</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">processador_pedido</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessadorPedido</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">servicos</span><span class="w"> </span><span class="kn">import</span> <span class="n">ServicoEmailConsole</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SistemaEcommerceRefatorado</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sistema principal ap√≥s refatora√ß√£o.</span>
<span class="sd">    </span>
<span class="sd">    MELHORIAS ALCAN√áADAS:</span>
<span class="sd">    ‚úÖ God Class eliminada - responsabilidades distribu√≠das</span>
<span class="sd">    ‚úÖ Long Methods decompostos em m√©todos focados</span>
<span class="sd">    ‚úÖ Data Clumps eliminados com classes de dom√≠nio</span>
<span class="sd">    ‚úÖ Primitive Obsession resolvida com Value Objects</span>
<span class="sd">    ‚úÖ Feature Envy corrigida com Move Method</span>
<span class="sd">    ‚úÖ Switch Statements substitu√≠dos por polimorfismo</span>
<span class="sd">    ‚úÖ C√≥digo duplicado eliminado</span>
<span class="sd">    ‚úÖ Complexidade ciclom√°tica reduzida (8 ‚Üí 3)</span>
<span class="sd">    ‚úÖ Testabilidade dramaticamente melhorada</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Inje√ß√£o de depend√™ncias - facilita testes e manuten√ß√£o</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_clientes</span> <span class="o">=</span> <span class="n">RepositorioClientesMemoria</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_produtos</span> <span class="o">=</span> <span class="n">RepositorioProdutosMemoria</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_pedidos</span> <span class="o">=</span> <span class="n">RepositorioPedidosMemoria</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">servico_email</span> <span class="o">=</span> <span class="n">ServicoEmailConsole</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">processador_pedido</span> <span class="o">=</span> <span class="n">ProcessadorPedido</span><span class="p">(</span>
            <span class="n">repositorio_clientes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repositorio_clientes</span><span class="p">,</span>
            <span class="n">repositorio_produtos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repositorio_produtos</span><span class="p">,</span>
            <span class="n">repositorio_pedidos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">repositorio_pedidos</span><span class="p">,</span>
            <span class="n">servico_email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">servico_email</span>
        <span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">processar_pedido_completo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados_pedido</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        M√©todo principal simplificado.</span>
<span class="sd">        </span>
<span class="sd">        ANTES: 80+ linhas, complexidade ciclom√°tica = 15</span>
<span class="sd">        DEPOIS: 8 linhas, complexidade ciclom√°tica = 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resultado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processador_pedido</span><span class="o">.</span><span class="n">processar</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">)</span>
        
        <span class="c1"># Converter para formato compat√≠vel com API original</span>
        <span class="k">if</span> <span class="n">resultado</span><span class="o">.</span><span class="n">sucesso</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;sucesso&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;pedido_id&quot;</span><span class="p">:</span> <span class="n">resultado</span><span class="o">.</span><span class="n">pedido_id</span><span class="p">,</span>
                <span class="s2">&quot;total_final&quot;</span><span class="p">:</span> <span class="n">resultado</span><span class="o">.</span><span class="n">total_final</span><span class="p">,</span>
                <span class="s2">&quot;prazo_entrega&quot;</span><span class="p">:</span> <span class="n">resultado</span><span class="o">.</span><span class="n">prazo_entrega</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;erro&quot;</span><span class="p">:</span> <span class="n">resultado</span><span class="o">.</span><span class="n">erro</span><span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">adicionar_produto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">preco</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">estoque</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">categoria</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        M√©todo simplificado para adicionar produto.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIO: Valida√ß√µes delegadas para classe Produto</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">produto</span> <span class="o">=</span> <span class="n">Produto</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Ser√° atribu√≠do pelo reposit√≥rio</span>
            <span class="n">nome</span><span class="o">=</span><span class="n">nome</span><span class="p">,</span>
            <span class="n">preco</span><span class="o">=</span><span class="n">preco</span><span class="p">,</span>
            <span class="n">estoque</span><span class="o">=</span><span class="n">estoque</span><span class="p">,</span>
            <span class="n">categoria</span><span class="o">=</span><span class="n">categoria</span>
        <span class="p">)</span>
        <span class="n">produto_salvo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_produtos</span><span class="o">.</span><span class="n">salvar</span><span class="p">(</span><span class="n">produto</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">produto_salvo</span><span class="o">.</span><span class="n">id</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">adicionar_cliente</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nome</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tipo</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">limite_credito</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        M√©todo simplificado para adicionar cliente.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIO: L√≥gica de tipos delegada para enum e classes Strategy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tipo_enum</span> <span class="o">=</span> <span class="n">TipoClienteEnum</span><span class="p">(</span><span class="n">tipo</span><span class="p">)</span>
        
        <span class="c1"># Limites padr√£o baseados no tipo</span>
        <span class="n">limites_padrao</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">TipoClienteEnum</span><span class="o">.</span><span class="n">REGULAR</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="n">TipoClienteEnum</span><span class="o">.</span><span class="n">PREMIUM</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
            <span class="n">TipoClienteEnum</span><span class="o">.</span><span class="n">VIP</span><span class="p">:</span> <span class="mi">15000</span><span class="p">,</span>
            <span class="n">TipoClienteEnum</span><span class="o">.</span><span class="n">CORPORATIVO</span><span class="p">:</span> <span class="mi">50000</span>
        <span class="p">}</span>
        
        <span class="n">cliente</span> <span class="o">=</span> <span class="n">Cliente</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Ser√° atribu√≠do pelo reposit√≥rio</span>
            <span class="n">nome</span><span class="o">=</span><span class="n">nome</span><span class="p">,</span>
            <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span>
            <span class="n">tipo</span><span class="o">=</span><span class="n">tipo_enum</span><span class="p">,</span>
            <span class="n">limite_credito</span><span class="o">=</span><span class="n">limite_credito</span> <span class="ow">or</span> <span class="n">limites_padrao</span><span class="p">[</span><span class="n">tipo_enum</span><span class="p">]</span>
        <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">repositorio_clientes</span><span class="o">.</span><span class="n">salvar</span><span class="p">(</span><span class="n">cliente</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cliente</span><span class="o">.</span><span class="n">id</span>

<span class="c1"># Demonstra√ß√£o de uso com compara√ß√£o</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== SISTEMA REFATORADO ===&quot;</span><span class="p">)</span>
    <span class="n">sistema</span> <span class="o">=</span> <span class="n">SistemaEcommerceRefatorado</span><span class="p">()</span>
    
    <span class="c1"># Adicionar produtos</span>
    <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_produto</span><span class="p">(</span><span class="s2">&quot;Notebook Dell&quot;</span><span class="p">,</span> <span class="mf">2500.00</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Eletr√¥nicos&quot;</span><span class="p">)</span>
    <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_produto</span><span class="p">(</span><span class="s2">&quot;Mouse Logitech&quot;</span><span class="p">,</span> <span class="mf">50.00</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Perif√©ricos&quot;</span><span class="p">)</span>
    
    <span class="c1"># Adicionar cliente</span>
    <span class="n">sistema</span><span class="o">.</span><span class="n">adicionar_cliente</span><span class="p">(</span><span class="s2">&quot;Jo√£o Silva&quot;</span><span class="p">,</span> <span class="s2">&quot;joao@email.com&quot;</span><span class="p">,</span> <span class="s2">&quot;premium&quot;</span><span class="p">)</span>
    
    <span class="c1"># Processar pedido</span>
    <span class="n">dados_pedido</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;cliente_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;produtos&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;produto_id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;quantidade&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;produto_id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;quantidade&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;forma_pagamento&quot;</span><span class="p">:</span> <span class="s2">&quot;cartao_credito&quot;</span><span class="p">,</span>
        <span class="s2">&quot;endereco_entrega&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;rua&quot;</span><span class="p">:</span> <span class="s2">&quot;Rua das Flores, 123&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cidade&quot;</span><span class="p">:</span> <span class="s2">&quot;S√£o Paulo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;estado&quot;</span><span class="p">:</span> <span class="s2">&quot;SP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cep&quot;</span><span class="p">:</span> <span class="s2">&quot;01234-567&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="n">resultado</span> <span class="o">=</span> <span class="n">sistema</span><span class="o">.</span><span class="n">processar_pedido_completo</span><span class="p">(</span><span class="n">dados_pedido</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">resultado</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="passo-4-comparacao-quantitativa-antes-vs-depois">
<h4>Passo 4: Compara√ß√£o Quantitativa - Antes vs. Depois<a class="headerlink" href="#passo-4-comparacao-quantitativa-antes-vs-depois" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># metricas_comparacao.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">AN√ÅLISE QUANTITATIVA: Impacto da refatora√ß√£o nas m√©tricas de qualidade</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">METRICAS_ANTES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;linhas_codigo&quot;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>
    <span class="s2">&quot;numero_classes&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;numero_metodos&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;complexidade_ciclomatica_media&quot;</span><span class="p">:</span> <span class="mf">12.5</span><span class="p">,</span>
    <span class="s2">&quot;complexidade_ciclomatica_maxima&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;numero_parametros_max&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;duplicacao_codigo&quot;</span><span class="p">:</span> <span class="s2">&quot;25%&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cobertura_testes&quot;</span><span class="p">:</span> <span class="s2">&quot;0%&quot;</span><span class="p">,</span>
    <span class="s2">&quot;acoplamento_eferente&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># N√£o usa outras classes</span>
    <span class="s2">&quot;acoplamento_aferente&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># N√£o √© usada por outras classes</span>
    <span class="s2">&quot;cohesao_lcom&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># Baixa coes√£o</span>
    <span class="s2">&quot;responsabilidades_por_classe&quot;</span><span class="p">:</span> <span class="mi">7</span>
<span class="p">}</span>

<span class="n">METRICAS_DEPOIS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;linhas_codigo&quot;</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span>  <span class="c1"># Mais linhas, mas melhor organizado</span>
    <span class="s2">&quot;numero_classes&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;numero_metodos&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="s2">&quot;complexidade_ciclomatica_media&quot;</span><span class="p">:</span> <span class="mf">2.1</span><span class="p">,</span>
    <span class="s2">&quot;complexidade_ciclomatica_maxima&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;numero_parametros_max&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;duplicacao_codigo&quot;</span><span class="p">:</span> <span class="s2">&quot;0%&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cobertura_testes&quot;</span><span class="p">:</span> <span class="s2">&quot;85%&quot;</span><span class="p">,</span>
    <span class="s2">&quot;acoplamento_eferente&quot;</span><span class="p">:</span> <span class="mf">2.3</span><span class="p">,</span>  <span class="c1"># Usa poucas depend√™ncias externas</span>
    <span class="s2">&quot;acoplamento_aferente&quot;</span><span class="p">:</span> <span class="mf">1.8</span><span class="p">,</span>  <span class="c1"># √â usada por poucas classes</span>
    <span class="s2">&quot;cohesao_lcom&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>  <span class="c1"># Alta coes√£o</span>
    <span class="s2">&quot;responsabilidades_por_classe&quot;</span><span class="p">:</span> <span class="mf">1.2</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calcular_impacto_refatoracao</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calcula o impacto quantitativo da refatora√ß√£o.&quot;&quot;&quot;</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== AN√ÅLISE DE IMPACTO DA REFATORA√á√ÉO ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">melhorias</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Complexidade Ciclom√°tica M√©dia&quot;</span><span class="p">,</span> <span class="n">METRICAS_ANTES</span><span class="p">[</span><span class="s2">&quot;complexidade_ciclomatica_media&quot;</span><span class="p">],</span> 
         <span class="n">METRICAS_DEPOIS</span><span class="p">[</span><span class="s2">&quot;complexidade_ciclomatica_media&quot;</span><span class="p">],</span> <span class="s2">&quot;menor √© melhor&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Complexidade Ciclom√°tica M√°xima&quot;</span><span class="p">,</span> <span class="n">METRICAS_ANTES</span><span class="p">[</span><span class="s2">&quot;complexidade_ciclomatica_maxima&quot;</span><span class="p">],</span>
         <span class="n">METRICAS_DEPOIS</span><span class="p">[</span><span class="s2">&quot;complexidade_ciclomatica_maxima&quot;</span><span class="p">],</span> <span class="s2">&quot;menor √© melhor&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Responsabilidades por Classe&quot;</span><span class="p">,</span> <span class="n">METRICAS_ANTES</span><span class="p">[</span><span class="s2">&quot;responsabilidades_por_classe&quot;</span><span class="p">],</span>
         <span class="n">METRICAS_DEPOIS</span><span class="p">[</span><span class="s2">&quot;responsabilidades_por_classe&quot;</span><span class="p">],</span> <span class="s2">&quot;menor √© melhor&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Coes√£o (LCOM)&quot;</span><span class="p">,</span> <span class="n">METRICAS_ANTES</span><span class="p">[</span><span class="s2">&quot;cohesao_lcom&quot;</span><span class="p">],</span>
         <span class="n">METRICAS_DEPOIS</span><span class="p">[</span><span class="s2">&quot;cohesao_lcom&quot;</span><span class="p">],</span> <span class="s2">&quot;maior √© melhor&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Cobertura de Testes&quot;</span><span class="p">,</span> <span class="n">METRICAS_ANTES</span><span class="p">[</span><span class="s2">&quot;cobertura_testes&quot;</span><span class="p">],</span>
         <span class="n">METRICAS_DEPOIS</span><span class="p">[</span><span class="s2">&quot;cobertura_testes&quot;</span><span class="p">],</span> <span class="s2">&quot;maior √© melhor&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    
    <span class="k">for</span> <span class="n">nome</span><span class="p">,</span> <span class="n">antes</span><span class="p">,</span> <span class="n">depois</span><span class="p">,</span> <span class="n">direcao</span> <span class="ow">in</span> <span class="n">melhorias</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;menor √© melhor&quot;</span> <span class="ow">in</span> <span class="n">direcao</span><span class="p">:</span>
            <span class="n">melhoria</span> <span class="o">=</span> <span class="p">((</span><span class="n">antes</span> <span class="o">-</span> <span class="n">depois</span><span class="p">)</span> <span class="o">/</span> <span class="n">antes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">antes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Evitar divis√£o por zero</span>
                <span class="n">melhoria</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">melhoria</span> <span class="o">=</span> <span class="p">((</span><span class="n">depois</span> <span class="o">-</span> <span class="n">antes</span><span class="p">)</span> <span class="o">/</span> <span class="n">antes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nome</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Antes: </span><span class="si">{</span><span class="n">antes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Depois: </span><span class="si">{</span><span class="n">depois</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Melhoria: </span><span class="si">{</span><span class="n">melhoria</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">calcular_impacto_refatoracao</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="exemplos-de-codigo-comentado">
<h3>3.2. Exemplos de C√≥digo Comentado<a class="headerlink" href="#exemplos-de-codigo-comentado" title="Link to this heading">#</a></h3>
<p>Nesta se√ß√£o, demonstraremos <strong>padr√µes ‚ÄúAntes √ó Depois‚Äù</strong> para cada t√©cnica de refatora√ß√£o principal, com coment√°rios pedag√≥gicos detalhados explicando as decis√µes de design.</p>
<section id="extract-method-decomposicao-de-complexidade">
<h4>Extract Method: Decomposi√ß√£o de Complexidade<a class="headerlink" href="#extract-method-decomposicao-de-complexidade" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># exemplo_extract_method.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">T√âCNICA: Extract Method</span>
<span class="sd">PROBLEMA: Long Method com m√∫ltiplas responsabilidades</span>
<span class="sd">SOLU√á√ÉO: Decompor em m√©todos menores e especializados</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># ===== ANTES: M√©todo com m√∫ltiplas responsabilidades =====</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RelatorioVendas</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gerar_relatorio_complexo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vendas_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PROBLEMAS IDENTIFICADOS:</span>
<span class="sd">        - 45 linhas de c√≥digo em um √∫nico m√©todo</span>
<span class="sd">        - Complexidade ciclom√°tica = 8</span>
<span class="sd">        - M√∫ltiplas responsabilidades: filtragem, c√°lculo, formata√ß√£o</span>
<span class="sd">        - Dif√≠cil de testar individualmente</span>
<span class="sd">        - Dif√≠cil de reutilizar partes da l√≥gica</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">relatorio</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Filtrar vendas do m√™s atual (8 linhas)</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
        <span class="n">hoje</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">inicio_mes</span> <span class="o">=</span> <span class="n">hoje</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">vendas_mes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">venda</span> <span class="ow">in</span> <span class="n">vendas_data</span><span class="p">:</span>
            <span class="n">data_venda</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">venda</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">data_venda</span> <span class="o">&gt;=</span> <span class="n">inicio_mes</span><span class="p">:</span>
                <span class="n">vendas_mes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">venda</span><span class="p">)</span>
        
        <span class="c1"># Calcular estat√≠sticas (15 linhas)</span>
        <span class="n">total_vendas</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_itens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">vendas_por_categoria</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">venda</span> <span class="ow">in</span> <span class="n">vendas_mes</span><span class="p">:</span>
            <span class="n">total_vendas</span> <span class="o">+=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span>
            <span class="n">total_itens</span> <span class="o">+=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;quantidade&#39;</span><span class="p">]</span>
            
            <span class="n">categoria</span> <span class="o">=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;categoria&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">categoria</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vendas_por_categoria</span><span class="p">:</span>
                <span class="n">vendas_por_categoria</span><span class="p">[</span><span class="n">categoria</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;valor&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;quantidade&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">vendas_por_categoria</span><span class="p">[</span><span class="n">categoria</span><span class="p">][</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span>
            <span class="n">vendas_por_categoria</span><span class="p">[</span><span class="n">categoria</span><span class="p">][</span><span class="s1">&#39;quantidade&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;quantidade&#39;</span><span class="p">]</span>
        
        <span class="n">ticket_medio</span> <span class="o">=</span> <span class="n">total_vendas</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">vendas_mes</span><span class="p">)</span> <span class="k">if</span> <span class="n">vendas_mes</span> <span class="k">else</span> <span class="mi">0</span>
        
        <span class="c1"># Identificar top produtos (10 linhas)</span>
        <span class="n">produtos_vendas</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">venda</span> <span class="ow">in</span> <span class="n">vendas_mes</span><span class="p">:</span>
            <span class="n">produto</span> <span class="o">=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;produto&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">produto</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">produtos_vendas</span><span class="p">:</span>
                <span class="n">produtos_vendas</span><span class="p">[</span><span class="n">produto</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">produtos_vendas</span><span class="p">[</span><span class="n">produto</span><span class="p">]</span> <span class="o">+=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span>
        
        <span class="n">top_produtos</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">produtos_vendas</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
        
        <span class="c1"># Formatar relat√≥rio (12 linhas)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== RELAT√ìRIO DE VENDAS - </span><span class="si">{</span><span class="n">hoje</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%B %Y&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total de Vendas: R$ </span><span class="si">{</span><span class="n">total_vendas</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total de Itens: </span><span class="si">{</span><span class="n">total_itens</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ticket M√©dio: R$ </span><span class="si">{</span><span class="n">ticket_medio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N√∫mero de Transa√ß√µes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vendas_mes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Top 5 Produtos:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">produto</span><span class="p">,</span> <span class="n">valor</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_produtos</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">produto</span><span class="si">}</span><span class="s2">: R$ </span><span class="si">{</span><span class="n">valor</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Vendas por Categoria:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">categoria</span><span class="p">,</span> <span class="n">dados</span> <span class="ow">in</span> <span class="n">vendas_por_categoria</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">categoria</span><span class="si">}</span><span class="s2">: R$ </span><span class="si">{</span><span class="n">dados</span><span class="p">[</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">dados</span><span class="p">[</span><span class="s1">&#39;quantidade&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> itens)&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relatorio</span><span class="p">)</span>

<span class="c1"># ===== DEPOIS: M√©todos especializados e focados =====</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RelatorioVendasRefatorado</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MELHORIAS IMPLEMENTADAS:</span>
<span class="sd">    ‚úÖ Cada m√©todo tem uma √∫nica responsabilidade</span>
<span class="sd">    ‚úÖ M√©todos pequenos (&lt; 10 linhas cada)</span>
<span class="sd">    ‚úÖ F√°cil de testar cada parte isoladamente</span>
<span class="sd">    ‚úÖ Reutiliza√ß√£o de l√≥gica (filtros podem ser usados em outros relat√≥rios)</span>
<span class="sd">    ‚úÖ Baixa complexidade ciclom√°tica (&lt; 3 por m√©todo)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">gerar_relatorio_complexo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vendas_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        M√©todo principal agora √© um orchestrator.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIOS:</span>
<span class="sd">        - L√≥gica de alto n√≠vel clara e leg√≠vel</span>
<span class="sd">        - F√°cil de modificar sem afetar c√°lculos espec√≠ficos</span>
<span class="sd">        - Cada etapa pode ser testada independentemente</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vendas_mes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtrar_vendas_mes_atual</span><span class="p">(</span><span class="n">vendas_data</span><span class="p">)</span>
        <span class="n">estatisticas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calcular_estatisticas</span><span class="p">(</span><span class="n">vendas_mes</span><span class="p">)</span>
        <span class="n">top_produtos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_identificar_top_produtos</span><span class="p">(</span><span class="n">vendas_mes</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">vendas_categoria</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agrupar_por_categoria</span><span class="p">(</span><span class="n">vendas_mes</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatar_relatorio</span><span class="p">(</span><span class="n">estatisticas</span><span class="p">,</span> <span class="n">top_produtos</span><span class="p">,</span> <span class="n">vendas_categoria</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_filtrar_vendas_mes_atual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vendas_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filtra vendas do m√™s atual.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIOS DA EXTRA√á√ÉO:</span>
<span class="sd">        - L√≥gica de filtragem isolada e test√°vel</span>
<span class="sd">        - Pode ser reutilizada em outros relat√≥rios</span>
<span class="sd">        - F√°cil de modificar crit√©rios de filtro</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
        <span class="n">hoje</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">inicio_mes</span> <span class="o">=</span> <span class="n">hoje</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">venda</span> <span class="k">for</span> <span class="n">venda</span> <span class="ow">in</span> <span class="n">vendas_data</span>
            <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">venda</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">inicio_mes</span>
        <span class="p">]</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calcular_estatisticas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vendas</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calcula estat√≠sticas b√°sicas das vendas.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIOS:</span>
<span class="sd">        - C√°lculos centralizados em um s√≥ lugar</span>
<span class="sd">        - Retorno estruturado facilita testes</span>
<span class="sd">        - Pode ser facilmente estendido com novas m√©tricas</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vendas</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;total_vendas&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;total_itens&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;ticket_medio&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;numero_transacoes&#39;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
        
        <span class="n">total_vendas</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">venda</span><span class="p">[</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">venda</span> <span class="ow">in</span> <span class="n">vendas</span><span class="p">)</span>
        <span class="n">total_itens</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">venda</span><span class="p">[</span><span class="s1">&#39;quantidade&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">venda</span> <span class="ow">in</span> <span class="n">vendas</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;total_vendas&#39;</span><span class="p">:</span> <span class="n">total_vendas</span><span class="p">,</span>
            <span class="s1">&#39;total_itens&#39;</span><span class="p">:</span> <span class="n">total_itens</span><span class="p">,</span>
            <span class="s1">&#39;ticket_medio&#39;</span><span class="p">:</span> <span class="n">total_vendas</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">vendas</span><span class="p">),</span>
            <span class="s1">&#39;numero_transacoes&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">vendas</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_identificar_top_produtos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vendas</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identifica produtos com maior volume de vendas.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIOS:</span>
<span class="sd">        - Algoritmo de ranking isolado</span>
<span class="sd">        - Par√¢metro limit flex√≠vel</span>
<span class="sd">        - F√°cil de modificar crit√©rio de ranking</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">produtos_vendas</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">venda</span> <span class="ow">in</span> <span class="n">vendas</span><span class="p">:</span>
            <span class="n">produto</span> <span class="o">=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;produto&#39;</span><span class="p">]</span>
            <span class="n">produtos_vendas</span><span class="p">[</span><span class="n">produto</span><span class="p">]</span> <span class="o">=</span> <span class="n">produtos_vendas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">produto</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">produtos_vendas</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="n">limit</span><span class="p">]</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_agrupar_por_categoria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vendas</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Agrupa vendas por categoria.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIOS:</span>
<span class="sd">        - L√≥gica de agrupamento reutiliz√°vel</span>
<span class="sd">        - Estrutura de dados clara para resultado</span>
<span class="sd">        - Pode ser facilmente adaptada para outras dimens√µes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vendas_por_categoria</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">venda</span> <span class="ow">in</span> <span class="n">vendas</span><span class="p">:</span>
            <span class="n">categoria</span> <span class="o">=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;categoria&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">categoria</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vendas_por_categoria</span><span class="p">:</span>
                <span class="n">vendas_por_categoria</span><span class="p">[</span><span class="n">categoria</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;valor&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;quantidade&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            
            <span class="n">vendas_por_categoria</span><span class="p">[</span><span class="n">categoria</span><span class="p">][</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span>
            <span class="n">vendas_por_categoria</span><span class="p">[</span><span class="n">categoria</span><span class="p">][</span><span class="s1">&#39;quantidade&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">venda</span><span class="p">[</span><span class="s1">&#39;quantidade&#39;</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">vendas_por_categoria</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_formatar_relatorio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estatisticas</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">top_produtos</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">vendas_categoria</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formata dados em relat√≥rio leg√≠vel.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIOS:</span>
<span class="sd">        - Formata√ß√£o isolada da l√≥gica de neg√≥cio</span>
<span class="sd">        - F√°cil de modificar layout sem afetar c√°lculos</span>
<span class="sd">        - Pode ser facilmente adaptada para diferentes formatos (HTML, PDF, etc.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
        <span class="n">relatorio</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Cabe√ßalho</span>
        <span class="n">mes_atual</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%B %Y&#39;</span><span class="p">)</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== RELAT√ìRIO DE VENDAS - </span><span class="si">{</span><span class="n">mes_atual</span><span class="si">}</span><span class="s2"> ===&quot;</span><span class="p">)</span>
        
        <span class="c1"># Estat√≠sticas gerais</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
            <span class="sa">f</span><span class="s2">&quot;Total de Vendas: R$ </span><span class="si">{</span><span class="n">estatisticas</span><span class="p">[</span><span class="s1">&#39;total_vendas&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Total de Itens: </span><span class="si">{</span><span class="n">estatisticas</span><span class="p">[</span><span class="s1">&#39;total_itens&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Ticket M√©dio: R$ </span><span class="si">{</span><span class="n">estatisticas</span><span class="p">[</span><span class="s1">&#39;ticket_medio&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;N√∫mero de Transa√ß√µes: </span><span class="si">{</span><span class="n">estatisticas</span><span class="p">[</span><span class="s1">&#39;numero_transacoes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span>
        <span class="p">])</span>
        
        <span class="c1"># Top produtos</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Top Produtos:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">produto</span><span class="p">,</span> <span class="n">valor</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_produtos</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">produto</span><span class="si">}</span><span class="s2">: R$ </span><span class="si">{</span><span class="n">valor</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Vendas por categoria</span>
        <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Vendas por Categoria:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">categoria</span><span class="p">,</span> <span class="n">dados</span> <span class="ow">in</span> <span class="n">vendas_categoria</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">relatorio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">categoria</span><span class="si">}</span><span class="s2">: R$ </span><span class="si">{</span><span class="n">dados</span><span class="p">[</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">dados</span><span class="p">[</span><span class="s1">&#39;quantidade&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> itens)&quot;</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">relatorio</span><span class="p">)</span>

<span class="c1"># COMPARA√á√ÉO DE TESTES: Como a refatora√ß√£o facilita testes</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestRelatorioVendasRefatorado</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Demonstra como m√©todos extra√≠dos facilitam testes unit√°rios.</span>
<span class="sd">    </span>
<span class="sd">    ANTES: Apenas um teste complexo para o m√©todo gigante</span>
<span class="sd">    DEPOIS: Testes espec√≠ficos e isolados para cada responsabilidade</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">test_filtrar_vendas_mes_atual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Testa isoladamente a l√≥gica de filtro.&quot;&quot;&quot;</span>
        <span class="n">relatorio</span> <span class="o">=</span> <span class="n">RelatorioVendasRefatorado</span><span class="p">()</span>
        
        <span class="n">vendas_mock</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-01-15T10:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>  <span class="c1"># M√™s passado</span>
            <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-02-10T10:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>  <span class="c1"># M√™s atual</span>
            <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-02-20T10:00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>  <span class="c1"># M√™s atual</span>
        <span class="p">]</span>
        
        <span class="c1"># Assumindo que estamos em fevereiro de 2024</span>
        <span class="n">resultado</span> <span class="o">=</span> <span class="n">relatorio</span><span class="o">.</span><span class="n">_filtrar_vendas_mes_atual</span><span class="p">(</span><span class="n">vendas_mock</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">resultado</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">venda</span><span class="p">[</span><span class="s1">&#39;valor&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span> <span class="k">for</span> <span class="n">venda</span> <span class="ow">in</span> <span class="n">resultado</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">test_calcular_estatisticas_vendas_vazias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Testa comportamento com lista vazia.&quot;&quot;&quot;</span>
        <span class="n">relatorio</span> <span class="o">=</span> <span class="n">RelatorioVendasRefatorado</span><span class="p">()</span>
        
        <span class="n">resultado</span> <span class="o">=</span> <span class="n">relatorio</span><span class="o">.</span><span class="n">_calcular_estatisticas</span><span class="p">([])</span>
        
        <span class="k">assert</span> <span class="n">resultado</span><span class="p">[</span><span class="s1">&#39;total_vendas&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">resultado</span><span class="p">[</span><span class="s1">&#39;ticket_medio&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">resultado</span><span class="p">[</span><span class="s1">&#39;numero_transacoes&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">test_identificar_top_produtos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Testa algoritmo de ranking de produtos.&quot;&quot;&quot;</span>
        <span class="n">relatorio</span> <span class="o">=</span> <span class="n">RelatorioVendasRefatorado</span><span class="p">()</span>
        
        <span class="n">vendas_mock</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;produto&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;produto&#39;</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;produto&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>  <span class="c1"># Total A = 300</span>
            <span class="p">{</span><span class="s1">&#39;produto&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">},</span>
        <span class="p">]</span>
        
        <span class="n">resultado</span> <span class="o">=</span> <span class="n">relatorio</span><span class="o">.</span><span class="n">_identificar_top_produtos</span><span class="p">(</span><span class="n">vendas_mock</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Devem estar ordenados por valor total: A(300), B(300), C(150)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">resultado</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">assert</span> <span class="n">resultado</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">resultado</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Verificar ordena√ß√£o</span>
</pre></div>
</div>
</section>
</section>
<section id="ferramentas-bibliotecas-e-ecossistema">
<h3>3.3. Ferramentas, Bibliotecas e Ecossistema<a class="headerlink" href="#ferramentas-bibliotecas-e-ecossistema" title="Link to this heading">#</a></h3>
<p>Para a demonstra√ß√£o dos conceitos de refatora√ß√£o e integra√ß√£o com an√°lise de qualidade nesta aula, utilizamos <strong>exclusivamente recursos nativos do Python 3.12+</strong> para os exemplos de c√≥digo e sistema de e-commerce. Esta escolha refor√ßa que os princ√≠pios de refatora√ß√£o s√£o fundamentais √† estrutura√ß√£o do c√≥digo e n√£o dependem de ferramentas de terceiros.</p>
<section id="ferramentas-de-analise-de-qualidade-utilizadas">
<h4>Ferramentas de An√°lise de Qualidade Utilizadas<a class="headerlink" href="#ferramentas-de-analise-de-qualidade-utilizadas" title="Link to this heading">#</a></h4>
<p><strong>1. Pylint (v3.0+)</strong></p>
<ul class="simple">
<li><p><strong>Fun√ß√£o:</strong> An√°lise abrangente de qualidade incluindo detec√ß√£o de code smells</p></li>
<li><p><strong>Configura√ß√£o:</strong> Arquivo <code class="docutils literal notranslate"><span class="pre">.pylintrc</span></code> customizado para m√©tricas de complexidade</p></li>
<li><p><strong>Justificativa:</strong> Ferramenta mais completa para detec√ß√£o dos code smells demonstrados</p></li>
<li><p><strong>Uso no estudo de caso:</strong> Valida√ß√£o das melhorias ap√≥s refatora√ß√£o</p></li>
</ul>
<p><strong>2. Flake8 (v6.0+)</strong></p>
<ul class="simple">
<li><p><strong>Fun√ß√£o:</strong> Verifica√ß√£o de conformidade com PEP 8 e complexidade ciclom√°tica</p></li>
<li><p><strong>Configura√ß√£o:</strong> <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> com limite de complexidade = 10</p></li>
<li><p><strong>Justificativa:</strong> Complementa Pylint com verifica√ß√µes r√°pidas de estilo</p></li>
<li><p><strong>Uso no estudo de caso:</strong> Valida√ß√£o cont√≠nua durante processo de refatora√ß√£o</p></li>
</ul>
<p><strong>3. SonarCloud</strong></p>
<ul class="simple">
<li><p><strong>Fun√ß√£o:</strong> Plataforma de Quality Gate integrada ao pipeline CI/CD</p></li>
<li><p><strong>Configura√ß√£o:</strong> <code class="docutils literal notranslate"><span class="pre">sonar-project.properties</span></code> com m√©tricas customizadas</p></li>
<li><p><strong>Justificativa:</strong> Demonstra integra√ß√£o profissional de qualidade automatizada</p></li>
<li><p><strong>Uso no estudo de caso:</strong> Quality Gate autom√°tico para bloquear merge de c√≥digo com baixa qualidade</p></li>
</ul>
</section>
<section id="ferramentas-de-teste-e-cobertura">
<h4>Ferramentas de Teste e Cobertura<a class="headerlink" href="#ferramentas-de-teste-e-cobertura" title="Link to this heading">#</a></h4>
<p><strong>4. Pytest (v7.4+)</strong></p>
<ul class="simple">
<li><p><strong>Fun√ß√£o:</strong> Framework de testes para caracterization tests e TDD</p></li>
<li><p><strong>Justificativa:</strong> Essencial para criar rede de seguran√ßa antes da refatora√ß√£o</p></li>
<li><p><strong>Uso no estudo de caso:</strong> Testes que garantem comportamento preservado</p></li>
</ul>
<p><strong>5. <a class="reference external" href="http://Coverage.py">Coverage.py</a> (v7.3+)</strong></p>
<ul class="simple">
<li><p><strong>Fun√ß√£o:</strong> Medi√ß√£o de cobertura de c√≥digo para m√©tricas de qualidade</p></li>
<li><p><strong>Justificativa:</strong> Demonstra impacto da refatora√ß√£o na testabilidade</p></li>
<li><p><strong>Uso no estudo de caso:</strong> Evidencia melhoria de 0% para 85% de cobertura</p></li>
</ul>
</section>
<section id="ferramentas-de-ci-cd">
<h4>Ferramentas de CI/CD<a class="headerlink" href="#ferramentas-de-ci-cd" title="Link to this heading">#</a></h4>
<p><strong>6. GitHub Actions</strong></p>
<ul class="simple">
<li><p><strong>Fun√ß√£o:</strong> Pipeline automatizado de qualidade</p></li>
<li><p><strong>Justificativa:</strong> Integra√ß√£o nativa com reposit√≥rios Git e SonarCloud</p></li>
<li><p><strong>Uso no estudo de caso:</strong> Workflow completo de quality gate</p></li>
</ul>
<p>Estas ferramentas foram <strong>especificamente escolhidas e configuradas</strong> para demonstrar na pr√°tica os conceitos te√≥ricos apresentados nas se√ß√µes anteriores, formando um ecossistema completo de qualidade de c√≥digo que vai desde a detec√ß√£o local de problemas at√© a integra√ß√£o automatizada em pipelines de produ√ß√£o.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section id="topicos-avancados-e-nuances">
<h2>4. T√≥picos Avan√ßados e Nuances<a class="headerlink" href="#topicos-avancados-e-nuances" title="Link to this heading">#</a></h2>
<section id="desafios-comuns-e-anti-padroes">
<h3>4.1. Desafios Comuns e ‚ÄúAnti-Padr√µes‚Äù<a class="headerlink" href="#desafios-comuns-e-anti-padroes" title="Link to this heading">#</a></h3>
<p>A aplica√ß√£o de t√©cnicas de refatora√ß√£o em sistemas reais apresenta desafios que v√£o al√©m da identifica√ß√£o de code smells. Esta se√ß√£o explora as <strong>armadilhas mais comuns</strong> encontradas por desenvolvedores ao tentarem melhorar a qualidade do c√≥digo.</p>
<section id="over-engineering-o-perigo-da-refatoracao-excessiva">
<h4>Over-Engineering: O Perigo da Refatora√ß√£o Excessiva<a class="headerlink" href="#over-engineering-o-perigo-da-refatoracao-excessiva" title="Link to this heading">#</a></h4>
<p><strong>Problema:</strong> Desenvolvedores aplicam padr√µes de design complexos em problemas simples.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANTI-PADR√ÉO: Over-Engineering</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ERRO: Aplicar Factory + Strategy + Observer para um c√°lculo simples</span>
<span class="sd">CONTEXTO: Sistema que apenas precisa calcular imposto baseado no estado</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Implementa√ß√£o excessivamente complexa</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TipoImposto</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ICMS</span> <span class="o">=</span> <span class="s2">&quot;icms&quot;</span>
    <span class="n">ISS</span> <span class="o">=</span> <span class="s2">&quot;iss&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">EventoCalculoImposto</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">resultado</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valor</span> <span class="o">=</span> <span class="n">valor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resultado</span> <span class="o">=</span> <span class="n">resultado</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ObservadorImposto</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_imposto_calculado</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evento</span><span class="p">:</span> <span class="n">EventoCalculoImposto</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CalculadoraImpostoStrategy</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CalculadoraICMSSP</span><span class="p">(</span><span class="n">CalculadoraImpostoStrategy</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valor</span> <span class="o">*</span> <span class="mf">0.18</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CalculadoraICMSRJ</span><span class="p">(</span><span class="n">CalculadoraImpostoStrategy</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valor</span> <span class="o">*</span> <span class="mf">0.20</span>

<span class="k">class</span><span class="w"> </span><span class="nc">FabricaCalculadoraImposto</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">criar_calculadora</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estado</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tipo</span><span class="p">:</span> <span class="n">TipoImposto</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CalculadoraImpostoStrategy</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">estado</span> <span class="o">==</span> <span class="s2">&quot;SP&quot;</span> <span class="ow">and</span> <span class="n">tipo</span> <span class="o">==</span> <span class="n">TipoImposto</span><span class="o">.</span><span class="n">ICMS</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CalculadoraICMSSP</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">estado</span> <span class="o">==</span> <span class="s2">&quot;RJ&quot;</span> <span class="ow">and</span> <span class="n">tipo</span> <span class="o">==</span> <span class="n">TipoImposto</span><span class="o">.</span><span class="n">ICMS</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CalculadoraICMSRJ</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Combina√ß√£o n√£o suportada&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GerenciadorImpostos</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observadores</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ObservadorImposto</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fabrica</span> <span class="o">=</span> <span class="n">FabricaCalculadoraImposto</span><span class="p">()</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">adicionar_observador</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observador</span><span class="p">:</span> <span class="n">ObservadorImposto</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observadores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observador</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_imposto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">estado</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tipo</span><span class="p">:</span> <span class="n">TipoImposto</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">calculadora</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fabrica</span><span class="o">.</span><span class="n">criar_calculadora</span><span class="p">(</span><span class="n">estado</span><span class="p">,</span> <span class="n">tipo</span><span class="p">)</span>
        <span class="n">resultado</span> <span class="o">=</span> <span class="n">calculadora</span><span class="o">.</span><span class="n">calcular</span><span class="p">(</span><span class="n">valor</span><span class="p">)</span>
        
        <span class="n">evento</span> <span class="o">=</span> <span class="n">EventoCalculoImposto</span><span class="p">(</span><span class="n">valor</span><span class="p">,</span> <span class="n">resultado</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">observador</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">observadores</span><span class="p">:</span>
            <span class="n">observador</span><span class="o">.</span><span class="n">on_imposto_calculado</span><span class="p">(</span><span class="n">evento</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">resultado</span>

<span class="c1"># SOLU√á√ÉO SIMPLES E ADEQUADA</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calcular_icms</span><span class="p">(</span><span class="n">valor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">estado</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solu√ß√£o apropriada para o problema real.</span>
<span class="sd">    </span>
<span class="sd">    BENEF√çCIOS:</span>
<span class="sd">    - Simples de entender e manter</span>
<span class="sd">    - F√°cil de testar</span>
<span class="sd">    - Performance superior</span>
<span class="sd">    - Menos c√≥digo para manter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">taxas_icms</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;SP&quot;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span>
        <span class="s2">&quot;RJ&quot;</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span>
        <span class="s2">&quot;MG&quot;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span>
        <span class="s2">&quot;RS&quot;</span><span class="p">:</span> <span class="mf">0.17</span>
    <span class="p">}</span>
    
    <span class="n">taxa</span> <span class="o">=</span> <span class="n">taxas_icms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">estado</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">)</span>  <span class="c1"># Taxa padr√£o</span>
    <span class="k">return</span> <span class="n">valor</span> <span class="o">*</span> <span class="n">taxa</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>üö® Armadilhas a Evitar</strong></p>
<ol class="arabic simple">
<li><p><strong>Premature Optimization Pattern:</strong> Aplicar padr√µes complexos antes de ter requisitos que os justifiquem</p></li>
<li><p><strong>God Interface:</strong> Criar abstra√ß√µes que tentam resolver todos os problemas poss√≠veis</p></li>
<li><p><strong>Pattern Fever:</strong> Usar padr√µes porque s√£o ‚Äúelegantes‚Äù, n√£o porque resolvem problemas reais</p></li>
<li><p><strong>Architecture Astronaut:</strong> Criar solu√ß√µes gen√©ricas para problemas espec√≠ficos</p></li>
</ol>
</div></blockquote>
</section>
<section id="refatoracao-sem-testes-receita-para-o-desastre">
<h4>Refatora√ß√£o Sem Testes: Receita para o Desastre<a class="headerlink" href="#refatoracao-sem-testes-receita-para-o-desastre" title="Link to this heading">#</a></h4>
<p><strong>Problema:</strong> Tentar refatorar c√≥digo legado sem cobertura de testes adequada.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANTI-PADR√ÉO: Refatora√ß√£o sem rede de seguran√ßa</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SistemaLegado</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sistema com 5 anos de idade, m√∫ltiplas depend√™ncias externas,</span>
<span class="sd">    l√≥gica de neg√≥cio cr√≠tica e zero testes automatizados.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">processar_transacao_complexa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dados</span><span class="p">):</span>
        <span class="c1"># 200+ linhas de c√≥digo cr√≠tico sem testes</span>
        <span class="c1"># L√≥gica financeira que n√£o pode falhar</span>
        <span class="c1"># M√∫ltiplas integra√ß√µes com sistemas externos</span>
        <span class="c1"># Regras de neg√≥cio n√£o documentadas</span>
        <span class="k">pass</span>

<span class="c1"># ABORDAGEM CORRETA: Characterization Tests primeiro</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestSistemaLegado</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Primeira etapa: Caracterizar comportamento atual</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">test_processar_transacao_cenario_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Captura comportamento atual para cen√°rio t√≠pico.&quot;&quot;&quot;</span>
        <span class="n">sistema</span> <span class="o">=</span> <span class="n">SistemaLegado</span><span class="p">()</span>
        <span class="n">entrada</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_criar_entrada_padrao</span><span class="p">()</span>
        
        <span class="c1"># Executa e captura resultado atual</span>
        <span class="n">resultado</span> <span class="o">=</span> <span class="n">sistema</span><span class="o">.</span><span class="n">processar_transacao_complexa</span><span class="p">(</span><span class="n">entrada</span><span class="p">)</span>
        
        <span class="c1"># Documenta comportamento atual (mesmo que n√£o seja ideal)</span>
        <span class="k">assert</span> <span class="n">resultado</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;aprovado&quot;</span>
        <span class="k">assert</span> <span class="n">resultado</span><span class="o">.</span><span class="n">taxa_aplicada</span> <span class="o">==</span> <span class="mf">0.029</span>  <span class="c1"># Taxa atual do sistema</span>
        <span class="k">assert</span> <span class="n">resultado</span><span class="o">.</span><span class="n">codigo_retorno</span> <span class="o">==</span> <span class="s2">&quot;TXN_001&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">test_processar_transacao_edge_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Captura comportamento para casos extremos.&quot;&quot;&quot;</span>
        <span class="n">sistema</span> <span class="o">=</span> <span class="n">SistemaLegado</span><span class="p">()</span>
        
        <span class="c1"># Testa comportamentos descobertos em produ√ß√£o</span>
        <span class="n">resultado_valor_zero</span> <span class="o">=</span> <span class="n">sistema</span><span class="o">.</span><span class="n">processar_transacao_complexa</span><span class="p">({</span><span class="s2">&quot;valor&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="n">resultado_valor_negativo</span> <span class="o">=</span> <span class="n">sistema</span><span class="o">.</span><span class="n">processar_transacao_complexa</span><span class="p">({</span><span class="s2">&quot;valor&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">})</span>
        
        <span class="c1"># Documenta comportamento atual (mesmo que seja bug)</span>
        <span class="k">assert</span> <span class="n">resultado_valor_zero</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;erro&quot;</span>  <span class="c1"># Comportamento atual</span>
        <span class="k">assert</span> <span class="n">resultado_valor_negativo</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;aprovado&quot;</span>  <span class="c1"># Bug conhecido!</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RefatoracaoSegura</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estrat√©gia para refatora√ß√£o segura de c√≥digo legado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">estrategia_strangler_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PADR√ÉO: Strangler Fig</span>
<span class="sd">        Substitui funcionalidades gradualmente, mantendo sistema funcionando.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Interceptar chamadas para c√≥digo legado</span>
        <span class="c1"># 2. Implementar nova funcionalidade em paralelo</span>
        <span class="c1"># 3. Comparar resultados entre antiga e nova implementa√ß√£o</span>
        <span class="c1"># 4. Gradualmente transferir tr√°fego para nova implementa√ß√£o</span>
        <span class="c1"># 5. Remover c√≥digo antigo quando confian√ßa for alta</span>
        <span class="k">pass</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">estrategia_branch_by_abstraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PADR√ÉO: Branch by Abstraction</span>
<span class="sd">        Cria abstra√ß√£o que permite trocar implementa√ß√£o gradualmente.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Criar interface abstrata</span>
        <span class="c1"># 2. Implementar interface com c√≥digo legado</span>
        <span class="c1"># 3. Implementar interface com c√≥digo novo</span>
        <span class="c1"># 4. Usar feature flags para alternar entre implementa√ß√µes</span>
        <span class="c1"># 5. Validar equival√™ncia de comportamento</span>
        <span class="c1"># 6. Migrar gradualmente para nova implementa√ß√£o</span>
        <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="technical-debt-vs-business-pressure">
<h4>Technical Debt vs. Business Pressure<a class="headerlink" href="#technical-debt-vs-business-pressure" title="Link to this heading">#</a></h4>
<p><strong>Dilema:</strong> Como balancear press√£o por entregas com qualidade t√©cnica.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># FRAMEWORK PARA DECIS√ÉO: Technical Debt Quadrant</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TechnicalDebtDecision</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Framework para tomada de decis√£o sobre d√©bito t√©cnico.</span>
<span class="sd">    Baseado no modelo de Martin Fowler.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">avaliar_debt_quadrant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contexto</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Quadrantes do D√©bito T√©cnico:</span>
<span class="sd">        1. Reckless + Deliberate: &quot;N√£o temos tempo para design&quot;</span>
<span class="sd">        2. Reckless + Inadvertent: &quot;O que √© design em camadas?&quot;</span>
<span class="sd">        3. Prudent + Deliberate: &quot;Devemos entregar agora e lidar com consequ√™ncias&quot;</span>
<span class="sd">        4. Prudent + Inadvertent: &quot;Agora sabemos como dever√≠amos ter feito&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">urgencia</span> <span class="o">=</span> <span class="n">contexto</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;urgencia_business&quot;</span><span class="p">,</span> <span class="s2">&quot;media&quot;</span><span class="p">)</span>
        <span class="n">conhecimento_equipe</span> <span class="o">=</span> <span class="n">contexto</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;conhecimento_tecnico&quot;</span><span class="p">,</span> <span class="s2">&quot;medio&quot;</span><span class="p">)</span>
        <span class="n">criticidade</span> <span class="o">=</span> <span class="n">contexto</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;criticidade_sistema&quot;</span><span class="p">,</span> <span class="s2">&quot;media&quot;</span><span class="p">)</span>
        <span class="n">tempo_disponivel</span> <span class="o">=</span> <span class="n">contexto</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tempo_refatoracao&quot;</span><span class="p">,</span> <span class="s2">&quot;medio&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">urgencia</span> <span class="o">==</span> <span class="s2">&quot;critica&quot;</span> <span class="ow">and</span> <span class="n">tempo_disponivel</span> <span class="o">==</span> <span class="s2">&quot;pouco&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">conhecimento_equipe</span> <span class="o">==</span> <span class="s2">&quot;alto&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;PRUDENT_DELIBERATE&quot;</span>  <span class="c1"># Aceit√°vel temporariamente</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;RECKLESS_DELIBERATE&quot;</span>  <span class="c1"># Perigoso, evitar</span>
        
        <span class="k">elif</span> <span class="n">conhecimento_equipe</span> <span class="o">==</span> <span class="s2">&quot;baixo&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;INADVERTENT&quot;</span>  <span class="c1"># Investir em treinamento</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;REFACTOR_NOW&quot;</span>  <span class="c1"># Contexto favor√°vel para qualidade</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calcular_juros_debt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debt_points</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">velocidade_equipe</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calcula &quot;juros&quot; do d√©bito t√©cnico.</span>
<span class="sd">        </span>
<span class="sd">        CONCEITO: D√©bito t√©cnico acumula &quot;juros&quot; que reduzem velocidade.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># F√≥rmula baseada em estudos emp√≠ricos</span>
        <span class="n">reducao_velocidade</span> <span class="o">=</span> <span class="n">debt_points</span> <span class="o">*</span> <span class="mf">0.02</span>  <span class="c1"># 2% por ponto de d√©bito</span>
        <span class="n">velocidade_com_debt</span> <span class="o">=</span> <span class="n">velocidade_equipe</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">reducao_velocidade</span><span class="p">)</span>
        
        <span class="c1"># Custo de oportunidade</span>
        <span class="n">features_perdidas_por_sprint</span> <span class="o">=</span> <span class="p">(</span><span class="n">velocidade_equipe</span> <span class="o">-</span> <span class="n">velocidade_com_debt</span><span class="p">)</span>
        <span class="n">custo_mensal</span> <span class="o">=</span> <span class="n">features_perdidas_por_sprint</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># R$ 1000 por feature</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;velocidade_original&quot;</span><span class="p">:</span> <span class="n">velocidade_equipe</span><span class="p">,</span>
            <span class="s2">&quot;velocidade_com_debt&quot;</span><span class="p">:</span> <span class="n">velocidade_com_debt</span><span class="p">,</span>
            <span class="s2">&quot;reducao_percentual&quot;</span><span class="p">:</span> <span class="n">reducao_velocidade</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s2">&quot;custo_oportunidade_mensal&quot;</span><span class="p">:</span> <span class="n">custo_mensal</span><span class="p">,</span>
            <span class="s2">&quot;tempo_pagamento_debt&quot;</span><span class="p">:</span> <span class="n">debt_points</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># horas para refatorar</span>
            <span class="s2">&quot;roi_refatoracao&quot;</span><span class="p">:</span> <span class="n">custo_mensal</span> <span class="o">/</span> <span class="p">(</span><span class="n">debt_points</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># ROI mensal</span>
        <span class="p">}</span>

<span class="c1"># EXEMPLO DE USO DO FRAMEWORK</span>
<span class="k">def</span><span class="w"> </span><span class="nf">exemplo_decisao_debt</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstra uso pr√°tico do framework de decis√£o.&quot;&quot;&quot;</span>
    
    <span class="n">decisor</span> <span class="o">=</span> <span class="n">TechnicalDebtDecision</span><span class="p">()</span>
    
    <span class="c1"># Cen√°rio 1: Startup com deadline cr√≠tico</span>
    <span class="n">contexto_startup</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;urgencia_business&quot;</span><span class="p">:</span> <span class="s2">&quot;critica&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conhecimento_tecnico&quot;</span><span class="p">:</span> <span class="s2">&quot;alto&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;criticidade_sistema&quot;</span><span class="p">:</span> <span class="s2">&quot;alta&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tempo_refatoracao&quot;</span><span class="p">:</span> <span class="s2">&quot;pouco&quot;</span>
    <span class="p">}</span>
    
    <span class="n">decisao</span> <span class="o">=</span> <span class="n">decisor</span><span class="o">.</span><span class="n">avaliar_debt_quadrant</span><span class="p">(</span><span class="n">contexto_startup</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cen√°rio Startup: </span><span class="si">{</span><span class="n">decisao</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Cen√°rio 2: Empresa consolidada</span>
    <span class="n">contexto_consolidada</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;urgencia_business&quot;</span><span class="p">:</span> <span class="s2">&quot;baixa&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conhecimento_tecnico&quot;</span><span class="p">:</span> <span class="s2">&quot;alto&quot;</span><span class="p">,</span>
        <span class="s2">&quot;criticidade_sistema&quot;</span><span class="p">:</span> <span class="s2">&quot;media&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;tempo_refatoracao&quot;</span><span class="p">:</span> <span class="s2">&quot;muito&quot;</span>
    <span class="p">}</span>
    
    <span class="n">decisao</span> <span class="o">=</span> <span class="n">decisor</span><span class="o">.</span><span class="n">avaliar_debt_quadrant</span><span class="p">(</span><span class="n">contexto_consolidada</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cen√°rio Consolidada: </span><span class="si">{</span><span class="n">decisao</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># C√°lculo de impacto</span>
    <span class="n">impacto</span> <span class="o">=</span> <span class="n">decisor</span><span class="o">.</span><span class="n">calcular_juros_debt</span><span class="p">(</span><span class="n">debt_points</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">velocidade_equipe</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impacto do D√©bito: </span><span class="si">{</span><span class="n">impacto</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">exemplo_decisao_debt</span><span class="p">()</span>
<span class="c1"># Output esperado:</span>
<span class="c1"># Cen√°rio Startup: PRUDENT_DELIBERATE</span>
<span class="c1"># Cen√°rio Consolidada: REFACTOR_NOW</span>
<span class="c1"># Impacto do D√©bito: {&#39;velocidade_original&#39;: 8.0, &#39;velocidade_com_debt&#39;: 4.0, ...}</span>
</pre></div>
</div>
</section>
</section>
<section id="variacoes-e-arquiteturas-especializadas">
<h3>4.2. Varia√ß√µes e Arquiteturas Especializadas<a class="headerlink" href="#variacoes-e-arquiteturas-especializadas" title="Link to this heading">#</a></h3>
<section id="microservices-e-refatoracao-distribuida">
<h4>Microservices e Refatora√ß√£o Distribu√≠da<a class="headerlink" href="#microservices-e-refatoracao-distribuida" title="Link to this heading">#</a></h4>
<p><strong>Desafio:</strong> Como aplicar refatora√ß√£o em arquiteturas distribu√≠das.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># PADR√ÉO: Database per Service + Saga Pattern</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RefatoracaoMicroservices</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estrat√©gias espec√≠ficas para refatora√ß√£o em arquiteturas distribu√≠das.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">strangler_fig_distribuido</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aplica√ß√£o do padr√£o Strangler Fig em microservices.</span>
<span class="sd">        </span>
<span class="sd">        CONCEITO: Substituir servi√ßos legados gradualmente</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Criar novo microservice com funcionalidade refatorada</span>
        <span class="c1"># 2. Usar API Gateway para routing progressivo</span>
        <span class="c1"># 3. Implementar circuit breaker para fallback</span>
        <span class="c1"># 4. Monitorar m√©tricas comparativas</span>
        <span class="c1"># 5. Migrar gradualmente baseado em confian√ßa</span>
        <span class="k">pass</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">decomposicao_por_bounded_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refatora√ß√£o orientada por Domain-Driven Design.</span>
<span class="sd">        </span>
<span class="sd">        CONCEITO: Identificar bounded contexts e extrair servi√ßos</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Antes: Monolito com m√∫ltiplos dom√≠nios</span>
        <span class="k">class</span><span class="w"> </span><span class="nc">MonolitoEcommerce</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">processar_pedido</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">gerenciar_estoque</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>  
            <span class="k">def</span><span class="w"> </span><span class="nf">processar_pagamento</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">calcular_frete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">enviar_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
        
        <span class="c1"># Depois: Microservices por dom√≠nio</span>
        <span class="k">class</span><span class="w"> </span><span class="nc">ServicoGestaoEstoque</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">reservar_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">confirmar_reserva</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">cancelar_reserva</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
        
        <span class="k">class</span><span class="w"> </span><span class="nc">ServicoPagamentos</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">processar_pagamento</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">estornar_pagamento</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
        
        <span class="k">class</span><span class="w"> </span><span class="nc">ServicoLogistica</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">calcular_frete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">agendar_entrega</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>

<span class="c1"># PADR√ÉO: Event Sourcing para refatora√ß√£o gradual</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EventSourcingRefactoring</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uso de Event Sourcing para facilitar refatora√ß√£o de l√≥gica de neg√≥cio.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">migrar_com_eventos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estrat√©gia de migra√ß√£o baseada em eventos.</span>
<span class="sd">        </span>
<span class="sd">        BENEF√çCIO: Permite replay de eventos com nova l√≥gica</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Capturar todos os eventos do sistema atual</span>
        <span class="c1"># 2. Implementar nova l√≥gica de neg√≥cio</span>
        <span class="c1"># 3. Replay eventos com nova implementa√ß√£o</span>
        <span class="c1"># 4. Comparar resultados entre vers√µes</span>
        <span class="c1"># 5. Migrar quando equival√™ncia for comprovada</span>
        <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="refatoracao-para-performance">
<h4>Refatora√ß√£o para Performance<a class="headerlink" href="#refatoracao-para-performance" title="Link to this heading">#</a></h4>
<p><strong>Estrat√©gias espec√≠ficas para otimiza√ß√£o de performance mantendo qualidade.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># PADR√ÉO: Performance-Oriented Refactoring</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RefatoracaoPerformance</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    T√©cnicas de refatora√ß√£o focadas em performance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">cache_memoization_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refatora√ß√£o para adicionar cache sem alterar interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>
        
        <span class="c1"># ANTES: C√°lculo custoso repetitivo</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">calcular_preco_complexo</span><span class="p">(</span><span class="n">produto_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="c1"># Simula√ß√£o de c√°lculo custoso</span>
            <span class="c1"># - Consulta banco de dados</span>
            <span class="c1"># - Chamadas APIs externas</span>
            <span class="c1"># - C√°lculos matem√°ticos complexos</span>
            <span class="k">return</span> <span class="n">produto_id</span> <span class="o">*</span> <span class="n">quantidade</span> <span class="o">*</span> <span class="mf">1.23</span>  <span class="c1"># Simplificado</span>
        
        <span class="c1"># DEPOIS: Cache transparente</span>
        <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">calcular_preco_complexo_cached</span><span class="p">(</span><span class="n">produto_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">quantidade</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
            <span class="c1"># Mesma l√≥gica, mas com cache autom√°tico</span>
            <span class="k">return</span> <span class="n">produto_id</span> <span class="o">*</span> <span class="n">quantidade</span> <span class="o">*</span> <span class="mf">1.23</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">async_refactoring_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refatora√ß√£o de opera√ß√µes s√≠ncronas para ass√≠ncronas.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
        
        <span class="c1"># ANTES: Chamadas s√≠ncronas bloqueantes</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">validar_produtos_sincronos</span><span class="p">(</span><span class="n">produto_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">resultados</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">produto_id</span> <span class="ow">in</span> <span class="n">produto_ids</span><span class="p">:</span>
                <span class="c1"># Cada chamada bloqueia a pr√≥xima</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/api/produtos/</span><span class="si">{</span><span class="n">produto_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">resultados</span><span class="p">[</span><span class="n">produto_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">resultados</span>
        
        <span class="c1"># DEPOIS: Chamadas ass√≠ncronas concorrentes</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">validar_produtos_async</span><span class="p">(</span><span class="n">produto_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
                <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_validar_produto_individual</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">produto_id</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">produto_id</span> <span class="ow">in</span> <span class="n">produto_ids</span>
                <span class="p">]</span>
                <span class="c1"># Todas as chamadas executam concorrentemente</span>
                <span class="n">resultados</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">produto_ids</span><span class="p">,</span> <span class="n">resultados</span><span class="p">))</span>
        
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_validar_produto_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">produto_id</span><span class="p">):</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/api/produtos/</span><span class="si">{</span><span class="n">produto_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="analise-de-performance-e-otimizacao">
<h3>4.3. An√°lise de Performance e Otimiza√ß√£o<a class="headerlink" href="#analise-de-performance-e-otimizacao" title="Link to this heading">#</a></h3>
<section id="metricas-de-qualidade-vs-performance">
<h4>M√©tricas de Qualidade vs. Performance<a class="headerlink" href="#metricas-de-qualidade-vs-performance" title="Link to this heading">#</a></h4>
<p><strong>Trade-offs entre qualidade de c√≥digo e performance.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># AN√ÅLISE: Impacto da refatora√ß√£o na performance</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AnalisePerformanceRefatoracao</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Framework para medir impacto da refatora√ß√£o na performance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">benchmark_before_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">funcao_antes</span><span class="p">,</span> <span class="n">funcao_depois</span><span class="p">,</span> <span class="n">dados_teste</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compara performance antes e depois da refatora√ß√£o.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">statistics</span>
        
        <span class="k">def</span><span class="w"> </span><span class="nf">medir_execucao</span><span class="p">(</span><span class="n">funcao</span><span class="p">,</span> <span class="n">dados</span><span class="p">):</span>
            <span class="n">tempos</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>  <span class="c1"># 100 execu√ß√µes para m√©dia</span>
                <span class="n">inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
                <span class="n">funcao</span><span class="p">(</span><span class="n">dados</span><span class="p">)</span>
                <span class="n">fim</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
                <span class="n">tempos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fim</span> <span class="o">-</span> <span class="n">inicio</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tempos</span>
        
        <span class="n">tempos_antes</span> <span class="o">=</span> <span class="n">medir_execucao</span><span class="p">(</span><span class="n">funcao_antes</span><span class="p">,</span> <span class="n">dados_teste</span><span class="p">)</span>
        <span class="n">tempos_depois</span> <span class="o">=</span> <span class="n">medir_execucao</span><span class="p">(</span><span class="n">funcao_depois</span><span class="p">,</span> <span class="n">dados_teste</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;tempo_medio_antes&quot;</span><span class="p">:</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tempos_antes</span><span class="p">),</span>
            <span class="s2">&quot;tempo_medio_depois&quot;</span><span class="p">:</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tempos_depois</span><span class="p">),</span>
            <span class="s2">&quot;desvio_padrao_antes&quot;</span><span class="p">:</span> <span class="n">statistics</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span><span class="n">tempos_antes</span><span class="p">),</span>
            <span class="s2">&quot;desvio_padrao_depois&quot;</span><span class="p">:</span> <span class="n">statistics</span><span class="o">.</span><span class="n">stdev</span><span class="p">(</span><span class="n">tempos_depois</span><span class="p">),</span>
            <span class="s2">&quot;melhoria_percentual&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tempos_antes</span><span class="p">)</span> <span class="o">-</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tempos_depois</span><span class="p">))</span>
                <span class="o">/</span> <span class="n">statistics</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tempos_antes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">analise_complexidade_algoritmica</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An√°lise de como refatora√ß√£o afeta complexidade algoritmica.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># ANTES: O(n¬≤) - busca linear aninhada</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">buscar_duplicatas_ingenuo</span><span class="p">(</span><span class="n">lista</span><span class="p">):</span>
            <span class="n">duplicatas</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lista</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lista</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">lista</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                        <span class="n">duplicatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lista</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">duplicatas</span>
        
        <span class="c1"># DEPOIS: O(n) - usando set para busca</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">buscar_duplicatas_otimizado</span><span class="p">(</span><span class="n">lista</span><span class="p">):</span>
            <span class="n">vistas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">duplicatas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lista</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">vistas</span><span class="p">:</span>
                    <span class="n">duplicatas</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vistas</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">duplicatas</span><span class="p">)</span>
        
        <span class="c1"># Benchmark com dados crescentes</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
        <span class="n">tamanhos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">tamanho</span> <span class="ow">in</span> <span class="n">tamanhos</span><span class="p">:</span>
            <span class="n">dados</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tamanho</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tamanho</span><span class="p">)]</span>
            
            <span class="n">resultado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark_before_after</span><span class="p">(</span>
                <span class="n">buscar_duplicatas_ingenuo</span><span class="p">,</span>
                <span class="n">buscar_duplicatas_otimizado</span><span class="p">,</span>
                <span class="n">dados</span>
            <span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tamanho </span><span class="si">{</span><span class="n">tamanho</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">resultado</span><span class="p">[</span><span class="s1">&#39;melhoria_percentual&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% melhoria&quot;</span><span class="p">)</span>

<span class="c1"># PADR√ÉO: Performance Budgets para refatora√ß√£o</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PerformanceBudgets</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define or√ßamentos de performance que refatora√ß√£o deve respeitar.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">budgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;tempo_resposta_api&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>  <span class="c1"># ms</span>
            <span class="s2">&quot;uso_memoria_max&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>     <span class="c1"># MB</span>
            <span class="s2">&quot;cpu_utilization_max&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>  <span class="c1"># %</span>
            <span class="s2">&quot;database_queries_max&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># por opera√ß√£o</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">validar_refatoracao</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metricas_atuais</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Valida se refatora√ß√£o mant√©m performance dentro dos budgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">violacoes</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">metrica</span><span class="p">,</span> <span class="n">limite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">budgets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">valor_atual</span> <span class="o">=</span> <span class="n">metricas_atuais</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metrica</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">valor_atual</span> <span class="o">&gt;</span> <span class="n">limite</span><span class="p">:</span>
                <span class="n">violacoes</span><span class="p">[</span><span class="n">metrica</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;limite&quot;</span><span class="p">:</span> <span class="n">limite</span><span class="p">,</span>
                    <span class="s2">&quot;atual&quot;</span><span class="p">:</span> <span class="n">valor_atual</span><span class="p">,</span>
                    <span class="s2">&quot;excesso&quot;</span><span class="p">:</span> <span class="n">valor_atual</span> <span class="o">-</span> <span class="n">limite</span>
                <span class="p">}</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;aprovado&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">violacoes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;violacoes&quot;</span><span class="p">:</span> <span class="n">violacoes</span><span class="p">,</span>
            <span class="s2">&quot;score_performance&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calcular_score</span><span class="p">(</span><span class="n">metricas_atuais</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calcular_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metricas</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcula score de performance (0-100).&quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">metrica</span><span class="p">,</span> <span class="n">limite</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">budgets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">valor</span> <span class="o">=</span> <span class="n">metricas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metrica</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">score_metrica</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">limite</span> <span class="o">-</span> <span class="n">valor</span><span class="p">)</span> <span class="o">/</span> <span class="n">limite</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score_metrica</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

<span class="c1"># EXEMPLO DE MONITORAMENTO CONT√çNUO</span>
<span class="k">def</span><span class="w"> </span><span class="nf">exemplo_monitoramento_performance</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Demonstra monitoramento cont√≠nuo durante refatora√ß√£o.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">AnalisePerformanceRefatoracao</span><span class="p">()</span>
    <span class="n">budgets</span> <span class="o">=</span> <span class="n">PerformanceBudgets</span><span class="p">()</span>
    
    <span class="c1"># Simular m√©tricas antes da refatora√ß√£o</span>
    <span class="n">metricas_antes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;tempo_resposta_api&quot;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
        <span class="s2">&quot;uso_memoria_max&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
        <span class="s2">&quot;cpu_utilization_max&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s2">&quot;database_queries_max&quot;</span><span class="p">:</span> <span class="mi">3</span>
    <span class="p">}</span>
    
    <span class="c1"># Simular m√©tricas depois da refatora√ß√£o</span>
    <span class="n">metricas_depois</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;tempo_resposta_api&quot;</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span>  <span class="c1"># Slight degradation</span>
        <span class="s2">&quot;uso_memoria_max&quot;</span><span class="p">:</span> <span class="mi">350</span><span class="p">,</span>     <span class="c1"># Improvement</span>
        <span class="s2">&quot;cpu_utilization_max&quot;</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>  <span class="c1"># Slight degradation</span>
        <span class="s2">&quot;database_queries_max&quot;</span><span class="p">:</span> <span class="mi">2</span>   <span class="c1"># Improvement</span>
    <span class="p">}</span>
    
    <span class="n">resultado_antes</span> <span class="o">=</span> <span class="n">budgets</span><span class="o">.</span><span class="n">validar_refatoracao</span><span class="p">(</span><span class="n">metricas_antes</span><span class="p">)</span>
    <span class="n">resultado_depois</span> <span class="o">=</span> <span class="n">budgets</span><span class="o">.</span><span class="n">validar_refatoracao</span><span class="p">(</span><span class="n">metricas_depois</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performance antes da refatora√ß√£o:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Aprovado: </span><span class="si">{</span><span class="n">resultado_antes</span><span class="p">[</span><span class="s1">&#39;aprovado&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Score: </span><span class="si">{</span><span class="n">resultado_antes</span><span class="p">[</span><span class="s1">&#39;score_performance&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Performance depois da refatora√ß√£o:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Aprovado: </span><span class="si">{</span><span class="n">resultado_depois</span><span class="p">[</span><span class="s1">&#39;aprovado&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Score: </span><span class="si">{</span><span class="n">resultado_depois</span><span class="p">[</span><span class="s1">&#39;score_performance&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">resultado_depois</span><span class="p">[</span><span class="s1">&#39;score_performance&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">resultado_antes</span><span class="p">[</span><span class="s1">&#39;score_performance&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Refatora√ß√£o aprovada - performance mantida ou melhorada&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚ö†Ô∏è  Refatora√ß√£o requer otimiza√ß√£o adicional&quot;</span><span class="p">)</span>

<span class="n">exemplo_monitoramento_performance</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="sintese-e-perspectivas-futuras">
<h2>5. S√≠ntese e Perspectivas Futuras<a class="headerlink" href="#sintese-e-perspectivas-futuras" title="Link to this heading">#</a></h2>
<section id="conexoes-com-outras-areas-da-computacao">
<h3>5.1. Conex√µes com Outras √Åreas da Computa√ß√£o<a class="headerlink" href="#conexoes-com-outras-areas-da-computacao" title="Link to this heading">#</a></h3>
<p>A refatora√ß√£o de c√≥digo e qualidade de software estabelecem <strong>conex√µes fundamentais</strong> com m√∫ltiplas disciplinas da Ci√™ncia da Computa√ß√£o, criando um <strong>ecossistema interdisciplinar</strong> que amplifica o impacto das t√©cnicas apresentadas nesta aula.</p>
<section id="engenharia-de-software-e-devops">
<h4>Engenharia de Software e DevOps<a class="headerlink" href="#engenharia-de-software-e-devops" title="Link to this heading">#</a></h4>
<p><strong>Interdepend√™ncia Simbi√≥tica:</strong></p>
<p>A refatora√ß√£o √© um <strong>pilar central</strong> do movimento DevOps, onde <strong>qualidade cont√≠nua</strong> e <strong>entrega cont√≠nua</strong> s√£o mutuamente dependentes. As pr√°ticas de CI/CD demonstradas com SonarCloud representam a evolu√ß√£o natural da refatora√ß√£o manual para <strong>refatora√ß√£o automatizada</strong> em pipelines.</p>
<p><strong>Conex√µes Espec√≠ficas:</strong></p>
<ul class="simple">
<li><p><strong>Infrastructure as Code:</strong> Princ√≠pios de refatora√ß√£o aplicados a scripts Terraform e Ansible</p></li>
<li><p><strong>Configuration Management:</strong> Code smells em configura√ß√µes de sistemas distribu√≠dos</p></li>
<li><p><strong>Monitoring e Observability:</strong> M√©tricas de qualidade como indicadores de sa√∫de de sistema</p></li>
<li><p><strong>Site Reliability Engineering (SRE):</strong> Error budgets baseados em debt ratio de c√≥digo</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exemplo: Refatora√ß√£o aplicada a Infrastructure as Code</span>
<span class="k">def</span><span class="w"> </span><span class="nf">refatorar_terraform_modules</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aplica√ß√£o de Extract Module em infraestrutura.</span>
<span class="sd">    </span>
<span class="sd">    BEFORE: Arquivo terraform monol√≠tico de 500+ linhas</span>
<span class="sd">    AFTER: M√≥dulos especializados e reutiliz√°veis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># modules/vpc/main.tf</span>
    <span class="c1"># modules/security_groups/main.tf  </span>
    <span class="c1"># modules/ecs_cluster/main.tf</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="inteligencia-artificial-e-machine-learning">
<h4>Intelig√™ncia Artificial e Machine Learning<a class="headerlink" href="#inteligencia-artificial-e-machine-learning" title="Link to this heading">#</a></h4>
<p><strong>Fronteira Emergente:</strong> <strong>AI-Assisted Refactoring</strong></p>
<p>Ferramentas como <strong>GitHub Copilot</strong>, <strong>Amazon CodeWhisperer</strong> e <strong>DeepCode</strong> representam a <strong>converg√™ncia</strong> entre refatora√ß√£o e IA. Algoritmos de machine learning treinados em milh√µes de reposit√≥rios podem <strong>identificar padr√µes de code smells</strong> e <strong>sugerir refatora√ß√µes automaticamente</strong>.</p>
<p><strong>Aplica√ß√µes Espec√≠ficas:</strong></p>
<ul class="simple">
<li><p><strong>Predictive Code Quality:</strong> Modelos que preveem onde code smells aparecer√£o</p></li>
<li><p><strong>Automated Refactoring Suggestions:</strong> IA que sugere Extract Method baseado em contexto</p></li>
<li><p><strong>Code Generation:</strong> Gera√ß√£o autom√°tica de c√≥digo refatorado a partir de especifica√ß√µes</p></li>
<li><p><strong>Bug Prediction:</strong> Correla√ß√£o entre m√©tricas de qualidade e probabilidade de bugs</p></li>
</ul>
</section>
<section id="seguranca-da-informacao">
<h4>Seguran√ßa da Informa√ß√£o<a class="headerlink" href="#seguranca-da-informacao" title="Link to this heading">#</a></h4>
<p><strong>Qualidade como Base da Seguran√ßa:</strong></p>
<p>Code smells frequentemente <strong>indicam vulnerabilidades</strong> de seguran√ßa. C√≥digo complexo e mal estruturado √© mais propenso a <strong>falhas de valida√ß√£o</strong>, <strong>race conditions</strong> e <strong>buffer overflows</strong>.</p>
<p><strong>Conex√µes Cr√≠ticas:</strong></p>
<ul class="simple">
<li><p><strong>SAST (Static Application Security Testing):</strong> Evolu√ß√£o natural de ferramentas como SonarCloud</p></li>
<li><p><strong>Secure Coding Practices:</strong> Refatora√ß√£o orientada por princ√≠pios de seguran√ßa</p></li>
<li><p><strong>Vulnerability Assessment:</strong> M√©tricas de qualidade como indicadores de risco</p></li>
<li><p><strong>Zero Trust Architecture:</strong> Qualidade de c√≥digo como componente de confian√ßa</p></li>
</ul>
</section>
</section>
<section id="a-fronteira-da-pesquisa-e-o-futuro">
<h3>5.2. A Fronteira da Pesquisa e o Futuro<a class="headerlink" href="#a-fronteira-da-pesquisa-e-o-futuro" title="Link to this heading">#</a></h3>
<section id="quantum-computing-e-code-quality">
<h4>Quantum Computing e Code Quality<a class="headerlink" href="#quantum-computing-e-code-quality" title="Link to this heading">#</a></h4>
<p><strong>Pesquisa Emergente:</strong> Como aplicar m√©tricas de qualidade em <strong>algoritmos qu√¢nticos</strong>?</p>
<p>Pesquisadores em <strong>IBM Quantum</strong> e <strong>Google Quantum AI</strong> est√£o desenvolvendo m√©tricas espec√≠ficas para <strong>circuit depth</strong>, <strong>gate fidelity</strong> e <strong>quantum entanglement complexity</strong>. Conceitos de refatora√ß√£o est√£o sendo adaptados para <strong>otimiza√ß√£o de circuitos qu√¢nticos</strong>.</p>
</section>
<section id="refatoracao-automatica-com-large-language-models">
<h4>Refatora√ß√£o Autom√°tica com Large Language Models<a class="headerlink" href="#refatoracao-automatica-com-large-language-models" title="Link to this heading">#</a></h4>
<p><strong>Estado da Arte (2024-2025):</strong></p>
<ul class="simple">
<li><p><strong>GPT-4 Code Interpreter:</strong> Capacidade emergente de refatora√ß√£o autom√°tica</p></li>
<li><p><strong>CodeT5 e CodeBERT:</strong> Modelos especializados em transforma√ß√µes de c√≥digo</p></li>
<li><p><strong>Program Synthesis:</strong> Gera√ß√£o autom√°tica de c√≥digo refatorado a partir de especifica√ß√µes</p></li>
</ul>
<p><strong>Dire√ß√µes de Pesquisa:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Futuro: Refatora√ß√£o dirigida por linguagem natural</span>
<span class="k">def</span><span class="w"> </span><span class="nf">refatoracao_natural</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prompt: &quot;Refatore esta classe para aplicar Single Responsibility Principle&quot;</span>
<span class="sd">    </span>
<span class="sd">    LLM analisa c√≥digo ‚Üí Identifica responsabilidades ‚Üí Gera classes extra√≠das</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="continuous-quality-evolution">
<h4>Continuous Quality Evolution<a class="headerlink" href="#continuous-quality-evolution" title="Link to this heading">#</a></h4>
<p><strong>Tend√™ncia:</strong> Qualidade de c√≥digo como <strong>sistema adaptativo</strong></p>
<p>Pesquisas em <strong>Netflix</strong> e <strong>Microsoft</strong> exploram sistemas que <strong>evoluem automaticamente</strong> as m√©tricas de qualidade baseado em:</p>
<ul class="simple">
<li><p><strong>Hist√≥rico de bugs em produ√ß√£o</strong></p></li>
<li><p><strong>Feedback de desenvolvedores</strong></p></li>
<li><p><strong>Performance em runtime</strong></p></li>
<li><p><strong>Facilidade de manuten√ß√£o observada</strong></p></li>
</ul>
</section>
</section>
<section id="resumo-do-capitulo-e-mapa-mental">
<h3>5.3. Resumo do Cap√≠tulo e Mapa Mental<a class="headerlink" href="#resumo-do-capitulo-e-mapa-mental" title="Link to this heading">#</a></h3>
<section id="principais-conceitos-consolidados">
<h4>Principais Conceitos Consolidados<a class="headerlink" href="#principais-conceitos-consolidados" title="Link to this heading">#</a></h4>
<p>‚Ä¢ <strong>Code Smells:</strong> Indicadores sint√°ticos de problemas arquiteturais subjacentes
‚Ä¢ <strong>Refatora√ß√£o:</strong> Transforma√ß√£o disciplinada que preserva comportamento melhorando estrutura<br />
‚Ä¢ <strong>TDD + Refatora√ß√£o:</strong> Ciclo que garante qualidade evolutiva com seguran√ßa
‚Ä¢ <strong>An√°lise Est√°tica:</strong> Automatiza√ß√£o da detec√ß√£o de problemas via ferramentas
‚Ä¢ <strong>Quality Gates:</strong> Port√µes automatizados que garantem padr√µes m√≠nimos de qualidade
‚Ä¢ <strong>CI/CD Integration:</strong> Qualidade como parte integral do pipeline de entrega
‚Ä¢ <strong>Trade-offs:</strong> Balanceamento consciente entre qualidade, performance e velocity</p>
</section>
<section id="mapa-mental-ecossistema-de-qualidade">
<h4>Mapa Mental: Ecossistema de Qualidade<a class="headerlink" href="#mapa-mental-ecossistema-de-qualidade" title="Link to this heading">#</a></h4>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span>mindmap
  root((Qualidade de C√≥digo))
    Detec√ß√£o
      Code Smells
        God Class
        Long Method
        Data Clumps
        Feature Envy
      Ferramentas
        Pylint
        SonarCloud
        Flake8
        Bandit
    Corre√ß√£o
      T√©cnicas
        Extract Method
        Extract Class
        Move Method
        Replace Conditional
      Padr√µes
        Strategy
        Repository
        Factory
        Observer
    Preven√ß√£o
      TDD
        Red-Green-Refactor
        Characterization Tests
        Safety Net
      CI/CD
        Quality Gates
        Automated Analysis
        Performance Budgets
      Cultura
        Code Review
        Pair Programming
        Continuous Learning
    Medi√ß√£o
      M√©tricas
        Complexidade Ciclom√°tica
        Cobertura de Testes
        Debt Ratio
        Duplica√ß√£o
      ROI
        Velocidade Desenvolvimento
        Redu√ß√£o de Bugs
        Satisfa√ß√£o Equipe
        Time to Market
</pre></div>
</div>
</section>
</section>
<section id="referencias-e-leituras-adicionais">
<h3>5.4. Refer√™ncias e Leituras Adicionais<a class="headerlink" href="#referencias-e-leituras-adicionais" title="Link to this heading">#</a></h3>
<section id="livros-fundamentais">
<h4>Livros Fundamentais<a class="headerlink" href="#livros-fundamentais" title="Link to this heading">#</a></h4>
<p><strong>1. ‚ÄúRefactoring: Improving the Design of Existing Code‚Äù - Martin Fowler</strong></p>
<ul class="simple">
<li><p>URL: <a class="reference external" href="https://martinfowler.com/books/refactoring.html">https://martinfowler.com/books/refactoring.html</a></p></li>
<li><p><strong>Por que ler:</strong> Obra seminal que define formalmente as t√©cnicas de refatora√ß√£o</p></li>
</ul>
<p><strong>2. ‚ÄúClean Code: A Handbook of Agile Software Craftsmanship‚Äù - Robert C. Martin</strong></p>
<ul class="simple">
<li><p><strong>Por que ler:</strong> Princ√≠pios fundamentais para identifica√ß√£o e preven√ß√£o de code smells</p></li>
</ul>
<p><strong>3. ‚ÄúWorking Effectively with Legacy Code‚Äù - Michael Feathers</strong></p>
<ul class="simple">
<li><p><strong>Por que ler:</strong> Estrat√©gias pr√°ticas para refatora√ß√£o segura de sistemas legados</p></li>
</ul>
</section>
<section id="artigos-cientificos-e-papers">
<h4>Artigos Cient√≠ficos e Papers<a class="headerlink" href="#artigos-cientificos-e-papers" title="Link to this heading">#</a></h4>
<p><strong>4. ‚ÄúAn Empirical Study of the Impact of Code Smells on Software Quality‚Äù</strong></p>
<ul class="simple">
<li><p>Autores: Khomh et al. (2012)</p></li>
<li><p><strong>Insight:</strong> Correla√ß√£o quantitativa entre code smells e defeitos</p></li>
</ul>
<p><strong>5. ‚ÄúThe Economics of Software Quality: A Systematic Mapping‚Äù</strong></p>
<ul class="simple">
<li><p>Autores: Wagner et al. (2019)</p></li>
<li><p><strong>Insight:</strong> ROI quantificado de investimentos em qualidade</p></li>
</ul>
</section>
<section id="recursos-online-e-ferramentas">
<h4>Recursos Online e Ferramentas<a class="headerlink" href="#recursos-online-e-ferramentas" title="Link to this heading">#</a></h4>
<p><strong>6. SonarCloud Documentation</strong></p>
<ul class="simple">
<li><p>URL: <a class="reference external" href="https://docs.sonarcloud.io/">https://docs.sonarcloud.io/</a></p></li>
<li><p><strong>Valor:</strong> Implementa√ß√£o pr√°tica de quality gates</p></li>
</ul>
<p><strong>7. Refactoring Guru - Design Patterns</strong></p>
<ul class="simple">
<li><p>URL: <a class="reference external" href="https://refactoring.guru/">https://refactoring.guru/</a></p></li>
<li><p><strong>Valor:</strong> Cat√°logo visual de padr√µes de refatora√ß√£o</p></li>
</ul>
<p><strong>8. Martin Fowler‚Äôs Blog - Code Smells Catalog</strong></p>
<ul class="simple">
<li><p>URL: <a class="reference external" href="https://martinfowler.com/bliki/CodeSmell.html">https://martinfowler.com/bliki/CodeSmell.html</a></p></li>
<li><p><strong>Valor:</strong> Refer√™ncia atualizada sobre identifica√ß√£o de smells</p></li>
</ul>
</section>
<section id="cursos-e-certificacoes">
<h4>Cursos e Certifica√ß√µes<a class="headerlink" href="#cursos-e-certificacoes" title="Link to this heading">#</a></h4>
<p><strong>9. ‚ÄúSoftware Engineering: Software Design and Project Management‚Äù - University of Colorado</strong></p>
<ul class="simple">
<li><p>Plataforma: Coursera</p></li>
<li><p><strong>Foco:</strong> Aplica√ß√£o pr√°tica de princ√≠pios de qualidade em projetos reais</p></li>
</ul>
<p><strong>10. ‚ÄúClean Architecture: Patterns and Practices‚Äù - Microsoft Learn</strong></p>
<ul class="simple">
<li><p><strong>Foco:</strong> Arquiteturas que facilitam refatora√ß√£o cont√≠nua</p></li>
</ul>
<hr class="docutils" />
<p>O dom√≠nio completo destes recursos, combinado com a pr√°tica regular das t√©cnicas apresentadas nesta aula, estabelece uma <strong>base s√≥lida</strong> para evolu√ß√£o cont√≠nua como desenvolvedor orientado √† qualidade t√©cnica sustent√°vel.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs/aulas/aula-07-08-refatoracao-code-smells-sonarcloud"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../aula-05-06-git-ci-cd-github-actions/README.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Git e CI/CD com GitHub Actions</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sumario">Sum√°rio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abertura-e-engajamento">1. Abertura e Engajamento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problema-motivador">1.1. Problema Motivador</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contexto-historico-e-relevancia-atual">1.2. Contexto Hist√≥rico e Relev√¢ncia Atual</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fundamentos-teoricos">2. Fundamentos Te√≥ricos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introducao-aos-code-smells">2.1. Introdu√ß√£o aos Code Smells</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#terminologia-essencial-e-definicoes-formais">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-dos-code-smells">Estrutura Conceitual dos Code Smells</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-tamanho-e-complexidade"><strong>1. Smells de Tamanho e Complexidade</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-duplicacao"><strong>2. Smells de Duplica√ß√£o</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-responsabilidade"><strong>3. Smells de Responsabilidade</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-acoplamento"><strong>4. Smells de Acoplamento</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#smells-de-abstracao"><strong>5. Smells de Abstra√ß√£o</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-quantitativa-metricas-de-qualidade">An√°lise Quantitativa: M√©tricas de Qualidade</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-critica-limitacoes-e-contexto">An√°lise Cr√≠tica: Limita√ß√µes e Contexto</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tecnicas-de-refatoracao">2.2. T√©cnicas de Refatora√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-das-tecnicas-de-refatoracao">Estrutura Conceitual das T√©cnicas de Refatora√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracoes-de-extracao"><strong>1. Refatora√ß√µes de Extra√ß√£o</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracoes-de-movimento"><strong>2. Refatora√ß√µes de Movimento</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracoes-de-simplificacao"><strong>3. Refatora√ß√µes de Simplifica√ß√£o</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-consequencias-e-trade-offs">An√°lise de Consequ√™ncias e Trade-offs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-critica-quando-nao-refatorar">An√°lise Cr√≠tica: Quando N√ÉO Refatorar</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tdd-e-refatoracao">2.3. TDD e Refatora√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-do-tdd-na-refatoracao">Estrutura Conceitual do TDD na Refatora√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#fase-red-definicao-de-comportamento"><strong>1. Fase Red: Defini√ß√£o de Comportamento</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#fase-green-implementacao-minima"><strong>2. Fase Green: Implementa√ß√£o M√≠nima</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#fase-refactor-melhoria-da-qualidade"><strong>3. Fase Refactor: Melhoria da Qualidade</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-quantitativa-metricas-tdd">An√°lise Quantitativa: M√©tricas TDD</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-consequencias-tdd-vs-refatoracao-tradicional">An√°lise de Consequ√™ncias: TDD vs. Refatora√ß√£o Tradicional</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-de-analise-estatica">2.4. Ferramentas de An√°lise Est√°tica</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-das-ferramentas">Estrutura Conceitual das Ferramentas</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pylint-analise-completa-de-qualidade"><strong>1. Pylint: An√°lise Completa de Qualidade</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#flake8-analise-de-estilo-e-qualidade"><strong>2. Flake8: An√°lise de Estilo e Qualidade</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#sonarcloud-plataforma-integrada"><strong>3. SonarCloud: Plataforma Integrada</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">An√°lise Quantitativa: M√©tricas de Qualidade</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-critica-limitacoes-e-falsos-positivos">An√°lise Cr√≠tica: Limita√ß√µes e Falsos Positivos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integracao-com-pipelines-ci-cd">2.5. Integra√ß√£o com Pipelines CI/CD</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Terminologia Essencial e Defini√ß√µes Formais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estrutura-conceitual-da-integracao">Estrutura Conceitual da Integra√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline-de-qualidade-em-multiplas-camadas"><strong>1. Pipeline de Qualidade em M√∫ltiplas Camadas</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#configuracao-github-actions-completa"><strong>2. Configura√ß√£o GitHub Actions Completa</strong></a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-gate-customizado"><strong>3. Quality Gate Customizado</strong></a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-consequencias-impacto-na-velocidade-vs-qualidade">An√°lise de Consequ√™ncias: Impacto na Velocidade vs. Qualidade</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicacao-pratica-e-implementacao">3. Aplica√ß√£o Pr√°tica e Implementa√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#estudo-de-caso-guiado-sistema-de-e-commerce">3.1. Estudo de Caso Guiado: Sistema de E-commerce</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#passo-1-analise-inicial-do-sistema-problematico">Passo 1: An√°lise Inicial do Sistema Problem√°tico</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#passo-2-identificacao-e-catalogacao-dos-code-smells">Passo 2: Identifica√ß√£o e Cataloga√ß√£o dos Code Smells</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#passo-3-refatoracao-incremental-com-tdd">Passo 3: Refatora√ß√£o Incremental com TDD</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#passo-4-comparacao-quantitativa-antes-vs-depois">Passo 4: Compara√ß√£o Quantitativa - Antes vs. Depois</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exemplos-de-codigo-comentado">3.2. Exemplos de C√≥digo Comentado</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-method-decomposicao-de-complexidade">Extract Method: Decomposi√ß√£o de Complexidade</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-bibliotecas-e-ecossistema">3.3. Ferramentas, Bibliotecas e Ecossistema</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-de-analise-de-qualidade-utilizadas">Ferramentas de An√°lise de Qualidade Utilizadas</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-de-teste-e-cobertura">Ferramentas de Teste e Cobertura</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ferramentas-de-ci-cd">Ferramentas de CI/CD</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#topicos-avancados-e-nuances">4. T√≥picos Avan√ßados e Nuances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#desafios-comuns-e-anti-padroes">4.1. Desafios Comuns e ‚ÄúAnti-Padr√µes‚Äù</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#over-engineering-o-perigo-da-refatoracao-excessiva">Over-Engineering: O Perigo da Refatora√ß√£o Excessiva</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracao-sem-testes-receita-para-o-desastre">Refatora√ß√£o Sem Testes: Receita para o Desastre</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#technical-debt-vs-business-pressure">Technical Debt vs. Business Pressure</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variacoes-e-arquiteturas-especializadas">4.2. Varia√ß√µes e Arquiteturas Especializadas</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#microservices-e-refatoracao-distribuida">Microservices e Refatora√ß√£o Distribu√≠da</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracao-para-performance">Refatora√ß√£o para Performance</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-de-performance-e-otimizacao">4.3. An√°lise de Performance e Otimiza√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas-de-qualidade-vs-performance">M√©tricas de Qualidade vs. Performance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sintese-e-perspectivas-futuras">5. S√≠ntese e Perspectivas Futuras</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conexoes-com-outras-areas-da-computacao">5.1. Conex√µes com Outras √Åreas da Computa√ß√£o</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#engenharia-de-software-e-devops">Engenharia de Software e DevOps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inteligencia-artificial-e-machine-learning">Intelig√™ncia Artificial e Machine Learning</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seguranca-da-informacao">Seguran√ßa da Informa√ß√£o</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-fronteira-da-pesquisa-e-o-futuro">5.2. A Fronteira da Pesquisa e o Futuro</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#quantum-computing-e-code-quality">Quantum Computing e Code Quality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#refatoracao-automatica-com-large-language-models">Refatora√ß√£o Autom√°tica com Large Language Models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#continuous-quality-evolution">Continuous Quality Evolution</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resumo-do-capitulo-e-mapa-mental">5.3. Resumo do Cap√≠tulo e Mapa Mental</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#principais-conceitos-consolidados">Principais Conceitos Consolidados</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mapa-mental-ecossistema-de-qualidade">Mapa Mental: Ecossistema de Qualidade</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#referencias-e-leituras-adicionais">5.4. Refer√™ncias e Leituras Adicionais</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#livros-fundamentais">Livros Fundamentais</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#artigos-cientificos-e-papers">Artigos Cient√≠ficos e Papers</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#recursos-online-e-ferramentas">Recursos Online e Ferramentas</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cursos-e-certificacoes">Cursos e Certifica√ß√µes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jackson Antonio do Prado Lima
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>